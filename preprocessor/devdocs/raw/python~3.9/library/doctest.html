<h1 id="doctest-test-interactive-python-examples">doctest — Test interactive Python examples</h1> <p id="module-doctest"><strong>Source code:</strong> <a class="reference external" href="https://github.com/python/cpython/tree/3.9/Lib/doctest.py">Lib/doctest.py</a></p>  <p>The <a class="reference internal" href="#module-doctest" title="doctest: Test pieces of code within docstrings."><code>doctest</code></a> module searches for pieces of text that look like interactive Python sessions, and then executes those sessions to verify that they work exactly as shown. There are several common ways to use doctest:</p> <ul class="simple"> <li>To check that a module’s docstrings are up-to-date by verifying that all interactive examples still work as documented.</li> <li>To perform regression testing by verifying that interactive examples from a test file or a test object work as expected.</li> <li>To write tutorial documentation for a package, liberally illustrated with input-output examples. Depending on whether the examples or the expository text are emphasized, this has the flavor of “literate testing” or “executable documentation”.</li> </ul> <p>Here’s a complete but small example module:</p> <pre data-language="python">"""
This is the "example" module.

The example module supplies one function, factorial().  For example,

&gt;&gt;&gt; factorial(5)
120
"""

def factorial(n):
    """Return the factorial of n, an exact integer &gt;= 0.

    &gt;&gt;&gt; [factorial(n) for n in range(6)]
    [1, 1, 2, 6, 24, 120]
    &gt;&gt;&gt; factorial(30)
    265252859812191058636308480000000
    &gt;&gt;&gt; factorial(-1)
    Traceback (most recent call last):
        ...
    ValueError: n must be &gt;= 0

    Factorials of floats are OK, but the float must be an exact integer:
    &gt;&gt;&gt; factorial(30.1)
    Traceback (most recent call last):
        ...
    ValueError: n must be exact integer
    &gt;&gt;&gt; factorial(30.0)
    265252859812191058636308480000000

    It must also not be ridiculously large:
    &gt;&gt;&gt; factorial(1e100)
    Traceback (most recent call last):
        ...
    OverflowError: n too large
    """

    import math
    if not n &gt;= 0:
        raise ValueError("n must be &gt;= 0")
    if math.floor(n) != n:
        raise ValueError("n must be exact integer")
    if n+1 == n:  # catch a value like 1e300
        raise OverflowError("n too large")
    result = 1
    factor = 2
    while factor &lt;= n:
        result *= factor
        factor += 1
    return result


if __name__ == "__main__":
    import doctest
    doctest.testmod()
</pre> <p>If you run <code>example.py</code> directly from the command line, <a class="reference internal" href="#module-doctest" title="doctest: Test pieces of code within docstrings."><code>doctest</code></a> works its magic:</p> <pre data-language="shell">$ python example.py
$
</pre> <p>There’s no output! That’s normal, and it means all the examples worked. Pass <code>-v</code> to the script, and <a class="reference internal" href="#module-doctest" title="doctest: Test pieces of code within docstrings."><code>doctest</code></a> prints a detailed log of what it’s trying, and prints a summary at the end:</p> <pre data-language="shell">$ python example.py -v
Trying:
    factorial(5)
Expecting:
    120
ok
Trying:
    [factorial(n) for n in range(6)]
Expecting:
    [1, 1, 2, 6, 24, 120]
ok
</pre> <p>And so on, eventually ending with:</p> <pre data-language="none">Trying:
    factorial(1e100)
Expecting:
    Traceback (most recent call last):
        ...
    OverflowError: n too large
ok
2 items passed all tests:
   1 tests in __main__
   8 tests in __main__.factorial
9 tests in 2 items.
9 passed and 0 failed.
Test passed.
$
</pre> <p>That’s all you need to know to start making productive use of <a class="reference internal" href="#module-doctest" title="doctest: Test pieces of code within docstrings."><code>doctest</code></a>! Jump in. The following sections provide full details. Note that there are many examples of doctests in the standard Python test suite and libraries. Especially useful examples can be found in the standard test file <code>Lib/test/test_doctest.py</code>.</p>  <h2 id="doctest-simple-testmod">Simple Usage: Checking Examples in Docstrings</h2> <p id="simple-usage-checking-examples-in-docstrings">The simplest way to start using doctest (but not necessarily the way you’ll continue to do it) is to end each module <code>M</code> with:</p> <pre data-language="python">if __name__ == "__main__":
    import doctest
    doctest.testmod()
</pre> <p><a class="reference internal" href="#module-doctest" title="doctest: Test pieces of code within docstrings."><code>doctest</code></a> then examines docstrings in module <code>M</code>.</p> <p>Running the module as a script causes the examples in the docstrings to get executed and verified:</p> <pre data-language="python">python M.py
</pre> <p>This won’t display anything unless an example fails, in which case the failing example(s) and the cause(s) of the failure(s) are printed to stdout, and the final line of output is <code>***Test Failed*** N failures.</code>, where <em>N</em> is the number of examples that failed.</p> <p>Run it with the <code>-v</code> switch instead:</p> <pre data-language="python">python M.py -v
</pre> <p>and a detailed report of all examples tried is printed to standard output, along with assorted summaries at the end.</p> <p>You can force verbose mode by passing <code>verbose=True</code> to <a class="reference internal" href="#doctest.testmod" title="doctest.testmod"><code>testmod()</code></a>, or prohibit it by passing <code>verbose=False</code>. In either of those cases, <code>sys.argv</code> is not examined by <a class="reference internal" href="#doctest.testmod" title="doctest.testmod"><code>testmod()</code></a> (so passing <code>-v</code> or not has no effect).</p> <p>There is also a command line shortcut for running <a class="reference internal" href="#doctest.testmod" title="doctest.testmod"><code>testmod()</code></a>. You can instruct the Python interpreter to run the doctest module directly from the standard library and pass the module name(s) on the command line:</p> <pre data-language="python">python -m doctest -v example.py
</pre> <p>This will import <code>example.py</code> as a standalone module and run <a class="reference internal" href="#doctest.testmod" title="doctest.testmod"><code>testmod()</code></a> on it. Note that this may not work correctly if the file is part of a package and imports other submodules from that package.</p> <p>For more information on <a class="reference internal" href="#doctest.testmod" title="doctest.testmod"><code>testmod()</code></a>, see section <a class="reference internal" href="#doctest-basic-api"><span class="std std-ref">Basic API</span></a>.</p>   <h2 id="doctest-simple-testfile">Simple Usage: Checking Examples in a Text File</h2> <p id="simple-usage-checking-examples-in-a-text-file">Another simple application of doctest is testing interactive examples in a text file. This can be done with the <a class="reference internal" href="#doctest.testfile" title="doctest.testfile"><code>testfile()</code></a> function:</p> <pre data-language="python">import doctest
doctest.testfile("example.txt")
</pre> <p>That short script executes and verifies any interactive Python examples contained in the file <code>example.txt</code>. The file content is treated as if it were a single giant docstring; the file doesn’t need to contain a Python program! For example, perhaps <code>example.txt</code> contains this:</p> <pre data-language="none">The ``example`` module
======================

Using ``factorial``
-------------------

This is an example text file in reStructuredText format.  First import
``factorial`` from the ``example`` module:

    &gt;&gt;&gt; from example import factorial

Now use it:

    &gt;&gt;&gt; factorial(6)
    120
</pre> <p>Running <code>doctest.testfile("example.txt")</code> then finds the error in this documentation:</p> <pre data-language="python">File "./example.txt", line 14, in example.txt
Failed example:
    factorial(6)
Expected:
    120
Got:
    720
</pre> <p>As with <a class="reference internal" href="#doctest.testmod" title="doctest.testmod"><code>testmod()</code></a>, <a class="reference internal" href="#doctest.testfile" title="doctest.testfile"><code>testfile()</code></a> won’t display anything unless an example fails. If an example does fail, then the failing example(s) and the cause(s) of the failure(s) are printed to stdout, using the same format as <a class="reference internal" href="#doctest.testmod" title="doctest.testmod"><code>testmod()</code></a>.</p> <p>By default, <a class="reference internal" href="#doctest.testfile" title="doctest.testfile"><code>testfile()</code></a> looks for files in the calling module’s directory. See section <a class="reference internal" href="#doctest-basic-api"><span class="std std-ref">Basic API</span></a> for a description of the optional arguments that can be used to tell it to look for files in other locations.</p> <p>Like <a class="reference internal" href="#doctest.testmod" title="doctest.testmod"><code>testmod()</code></a>, <a class="reference internal" href="#doctest.testfile" title="doctest.testfile"><code>testfile()</code></a>’s verbosity can be set with the <code>-v</code> command-line switch or with the optional keyword argument <em>verbose</em>.</p> <p>There is also a command line shortcut for running <a class="reference internal" href="#doctest.testfile" title="doctest.testfile"><code>testfile()</code></a>. You can instruct the Python interpreter to run the doctest module directly from the standard library and pass the file name(s) on the command line:</p> <pre data-language="python">python -m doctest -v example.txt
</pre> <p>Because the file name does not end with <code>.py</code>, <a class="reference internal" href="#module-doctest" title="doctest: Test pieces of code within docstrings."><code>doctest</code></a> infers that it must be run with <a class="reference internal" href="#doctest.testfile" title="doctest.testfile"><code>testfile()</code></a>, not <a class="reference internal" href="#doctest.testmod" title="doctest.testmod"><code>testmod()</code></a>.</p> <p>For more information on <a class="reference internal" href="#doctest.testfile" title="doctest.testfile"><code>testfile()</code></a>, see section <a class="reference internal" href="#doctest-basic-api"><span class="std std-ref">Basic API</span></a>.</p>   <h2 id="doctest-how-it-works">How It Works</h2> <p id="how-it-works">This section examines in detail how doctest works: which docstrings it looks at, how it finds interactive examples, what execution context it uses, how it handles exceptions, and how option flags can be used to control its behavior. This is the information that you need to know to write doctest examples; for information about actually running doctest on these examples, see the following sections.</p>  <h3 id="doctest-which-docstrings">Which Docstrings Are Examined?</h3> <p id="which-docstrings-are-examined">The module docstring, and all function, class and method docstrings are searched. Objects imported into the module are not searched.</p> <p>In addition, if <code>M.__test__</code> exists and “is true”, it must be a dict, and each entry maps a (string) name to a function object, class object, or string. Function and class object docstrings found from <code>M.__test__</code> are searched, and strings are treated as if they were docstrings. In output, a key <code>K</code> in <code>M.__test__</code> appears with name</p> <pre data-language="python">&lt;name of M&gt;.__test__.K
</pre> <p>Any classes found are recursively searched similarly, to test docstrings in their contained methods and nested classes.</p> <div class="impl-detail compound"> <p><strong>CPython implementation detail:</strong> Prior to version 3.4, extension modules written in C were not fully searched by doctest.</p> </div>   <h3 id="doctest-finding-examples">How are Docstring Examples Recognized?</h3> <p id="how-are-docstring-examples-recognized">In most cases a copy-and-paste of an interactive console session works fine, but doctest isn’t trying to do an exact emulation of any specific Python shell.</p> <pre data-language="python">&gt;&gt;&gt; # comments are ignored
&gt;&gt;&gt; x = 12
&gt;&gt;&gt; x
12
&gt;&gt;&gt; if x == 13:
...     print("yes")
... else:
...     print("no")
...     print("NO")
...     print("NO!!!")
...
no
NO
NO!!!
&gt;&gt;&gt;
</pre> <p id="index-0">Any expected output must immediately follow the final <code>'&gt;&gt;&gt; '</code> or <code>'... '</code> line containing the code, and the expected output (if any) extends to the next <code>'&gt;&gt;&gt; '</code> or all-whitespace line.</p> <p>The fine print:</p> <ul> <li>Expected output cannot contain an all-whitespace line, since such a line is taken to signal the end of expected output. If expected output does contain a blank line, put <code>&lt;BLANKLINE&gt;</code> in your doctest example each place a blank line is expected.</li> <li>All hard tab characters are expanded to spaces, using 8-column tab stops. Tabs in output generated by the tested code are not modified. Because any hard tabs in the sample output <em>are</em> expanded, this means that if the code output includes hard tabs, the only way the doctest can pass is if the <a class="reference internal" href="#doctest.NORMALIZE_WHITESPACE" title="doctest.NORMALIZE_WHITESPACE"><code>NORMALIZE_WHITESPACE</code></a> option or <a class="reference internal" href="#doctest-directives"><span class="std std-ref">directive</span></a> is in effect. Alternatively, the test can be rewritten to capture the output and compare it to an expected value as part of the test. This handling of tabs in the source was arrived at through trial and error, and has proven to be the least error prone way of handling them. It is possible to use a different algorithm for handling tabs by writing a custom <a class="reference internal" href="#doctest.DocTestParser" title="doctest.DocTestParser"><code>DocTestParser</code></a> class.</li> <li>Output to stdout is captured, but not output to stderr (exception tracebacks are captured via a different means).</li> <li>
<p>If you continue a line via backslashing in an interactive session, or for any other reason use a backslash, you should use a raw docstring, which will preserve your backslashes exactly as you type them:</p> <pre data-language="python">&gt;&gt;&gt; def f(x):
...     r'''Backslashes in a raw docstring: m\n'''
&gt;&gt;&gt; print(f.__doc__)
Backslashes in a raw docstring: m\n
</pre> <p>Otherwise, the backslash will be interpreted as part of the string. For example, the <code>\n</code> above would be interpreted as a newline character. Alternatively, you can double each backslash in the doctest version (and not use a raw string):</p> <pre data-language="python">&gt;&gt;&gt; def f(x):
...     '''Backslashes in a raw docstring: m\\n'''
&gt;&gt;&gt; print(f.__doc__)
Backslashes in a raw docstring: m\n
</pre> </li> <li>
<p>The starting column doesn’t matter:</p> <pre data-language="python">&gt;&gt;&gt; assert "Easy!"
      &gt;&gt;&gt; import math
          &gt;&gt;&gt; math.floor(1.9)
          1
</pre> <p>and as many leading whitespace characters are stripped from the expected output as appeared in the initial <code>'&gt;&gt;&gt; '</code> line that started the example.</p> </li> </ul>   <h3 id="doctest-execution-context">What’s the Execution Context?</h3> <p id="what-s-the-execution-context">By default, each time <a class="reference internal" href="#module-doctest" title="doctest: Test pieces of code within docstrings."><code>doctest</code></a> finds a docstring to test, it uses a <em>shallow copy</em> of <code>M</code>’s globals, so that running tests doesn’t change the module’s real globals, and so that one test in <code>M</code> can’t leave behind crumbs that accidentally allow another test to work. This means examples can freely use any names defined at top-level in <code>M</code>, and names defined earlier in the docstring being run. Examples cannot see names defined in other docstrings.</p> <p>You can force use of your own dict as the execution context by passing <code>globs=your_dict</code> to <a class="reference internal" href="#doctest.testmod" title="doctest.testmod"><code>testmod()</code></a> or <a class="reference internal" href="#doctest.testfile" title="doctest.testfile"><code>testfile()</code></a> instead.</p>   <h3 id="doctest-exceptions">What About Exceptions?</h3> <p id="what-about-exceptions">No problem, provided that the traceback is the only output produced by the example: just paste in the traceback. <a class="footnote-reference brackets" href="#id2" id="id1">1</a> Since tracebacks contain details that are likely to change rapidly (for example, exact file paths and line numbers), this is one case where doctest works hard to be flexible in what it accepts.</p> <p>Simple example:</p> <pre data-language="python">&gt;&gt;&gt; [1, 2, 3].remove(42)
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
ValueError: list.remove(x): x not in list
</pre> <p>That doctest succeeds if <a class="reference internal" href="exceptions#ValueError" title="ValueError"><code>ValueError</code></a> is raised, with the <code>list.remove(x):
x not in list</code> detail as shown.</p> <p>The expected output for an exception must start with a traceback header, which may be either of the following two lines, indented the same as the first line of the example:</p> <pre data-language="python">Traceback (most recent call last):
Traceback (innermost last):
</pre> <p>The traceback header is followed by an optional traceback stack, whose contents are ignored by doctest. The traceback stack is typically omitted, or copied verbatim from an interactive session.</p> <p>The traceback stack is followed by the most interesting part: the line(s) containing the exception type and detail. This is usually the last line of a traceback, but can extend across multiple lines if the exception has a multi-line detail:</p> <pre data-language="python">&gt;&gt;&gt; raise ValueError('multi\n    line\ndetail')
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
ValueError: multi
    line
detail
</pre> <p>The last three lines (starting with <a class="reference internal" href="exceptions#ValueError" title="ValueError"><code>ValueError</code></a>) are compared against the exception’s type and detail, and the rest are ignored.</p> <p>Best practice is to omit the traceback stack, unless it adds significant documentation value to the example. So the last example is probably better as:</p> <pre data-language="python">&gt;&gt;&gt; raise ValueError('multi\n    line\ndetail')
Traceback (most recent call last):
    ...
ValueError: multi
    line
detail
</pre> <p>Note that tracebacks are treated very specially. In particular, in the rewritten example, the use of <code>...</code> is independent of doctest’s <a class="reference internal" href="#doctest.ELLIPSIS" title="doctest.ELLIPSIS"><code>ELLIPSIS</code></a> option. The ellipsis in that example could be left out, or could just as well be three (or three hundred) commas or digits, or an indented transcript of a Monty Python skit.</p> <p>Some details you should read once, but won’t need to remember:</p> <ul class="simple"> <li>Doctest can’t guess whether your expected output came from an exception traceback or from ordinary printing. So, e.g., an example that expects <code>ValueError: 42 is prime</code> will pass whether <a class="reference internal" href="exceptions#ValueError" title="ValueError"><code>ValueError</code></a> is actually raised or if the example merely prints that traceback text. In practice, ordinary output rarely begins with a traceback header line, so this doesn’t create real problems.</li> <li>Each line of the traceback stack (if present) must be indented further than the first line of the example, <em>or</em> start with a non-alphanumeric character. The first line following the traceback header indented the same and starting with an alphanumeric is taken to be the start of the exception detail. Of course this does the right thing for genuine tracebacks.</li> <li>When the <a class="reference internal" href="#doctest.IGNORE_EXCEPTION_DETAIL" title="doctest.IGNORE_EXCEPTION_DETAIL"><code>IGNORE_EXCEPTION_DETAIL</code></a> doctest option is specified, everything following the leftmost colon and any module information in the exception name is ignored.</li> <li>The interactive shell omits the traceback header line for some <a class="reference internal" href="exceptions#SyntaxError" title="SyntaxError"><code>SyntaxError</code></a>s. But doctest uses the traceback header line to distinguish exceptions from non-exceptions. So in the rare case where you need to test a <a class="reference internal" href="exceptions#SyntaxError" title="SyntaxError"><code>SyntaxError</code></a> that omits the traceback header, you will need to manually add the traceback header line to your test example.</li> </ul> <ul id="index-1"> <li>
<p>For some <a class="reference internal" href="exceptions#SyntaxError" title="SyntaxError"><code>SyntaxError</code></a>s, Python displays the character position of the syntax error, using a <code>^</code> marker:</p> <pre data-language="python">&gt;&gt;&gt; 1 1
  File "&lt;stdin&gt;", line 1
    1 1
      ^
SyntaxError: invalid syntax
</pre> <p>Since the lines showing the position of the error come before the exception type and detail, they are not checked by doctest. For example, the following test would pass, even though it puts the <code>^</code> marker in the wrong location:</p> <pre data-language="python">&gt;&gt;&gt; 1 1
  File "&lt;stdin&gt;", line 1
    1 1
    ^
SyntaxError: invalid syntax
</pre> </li> </ul>   <h3 id="option-flags-and-directives">Option Flags</h3> <p id="option-flags">A number of option flags control various aspects of doctest’s behavior. Symbolic names for the flags are supplied as module constants, which can be <a class="reference internal" href="https://docs.python.org/3.9/reference/expressions.html#bitwise"><span class="std std-ref">bitwise ORed</span></a> together and passed to various functions. The names can also be used in <a class="reference internal" href="#doctest-directives"><span class="std std-ref">doctest directives</span></a>, and may be passed to the doctest command line interface via the <code>-o</code> option.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3.4: </span>The <code>-o</code> command line option.</p> </div> <p>The first group of options define test semantics, controlling aspects of how doctest decides whether actual output matches an example’s expected output:</p> <dl class="data"> <dt id="doctest.DONT_ACCEPT_TRUE_FOR_1">
<code>doctest.DONT_ACCEPT_TRUE_FOR_1</code> </dt> <dd>
<p>By default, if an expected output block contains just <code>1</code>, an actual output block containing just <code>1</code> or just <code>True</code> is considered to be a match, and similarly for <code>0</code> versus <code>False</code>. When <a class="reference internal" href="#doctest.DONT_ACCEPT_TRUE_FOR_1" title="doctest.DONT_ACCEPT_TRUE_FOR_1"><code>DONT_ACCEPT_TRUE_FOR_1</code></a> is specified, neither substitution is allowed. The default behavior caters to that Python changed the return type of many functions from integer to boolean; doctests expecting “little integer” output still work in these cases. This option will probably go away, but not for several years.</p> </dd>
</dl> <dl class="data"> <dt id="doctest.DONT_ACCEPT_BLANKLINE">
<code>doctest.DONT_ACCEPT_BLANKLINE</code> </dt> <dd>
<p>By default, if an expected output block contains a line containing only the string <code>&lt;BLANKLINE&gt;</code>, then that line will match a blank line in the actual output. Because a genuinely blank line delimits the expected output, this is the only way to communicate that a blank line is expected. When <a class="reference internal" href="#doctest.DONT_ACCEPT_BLANKLINE" title="doctest.DONT_ACCEPT_BLANKLINE"><code>DONT_ACCEPT_BLANKLINE</code></a> is specified, this substitution is not allowed.</p> </dd>
</dl> <dl class="data"> <dt id="doctest.NORMALIZE_WHITESPACE">
<code>doctest.NORMALIZE_WHITESPACE</code> </dt> <dd>
<p>When specified, all sequences of whitespace (blanks and newlines) are treated as equal. Any sequence of whitespace within the expected output will match any sequence of whitespace within the actual output. By default, whitespace must match exactly. <a class="reference internal" href="#doctest.NORMALIZE_WHITESPACE" title="doctest.NORMALIZE_WHITESPACE"><code>NORMALIZE_WHITESPACE</code></a> is especially useful when a line of expected output is very long, and you want to wrap it across multiple lines in your source.</p> </dd>
</dl> <dl class="data"> <dt id="doctest.ELLIPSIS">
<code>doctest.ELLIPSIS</code> </dt> <dd>
<p>When specified, an ellipsis marker (<code>...</code>) in the expected output can match any substring in the actual output. This includes substrings that span line boundaries, and empty substrings, so it’s best to keep usage of this simple. Complicated uses can lead to the same kinds of “oops, it matched too much!” surprises that <code>.*</code> is prone to in regular expressions.</p> </dd>
</dl> <dl class="data"> <dt id="doctest.IGNORE_EXCEPTION_DETAIL">
<code>doctest.IGNORE_EXCEPTION_DETAIL</code> </dt> <dd>
<p>When specified, an example that expects an exception passes if an exception of the expected type is raised, even if the exception detail does not match. For example, an example expecting <code>ValueError: 42</code> will pass if the actual exception raised is <code>ValueError: 3*14</code>, but will fail, e.g., if <a class="reference internal" href="exceptions#TypeError" title="TypeError"><code>TypeError</code></a> is raised.</p> <p>It will also ignore the module name used in Python 3 doctest reports. Hence both of these variations will work with the flag specified, regardless of whether the test is run under Python 2.7 or Python 3.2 (or later versions):</p> <pre data-language="python">&gt;&gt;&gt; raise CustomError('message')
Traceback (most recent call last):
CustomError: message

&gt;&gt;&gt; raise CustomError('message')
Traceback (most recent call last):
my_module.CustomError: message
</pre> <p>Note that <a class="reference internal" href="#doctest.ELLIPSIS" title="doctest.ELLIPSIS"><code>ELLIPSIS</code></a> can also be used to ignore the details of the exception message, but such a test may still fail based on whether or not the module details are printed as part of the exception name. Using <a class="reference internal" href="#doctest.IGNORE_EXCEPTION_DETAIL" title="doctest.IGNORE_EXCEPTION_DETAIL"><code>IGNORE_EXCEPTION_DETAIL</code></a> and the details from Python 2.3 is also the only clear way to write a doctest that doesn’t care about the exception detail yet continues to pass under Python 2.3 or earlier (those releases do not support <a class="reference internal" href="#doctest-directives"><span class="std std-ref">doctest directives</span></a> and ignore them as irrelevant comments). For example:</p> <pre data-language="python">&gt;&gt;&gt; (1, 2)[3] = 'moo'
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
TypeError: object doesn't support item assignment
</pre> <p>passes under Python 2.3 and later Python versions with the flag specified, even though the detail changed in Python 2.4 to say “does not” instead of “doesn’t”.</p> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.2: </span><a class="reference internal" href="#doctest.IGNORE_EXCEPTION_DETAIL" title="doctest.IGNORE_EXCEPTION_DETAIL"><code>IGNORE_EXCEPTION_DETAIL</code></a> now also ignores any information relating to the module containing the exception under test.</p> </div> </dd>
</dl> <dl class="data"> <dt id="doctest.SKIP">
<code>doctest.SKIP</code> </dt> <dd>
<p>When specified, do not run the example at all. This can be useful in contexts where doctest examples serve as both documentation and test cases, and an example should be included for documentation purposes, but should not be checked. E.g., the example’s output might be random; or the example might depend on resources which would be unavailable to the test driver.</p> <p>The SKIP flag can also be used for temporarily “commenting out” examples.</p> </dd>
</dl> <dl class="data"> <dt id="doctest.COMPARISON_FLAGS">
<code>doctest.COMPARISON_FLAGS</code> </dt> <dd>
<p>A bitmask or’ing together all the comparison flags above.</p> </dd>
</dl> <p>The second group of options controls how test failures are reported:</p> <dl class="data"> <dt id="doctest.REPORT_UDIFF">
<code>doctest.REPORT_UDIFF</code> </dt> <dd>
<p>When specified, failures that involve multi-line expected and actual outputs are displayed using a unified diff.</p> </dd>
</dl> <dl class="data"> <dt id="doctest.REPORT_CDIFF">
<code>doctest.REPORT_CDIFF</code> </dt> <dd>
<p>When specified, failures that involve multi-line expected and actual outputs will be displayed using a context diff.</p> </dd>
</dl> <dl class="data"> <dt id="doctest.REPORT_NDIFF">
<code>doctest.REPORT_NDIFF</code> </dt> <dd>
<p>When specified, differences are computed by <code>difflib.Differ</code>, using the same algorithm as the popular <code>ndiff.py</code> utility. This is the only method that marks differences within lines as well as across lines. For example, if a line of expected output contains digit <code>1</code> where actual output contains letter <code>l</code>, a line is inserted with a caret marking the mismatching column positions.</p> </dd>
</dl> <dl class="data"> <dt id="doctest.REPORT_ONLY_FIRST_FAILURE">
<code>doctest.REPORT_ONLY_FIRST_FAILURE</code> </dt> <dd>
<p>When specified, display the first failing example in each doctest, but suppress output for all remaining examples. This will prevent doctest from reporting correct examples that break because of earlier failures; but it might also hide incorrect examples that fail independently of the first failure. When <a class="reference internal" href="#doctest.REPORT_ONLY_FIRST_FAILURE" title="doctest.REPORT_ONLY_FIRST_FAILURE"><code>REPORT_ONLY_FIRST_FAILURE</code></a> is specified, the remaining examples are still run, and still count towards the total number of failures reported; only the output is suppressed.</p> </dd>
</dl> <dl class="data"> <dt id="doctest.FAIL_FAST">
<code>doctest.FAIL_FAST</code> </dt> <dd>
<p>When specified, exit after the first failing example and don’t attempt to run the remaining examples. Thus, the number of failures reported will be at most 1. This flag may be useful during debugging, since examples after the first failure won’t even produce debugging output.</p> <p>The doctest command line accepts the option <code>-f</code> as a shorthand for <code>-o
FAIL_FAST</code>.</p> <div class="versionadded"> <p><span class="versionmodified added">New in version 3.4.</span></p> </div> </dd>
</dl> <dl class="data"> <dt id="doctest.REPORTING_FLAGS">
<code>doctest.REPORTING_FLAGS</code> </dt> <dd>
<p>A bitmask or’ing together all the reporting flags above.</p> </dd>
</dl> <p>There is also a way to register new option flag names, though this isn’t useful unless you intend to extend <a class="reference internal" href="#module-doctest" title="doctest: Test pieces of code within docstrings."><code>doctest</code></a> internals via subclassing:</p> <dl class="function"> <dt id="doctest.register_optionflag">
<code>doctest.register_optionflag(name)</code> </dt> <dd>
<p>Create a new option flag with a given name, and return the new flag’s integer value. <a class="reference internal" href="#doctest.register_optionflag" title="doctest.register_optionflag"><code>register_optionflag()</code></a> can be used when subclassing <a class="reference internal" href="#doctest.OutputChecker" title="doctest.OutputChecker"><code>OutputChecker</code></a> or <a class="reference internal" href="#doctest.DocTestRunner" title="doctest.DocTestRunner"><code>DocTestRunner</code></a> to create new options that are supported by your subclasses. <a class="reference internal" href="#doctest.register_optionflag" title="doctest.register_optionflag"><code>register_optionflag()</code></a> should always be called using the following idiom:</p> <pre data-language="python">MY_FLAG = register_optionflag('MY_FLAG')
</pre> </dd>
</dl>   <h3 id="index-4">Directives</h3> <p id="directives">Doctest directives may be used to modify the <a class="reference internal" href="#doctest-options"><span class="std std-ref">option flags</span></a> for an individual example. Doctest directives are special Python comments following an example’s source code:</p> <pre>
<strong id="grammar-token-directive">directive            </strong> ::=  "#" "doctest:" <a class="reference internal" href="#grammar-token-directive-options">directive_options</a>
<strong id="grammar-token-directive-options">directive_options    </strong> ::=  <a class="reference internal" href="#grammar-token-directive-option">directive_option</a> ("," <a class="reference internal" href="#grammar-token-directive-option">directive_option</a>)\*
<strong id="grammar-token-directive-option">directive_option     </strong> ::=  <a class="reference internal" href="#grammar-token-on-or-off">on_or_off</a> <a class="reference internal" href="#grammar-token-directive-option-name">directive_option_name</a>
<strong id="grammar-token-on-or-off">on_or_off            </strong> ::=  "+" \| "-"
<strong id="grammar-token-directive-option-name">directive_option_name</strong> ::=  "DONT_ACCEPT_BLANKLINE" \| "NORMALIZE_WHITESPACE" \| ...
</pre> <p>Whitespace is not allowed between the <code>+</code> or <code>-</code> and the directive option name. The directive option name can be any of the option flag names explained above.</p> <p>An example’s doctest directives modify doctest’s behavior for that single example. Use <code>+</code> to enable the named behavior, or <code>-</code> to disable it.</p> <p>For example, this test passes:</p> <pre data-language="python">&gt;&gt;&gt; print(list(range(20))) 
[0,   1,  2,  3,  4,  5,  6,  7,  8,  9,
10,  11, 12, 13, 14, 15, 16, 17, 18, 19]
</pre> <p>Without the directive it would fail, both because the actual output doesn’t have two blanks before the single-digit list elements, and because the actual output is on a single line. This test also passes, and also requires a directive to do so:</p> <pre data-language="python">&gt;&gt;&gt; print(list(range(20))) 
[0, 1, ..., 18, 19]
</pre> <p>Multiple directives can be used on a single physical line, separated by commas:</p> <pre data-language="python">&gt;&gt;&gt; print(list(range(20))) 
[0,    1, ...,   18,    19]
</pre> <p>If multiple directive comments are used for a single example, then they are combined:</p> <pre data-language="python">&gt;&gt;&gt; print(list(range(20))) 
...                        
[0,    1, ...,   18,    19]
</pre> <p>As the previous example shows, you can add <code>...</code> lines to your example containing only directives. This can be useful when an example is too long for a directive to comfortably fit on the same line:</p> <pre data-language="python">&gt;&gt;&gt; print(list(range(5)) + list(range(10, 20)) + list(range(30, 40)))
... 
[0, ..., 4, 10, ..., 19, 30, ..., 39]
</pre> <p>Note that since all options are disabled by default, and directives apply only to the example they appear in, enabling options (via <code>+</code> in a directive) is usually the only meaningful choice. However, option flags can also be passed to functions that run doctests, establishing different defaults. In such cases, disabling an option via <code>-</code> in a directive can be useful.</p>   <h3 id="doctest-warnings">Warnings</h3> <p id="warnings"><a class="reference internal" href="#module-doctest" title="doctest: Test pieces of code within docstrings."><code>doctest</code></a> is serious about requiring exact matches in expected output. If even a single character doesn’t match, the test fails. This will probably surprise you a few times, as you learn exactly what Python does and doesn’t guarantee about output. For example, when printing a set, Python doesn’t guarantee that the element is printed in any particular order, so a test like</p> <pre data-language="python">&gt;&gt;&gt; foo()
{"Hermione", "Harry"}
</pre> <p>is vulnerable! One workaround is to do</p> <pre data-language="python">&gt;&gt;&gt; foo() == {"Hermione", "Harry"}
True
</pre> <p>instead. Another is to do</p> <pre data-language="python">&gt;&gt;&gt; d = sorted(foo())
&gt;&gt;&gt; d
['Harry', 'Hermione']
</pre> <div class="admonition note"> <p class="admonition-title">Note</p> <p>Before Python 3.6, when printing a dict, Python did not guarantee that the key-value pairs was printed in any particular order.</p> </div> <p>There are others, but you get the idea.</p> <p>Another bad idea is to print things that embed an object address, like</p> <pre data-language="python">&gt;&gt;&gt; id(1.0) # certain to fail some of the time
7948648
&gt;&gt;&gt; class C: pass
&gt;&gt;&gt; C()   # the default repr() for instances embeds an address
&lt;__main__.C instance at 0x00AC18F0&gt;
</pre> <p>The <a class="reference internal" href="#doctest.ELLIPSIS" title="doctest.ELLIPSIS"><code>ELLIPSIS</code></a> directive gives a nice approach for the last example:</p> <pre data-language="python">&gt;&gt;&gt; C() 
&lt;__main__.C instance at 0x...&gt;
</pre> <p>Floating-point numbers are also subject to small output variations across platforms, because Python defers to the platform C library for float formatting, and C libraries vary widely in quality here.</p> <pre data-language="python">&gt;&gt;&gt; 1./7  # risky
0.14285714285714285
&gt;&gt;&gt; print(1./7) # safer
0.142857142857
&gt;&gt;&gt; print(round(1./7, 6)) # much safer
0.142857
</pre> <p>Numbers of the form <code>I/2.**J</code> are safe across all platforms, and I often contrive doctest examples to produce numbers of that form:</p> <pre data-language="python">&gt;&gt;&gt; 3./4  # utterly safe
0.75
</pre> <p>Simple fractions are also easier for people to understand, and that makes for better documentation.</p>    <h2 id="doctest-basic-api">Basic API</h2> <p id="basic-api">The functions <a class="reference internal" href="#doctest.testmod" title="doctest.testmod"><code>testmod()</code></a> and <a class="reference internal" href="#doctest.testfile" title="doctest.testfile"><code>testfile()</code></a> provide a simple interface to doctest that should be sufficient for most basic uses. For a less formal introduction to these two functions, see sections <a class="reference internal" href="#doctest-simple-testmod"><span class="std std-ref">Simple Usage: Checking Examples in Docstrings</span></a> and <a class="reference internal" href="#doctest-simple-testfile"><span class="std std-ref">Simple Usage: Checking Examples in a Text File</span></a>.</p> <dl class="function"> <dt id="doctest.testfile">
<code>doctest.testfile(filename, module_relative=True, name=None, package=None, globs=None, verbose=None, report=True, optionflags=0, extraglobs=None, raise_on_error=False, parser=DocTestParser(), encoding=None)</code> </dt> <dd>
<p>All arguments except <em>filename</em> are optional, and should be specified in keyword form.</p> <p>Test examples in the file named <em>filename</em>. Return <code>(failure_count,
test_count)</code>.</p> <p>Optional argument <em>module_relative</em> specifies how the filename should be interpreted:</p> <ul class="simple"> <li>If <em>module_relative</em> is <code>True</code> (the default), then <em>filename</em> specifies an OS-independent module-relative path. By default, this path is relative to the calling module’s directory; but if the <em>package</em> argument is specified, then it is relative to that package. To ensure OS-independence, <em>filename</em> should use <code>/</code> characters to separate path segments, and may not be an absolute path (i.e., it may not begin with <code>/</code>).</li> <li>If <em>module_relative</em> is <code>False</code>, then <em>filename</em> specifies an OS-specific path. The path may be absolute or relative; relative paths are resolved with respect to the current working directory.</li> </ul> <p>Optional argument <em>name</em> gives the name of the test; by default, or if <code>None</code>, <code>os.path.basename(filename)</code> is used.</p> <p>Optional argument <em>package</em> is a Python package or the name of a Python package whose directory should be used as the base directory for a module-relative filename. If no package is specified, then the calling module’s directory is used as the base directory for module-relative filenames. It is an error to specify <em>package</em> if <em>module_relative</em> is <code>False</code>.</p> <p>Optional argument <em>globs</em> gives a dict to be used as the globals when executing examples. A new shallow copy of this dict is created for the doctest, so its examples start with a clean slate. By default, or if <code>None</code>, a new empty dict is used.</p> <p>Optional argument <em>extraglobs</em> gives a dict merged into the globals used to execute examples. This works like <a class="reference internal" href="stdtypes#dict.update" title="dict.update"><code>dict.update()</code></a>: if <em>globs</em> and <em>extraglobs</em> have a common key, the associated value in <em>extraglobs</em> appears in the combined dict. By default, or if <code>None</code>, no extra globals are used. This is an advanced feature that allows parameterization of doctests. For example, a doctest can be written for a base class, using a generic name for the class, then reused to test any number of subclasses by passing an <em>extraglobs</em> dict mapping the generic name to the subclass to be tested.</p> <p>Optional argument <em>verbose</em> prints lots of stuff if true, and prints only failures if false; by default, or if <code>None</code>, it’s true if and only if <code>'-v'</code> is in <code>sys.argv</code>.</p> <p>Optional argument <em>report</em> prints a summary at the end when true, else prints nothing at the end. In verbose mode, the summary is detailed, else the summary is very brief (in fact, empty if all tests passed).</p> <p>Optional argument <em>optionflags</em> (default value 0) takes the <a class="reference internal" href="https://docs.python.org/3.9/reference/expressions.html#bitwise"><span class="std std-ref">bitwise OR</span></a> of option flags. See section <a class="reference internal" href="#doctest-options"><span class="std std-ref">Option Flags</span></a>.</p> <p>Optional argument <em>raise_on_error</em> defaults to false. If true, an exception is raised upon the first failure or unexpected exception in an example. This allows failures to be post-mortem debugged. Default behavior is to continue running examples.</p> <p>Optional argument <em>parser</em> specifies a <a class="reference internal" href="#doctest.DocTestParser" title="doctest.DocTestParser"><code>DocTestParser</code></a> (or subclass) that should be used to extract tests from the files. It defaults to a normal parser (i.e., <code>DocTestParser()</code>).</p> <p>Optional argument <em>encoding</em> specifies an encoding that should be used to convert the file to unicode.</p> </dd>
</dl> <dl class="function"> <dt id="doctest.testmod">
<code>doctest.testmod(m=None, name=None, globs=None, verbose=None, report=True, optionflags=0, extraglobs=None, raise_on_error=False, exclude_empty=False)</code> </dt> <dd>
<p>All arguments are optional, and all except for <em>m</em> should be specified in keyword form.</p> <p>Test examples in docstrings in functions and classes reachable from module <em>m</em> (or module <a class="reference internal" href="__main__#module-__main__" title="__main__: The environment where the top-level script is run."><code>__main__</code></a> if <em>m</em> is not supplied or is <code>None</code>), starting with <code>m.__doc__</code>.</p> <p>Also test examples reachable from dict <code>m.__test__</code>, if it exists and is not <code>None</code>. <code>m.__test__</code> maps names (strings) to functions, classes and strings; function and class docstrings are searched for examples; strings are searched directly, as if they were docstrings.</p> <p>Only docstrings attached to objects belonging to module <em>m</em> are searched.</p> <p>Return <code>(failure_count, test_count)</code>.</p> <p>Optional argument <em>name</em> gives the name of the module; by default, or if <code>None</code>, <code>m.__name__</code> is used.</p> <p>Optional argument <em>exclude_empty</em> defaults to false. If true, objects for which no doctests are found are excluded from consideration. The default is a backward compatibility hack, so that code still using <code>doctest.master.summarize()</code> in conjunction with <a class="reference internal" href="#doctest.testmod" title="doctest.testmod"><code>testmod()</code></a> continues to get output for objects with no tests. The <em>exclude_empty</em> argument to the newer <a class="reference internal" href="#doctest.DocTestFinder" title="doctest.DocTestFinder"><code>DocTestFinder</code></a> constructor defaults to true.</p> <p>Optional arguments <em>extraglobs</em>, <em>verbose</em>, <em>report</em>, <em>optionflags</em>, <em>raise_on_error</em>, and <em>globs</em> are the same as for function <a class="reference internal" href="#doctest.testfile" title="doctest.testfile"><code>testfile()</code></a> above, except that <em>globs</em> defaults to <code>m.__dict__</code>.</p> </dd>
</dl> <dl class="function"> <dt id="doctest.run_docstring_examples">
<code>doctest.run_docstring_examples(f, globs, verbose=False, name="NoName", compileflags=None, optionflags=0)</code> </dt> <dd>
<p>Test examples associated with object <em>f</em>; for example, <em>f</em> may be a string, a module, a function, or a class object.</p> <p>A shallow copy of dictionary argument <em>globs</em> is used for the execution context.</p> <p>Optional argument <em>name</em> is used in failure messages, and defaults to <code>"NoName"</code>.</p> <p>If optional argument <em>verbose</em> is true, output is generated even if there are no failures. By default, output is generated only in case of an example failure.</p> <p>Optional argument <em>compileflags</em> gives the set of flags that should be used by the Python compiler when running the examples. By default, or if <code>None</code>, flags are deduced corresponding to the set of future features found in <em>globs</em>.</p> <p>Optional argument <em>optionflags</em> works as for function <a class="reference internal" href="#doctest.testfile" title="doctest.testfile"><code>testfile()</code></a> above.</p> </dd>
</dl>   <h2 id="doctest-unittest-api">Unittest API</h2> <p id="unittest-api">As your collection of doctest’ed modules grows, you’ll want a way to run all their doctests systematically. <a class="reference internal" href="#module-doctest" title="doctest: Test pieces of code within docstrings."><code>doctest</code></a> provides two functions that can be used to create <a class="reference internal" href="unittest#module-unittest" title="unittest: Unit testing framework for Python."><code>unittest</code></a> test suites from modules and text files containing doctests. To integrate with <a class="reference internal" href="unittest#module-unittest" title="unittest: Unit testing framework for Python."><code>unittest</code></a> test discovery, include a <code>load_tests()</code> function in your test module:</p> <pre data-language="python">import unittest
import doctest
import my_module_with_doctests

def load_tests(loader, tests, ignore):
    tests.addTests(doctest.DocTestSuite(my_module_with_doctests))
    return tests
</pre> <p>There are two main functions for creating <a class="reference internal" href="unittest#unittest.TestSuite" title="unittest.TestSuite"><code>unittest.TestSuite</code></a> instances from text files and modules with doctests:</p> <dl class="function"> <dt id="doctest.DocFileSuite">
<code>doctest.DocFileSuite(*paths, module_relative=True, package=None, setUp=None, tearDown=None, globs=None, optionflags=0, parser=DocTestParser(), encoding=None)</code> </dt> <dd>
<p>Convert doctest tests from one or more text files to a <a class="reference internal" href="unittest#unittest.TestSuite" title="unittest.TestSuite"><code>unittest.TestSuite</code></a>.</p> <p>The returned <a class="reference internal" href="unittest#unittest.TestSuite" title="unittest.TestSuite"><code>unittest.TestSuite</code></a> is to be run by the unittest framework and runs the interactive examples in each file. If an example in any file fails, then the synthesized unit test fails, and a <code>failureException</code> exception is raised showing the name of the file containing the test and a (sometimes approximate) line number.</p> <p>Pass one or more paths (as strings) to text files to be examined.</p> <p>Options may be provided as keyword arguments:</p> <p>Optional argument <em>module_relative</em> specifies how the filenames in <em>paths</em> should be interpreted:</p> <ul class="simple"> <li>If <em>module_relative</em> is <code>True</code> (the default), then each filename in <em>paths</em> specifies an OS-independent module-relative path. By default, this path is relative to the calling module’s directory; but if the <em>package</em> argument is specified, then it is relative to that package. To ensure OS-independence, each filename should use <code>/</code> characters to separate path segments, and may not be an absolute path (i.e., it may not begin with <code>/</code>).</li> <li>If <em>module_relative</em> is <code>False</code>, then each filename in <em>paths</em> specifies an OS-specific path. The path may be absolute or relative; relative paths are resolved with respect to the current working directory.</li> </ul> <p>Optional argument <em>package</em> is a Python package or the name of a Python package whose directory should be used as the base directory for module-relative filenames in <em>paths</em>. If no package is specified, then the calling module’s directory is used as the base directory for module-relative filenames. It is an error to specify <em>package</em> if <em>module_relative</em> is <code>False</code>.</p> <p>Optional argument <em>setUp</em> specifies a set-up function for the test suite. This is called before running the tests in each file. The <em>setUp</em> function will be passed a <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><code>DocTest</code></a> object. The setUp function can access the test globals as the <em>globs</em> attribute of the test passed.</p> <p>Optional argument <em>tearDown</em> specifies a tear-down function for the test suite. This is called after running the tests in each file. The <em>tearDown</em> function will be passed a <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><code>DocTest</code></a> object. The setUp function can access the test globals as the <em>globs</em> attribute of the test passed.</p> <p>Optional argument <em>globs</em> is a dictionary containing the initial global variables for the tests. A new copy of this dictionary is created for each test. By default, <em>globs</em> is a new empty dictionary.</p> <p>Optional argument <em>optionflags</em> specifies the default doctest options for the tests, created by or-ing together individual option flags. See section <a class="reference internal" href="#doctest-options"><span class="std std-ref">Option Flags</span></a>. See function <a class="reference internal" href="#doctest.set_unittest_reportflags" title="doctest.set_unittest_reportflags"><code>set_unittest_reportflags()</code></a> below for a better way to set reporting options.</p> <p>Optional argument <em>parser</em> specifies a <a class="reference internal" href="#doctest.DocTestParser" title="doctest.DocTestParser"><code>DocTestParser</code></a> (or subclass) that should be used to extract tests from the files. It defaults to a normal parser (i.e., <code>DocTestParser()</code>).</p> <p>Optional argument <em>encoding</em> specifies an encoding that should be used to convert the file to unicode.</p> <p>The global <code>__file__</code> is added to the globals provided to doctests loaded from a text file using <a class="reference internal" href="#doctest.DocFileSuite" title="doctest.DocFileSuite"><code>DocFileSuite()</code></a>.</p> </dd>
</dl> <dl class="function"> <dt id="doctest.DocTestSuite">
<code>doctest.DocTestSuite(module=None, globs=None, extraglobs=None, test_finder=None, setUp=None, tearDown=None, checker=None)</code> </dt> <dd>
<p>Convert doctest tests for a module to a <a class="reference internal" href="unittest#unittest.TestSuite" title="unittest.TestSuite"><code>unittest.TestSuite</code></a>.</p> <p>The returned <a class="reference internal" href="unittest#unittest.TestSuite" title="unittest.TestSuite"><code>unittest.TestSuite</code></a> is to be run by the unittest framework and runs each doctest in the module. If any of the doctests fail, then the synthesized unit test fails, and a <code>failureException</code> exception is raised showing the name of the file containing the test and a (sometimes approximate) line number.</p> <p>Optional argument <em>module</em> provides the module to be tested. It can be a module object or a (possibly dotted) module name. If not specified, the module calling this function is used.</p> <p>Optional argument <em>globs</em> is a dictionary containing the initial global variables for the tests. A new copy of this dictionary is created for each test. By default, <em>globs</em> is a new empty dictionary.</p> <p>Optional argument <em>extraglobs</em> specifies an extra set of global variables, which is merged into <em>globs</em>. By default, no extra globals are used.</p> <p>Optional argument <em>test_finder</em> is the <a class="reference internal" href="#doctest.DocTestFinder" title="doctest.DocTestFinder"><code>DocTestFinder</code></a> object (or a drop-in replacement) that is used to extract doctests from the module.</p> <p>Optional arguments <em>setUp</em>, <em>tearDown</em>, and <em>optionflags</em> are the same as for function <a class="reference internal" href="#doctest.DocFileSuite" title="doctest.DocFileSuite"><code>DocFileSuite()</code></a> above.</p> <p>This function uses the same search technique as <a class="reference internal" href="#doctest.testmod" title="doctest.testmod"><code>testmod()</code></a>.</p> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 3.5: </span><a class="reference internal" href="#doctest.DocTestSuite" title="doctest.DocTestSuite"><code>DocTestSuite()</code></a> returns an empty <a class="reference internal" href="unittest#unittest.TestSuite" title="unittest.TestSuite"><code>unittest.TestSuite</code></a> if <em>module</em> contains no docstrings instead of raising <a class="reference internal" href="exceptions#ValueError" title="ValueError"><code>ValueError</code></a>.</p> </div> </dd>
</dl> <p>Under the covers, <a class="reference internal" href="#doctest.DocTestSuite" title="doctest.DocTestSuite"><code>DocTestSuite()</code></a> creates a <a class="reference internal" href="unittest#unittest.TestSuite" title="unittest.TestSuite"><code>unittest.TestSuite</code></a> out of <code>doctest.DocTestCase</code> instances, and <code>DocTestCase</code> is a subclass of <a class="reference internal" href="unittest#unittest.TestCase" title="unittest.TestCase"><code>unittest.TestCase</code></a>. <code>DocTestCase</code> isn’t documented here (it’s an internal detail), but studying its code can answer questions about the exact details of <a class="reference internal" href="unittest#module-unittest" title="unittest: Unit testing framework for Python."><code>unittest</code></a> integration.</p> <p>Similarly, <a class="reference internal" href="#doctest.DocFileSuite" title="doctest.DocFileSuite"><code>DocFileSuite()</code></a> creates a <a class="reference internal" href="unittest#unittest.TestSuite" title="unittest.TestSuite"><code>unittest.TestSuite</code></a> out of <code>doctest.DocFileCase</code> instances, and <code>DocFileCase</code> is a subclass of <code>DocTestCase</code>.</p> <p>So both ways of creating a <a class="reference internal" href="unittest#unittest.TestSuite" title="unittest.TestSuite"><code>unittest.TestSuite</code></a> run instances of <code>DocTestCase</code>. This is important for a subtle reason: when you run <a class="reference internal" href="#module-doctest" title="doctest: Test pieces of code within docstrings."><code>doctest</code></a> functions yourself, you can control the <a class="reference internal" href="#module-doctest" title="doctest: Test pieces of code within docstrings."><code>doctest</code></a> options in use directly, by passing option flags to <a class="reference internal" href="#module-doctest" title="doctest: Test pieces of code within docstrings."><code>doctest</code></a> functions. However, if you’re writing a <a class="reference internal" href="unittest#module-unittest" title="unittest: Unit testing framework for Python."><code>unittest</code></a> framework, <a class="reference internal" href="unittest#module-unittest" title="unittest: Unit testing framework for Python."><code>unittest</code></a> ultimately controls when and how tests get run. The framework author typically wants to control <a class="reference internal" href="#module-doctest" title="doctest: Test pieces of code within docstrings."><code>doctest</code></a> reporting options (perhaps, e.g., specified by command line options), but there’s no way to pass options through <a class="reference internal" href="unittest#module-unittest" title="unittest: Unit testing framework for Python."><code>unittest</code></a> to <a class="reference internal" href="#module-doctest" title="doctest: Test pieces of code within docstrings."><code>doctest</code></a> test runners.</p> <p>For this reason, <a class="reference internal" href="#module-doctest" title="doctest: Test pieces of code within docstrings."><code>doctest</code></a> also supports a notion of <a class="reference internal" href="#module-doctest" title="doctest: Test pieces of code within docstrings."><code>doctest</code></a> reporting flags specific to <a class="reference internal" href="unittest#module-unittest" title="unittest: Unit testing framework for Python."><code>unittest</code></a> support, via this function:</p> <dl class="function"> <dt id="doctest.set_unittest_reportflags">
<code>doctest.set_unittest_reportflags(flags)</code> </dt> <dd>
<p>Set the <a class="reference internal" href="#module-doctest" title="doctest: Test pieces of code within docstrings."><code>doctest</code></a> reporting flags to use.</p> <p>Argument <em>flags</em> takes the <a class="reference internal" href="https://docs.python.org/3.9/reference/expressions.html#bitwise"><span class="std std-ref">bitwise OR</span></a> of option flags. See section <a class="reference internal" href="#doctest-options"><span class="std std-ref">Option Flags</span></a>. Only “reporting flags” can be used.</p> <p>This is a module-global setting, and affects all future doctests run by module <a class="reference internal" href="unittest#module-unittest" title="unittest: Unit testing framework for Python."><code>unittest</code></a>: the <code>runTest()</code> method of <code>DocTestCase</code> looks at the option flags specified for the test case when the <code>DocTestCase</code> instance was constructed. If no reporting flags were specified (which is the typical and expected case), <a class="reference internal" href="#module-doctest" title="doctest: Test pieces of code within docstrings."><code>doctest</code></a>’s <a class="reference internal" href="unittest#module-unittest" title="unittest: Unit testing framework for Python."><code>unittest</code></a> reporting flags are <a class="reference internal" href="https://docs.python.org/3.9/reference/expressions.html#bitwise"><span class="std std-ref">bitwise ORed</span></a> into the option flags, and the option flags so augmented are passed to the <a class="reference internal" href="#doctest.DocTestRunner" title="doctest.DocTestRunner"><code>DocTestRunner</code></a> instance created to run the doctest. If any reporting flags were specified when the <code>DocTestCase</code> instance was constructed, <a class="reference internal" href="#module-doctest" title="doctest: Test pieces of code within docstrings."><code>doctest</code></a>’s <a class="reference internal" href="unittest#module-unittest" title="unittest: Unit testing framework for Python."><code>unittest</code></a> reporting flags are ignored.</p> <p>The value of the <a class="reference internal" href="unittest#module-unittest" title="unittest: Unit testing framework for Python."><code>unittest</code></a> reporting flags in effect before the function was called is returned by the function.</p> </dd>
</dl>   <h2 id="doctest-advanced-api">Advanced API</h2> <p id="advanced-api">The basic API is a simple wrapper that’s intended to make doctest easy to use. It is fairly flexible, and should meet most users’ needs; however, if you require more fine-grained control over testing, or wish to extend doctest’s capabilities, then you should use the advanced API.</p> <p>The advanced API revolves around two container classes, which are used to store the interactive examples extracted from doctest cases:</p> <ul class="simple"> <li>
<a class="reference internal" href="#doctest.Example" title="doctest.Example"><code>Example</code></a>: A single Python <a class="reference internal" href="https://docs.python.org/3.9/glossary.html#term-statement"><span class="xref std std-term">statement</span></a>, paired with its expected output.</li> <li>
<a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><code>DocTest</code></a>: A collection of <a class="reference internal" href="#doctest.Example" title="doctest.Example"><code>Example</code></a>s, typically extracted from a single docstring or text file.</li> </ul> <p>Additional processing classes are defined to find, parse, and run, and check doctest examples:</p> <ul class="simple"> <li>
<a class="reference internal" href="#doctest.DocTestFinder" title="doctest.DocTestFinder"><code>DocTestFinder</code></a>: Finds all docstrings in a given module, and uses a <a class="reference internal" href="#doctest.DocTestParser" title="doctest.DocTestParser"><code>DocTestParser</code></a> to create a <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><code>DocTest</code></a> from every docstring that contains interactive examples.</li> <li>
<a class="reference internal" href="#doctest.DocTestParser" title="doctest.DocTestParser"><code>DocTestParser</code></a>: Creates a <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><code>DocTest</code></a> object from a string (such as an object’s docstring).</li> <li>
<a class="reference internal" href="#doctest.DocTestRunner" title="doctest.DocTestRunner"><code>DocTestRunner</code></a>: Executes the examples in a <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><code>DocTest</code></a>, and uses an <a class="reference internal" href="#doctest.OutputChecker" title="doctest.OutputChecker"><code>OutputChecker</code></a> to verify their output.</li> <li>
<a class="reference internal" href="#doctest.OutputChecker" title="doctest.OutputChecker"><code>OutputChecker</code></a>: Compares the actual output from a doctest example with the expected output, and decides whether they match.</li> </ul> <p>The relationships among these processing classes are summarized in the following diagram:</p> <pre data-language="python">                            list of:
+------+                   +---------+
|module| --DocTestFinder-&gt; | DocTest | --DocTestRunner-&gt; results
+------+    |        ^     +---------+     |       ^    (printed)
            |        |     | Example |     |       |
            v        |     |   ...   |     v       |
           DocTestParser   | Example |   OutputChecker
                           +---------+
</pre>  <h3 id="doctest-doctest">DocTest Objects</h3> <dl class="class" id="doctest-objects"> <dt id="doctest.DocTest">
<code>class doctest.DocTest(examples, globs, name, filename, lineno, docstring)</code> </dt> <dd>
<p>A collection of doctest examples that should be run in a single namespace. The constructor arguments are used to initialize the attributes of the same names.</p> <p><a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><code>DocTest</code></a> defines the following attributes. They are initialized by the constructor, and should not be modified directly.</p> <dl class="attribute"> <dt id="doctest.DocTest.examples">
<code>examples</code> </dt> <dd>
<p>A list of <a class="reference internal" href="#doctest.Example" title="doctest.Example"><code>Example</code></a> objects encoding the individual interactive Python examples that should be run by this test.</p> </dd>
</dl> <dl class="attribute"> <dt id="doctest.DocTest.globs">
<code>globs</code> </dt> <dd>
<p>The namespace (aka globals) that the examples should be run in. This is a dictionary mapping names to values. Any changes to the namespace made by the examples (such as binding new variables) will be reflected in <a class="reference internal" href="#doctest.DocTest.globs" title="doctest.DocTest.globs"><code>globs</code></a> after the test is run.</p> </dd>
</dl> <dl class="attribute"> <dt id="doctest.DocTest.name">
<code>name</code> </dt> <dd>
<p>A string name identifying the <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><code>DocTest</code></a>. Typically, this is the name of the object or file that the test was extracted from.</p> </dd>
</dl> <dl class="attribute"> <dt id="doctest.DocTest.filename">
<code>filename</code> </dt> <dd>
<p>The name of the file that this <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><code>DocTest</code></a> was extracted from; or <code>None</code> if the filename is unknown, or if the <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><code>DocTest</code></a> was not extracted from a file.</p> </dd>
</dl> <dl class="attribute"> <dt id="doctest.DocTest.lineno">
<code>lineno</code> </dt> <dd>
<p>The line number within <a class="reference internal" href="#doctest.DocTest.filename" title="doctest.DocTest.filename"><code>filename</code></a> where this <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><code>DocTest</code></a> begins, or <code>None</code> if the line number is unavailable. This line number is zero-based with respect to the beginning of the file.</p> </dd>
</dl> <dl class="attribute"> <dt id="doctest.DocTest.docstring">
<code>docstring</code> </dt> <dd>
<p>The string that the test was extracted from, or <code>None</code> if the string is unavailable, or if the test was not extracted from a string.</p> </dd>
</dl> </dd>
</dl>   <h3 id="doctest-example">Example Objects</h3> <dl class="class" id="example-objects"> <dt id="doctest.Example">
<code>class doctest.Example(source, want, exc_msg=None, lineno=0, indent=0, options=None)</code> </dt> <dd>
<p>A single interactive example, consisting of a Python statement and its expected output. The constructor arguments are used to initialize the attributes of the same names.</p> <p><a class="reference internal" href="#doctest.Example" title="doctest.Example"><code>Example</code></a> defines the following attributes. They are initialized by the constructor, and should not be modified directly.</p> <dl class="attribute"> <dt id="doctest.Example.source">
<code>source</code> </dt> <dd>
<p>A string containing the example’s source code. This source code consists of a single Python statement, and always ends with a newline; the constructor adds a newline when necessary.</p> </dd>
</dl> <dl class="attribute"> <dt id="doctest.Example.want">
<code>want</code> </dt> <dd>
<p>The expected output from running the example’s source code (either from stdout, or a traceback in case of exception). <a class="reference internal" href="#doctest.Example.want" title="doctest.Example.want"><code>want</code></a> ends with a newline unless no output is expected, in which case it’s an empty string. The constructor adds a newline when necessary.</p> </dd>
</dl> <dl class="attribute"> <dt id="doctest.Example.exc_msg">
<code>exc_msg</code> </dt> <dd>
<p>The exception message generated by the example, if the example is expected to generate an exception; or <code>None</code> if it is not expected to generate an exception. This exception message is compared against the return value of <a class="reference internal" href="traceback#traceback.format_exception_only" title="traceback.format_exception_only"><code>traceback.format_exception_only()</code></a>. <a class="reference internal" href="#doctest.Example.exc_msg" title="doctest.Example.exc_msg"><code>exc_msg</code></a> ends with a newline unless it’s <code>None</code>. The constructor adds a newline if needed.</p> </dd>
</dl> <dl class="attribute"> <dt id="doctest.Example.lineno">
<code>lineno</code> </dt> <dd>
<p>The line number within the string containing this example where the example begins. This line number is zero-based with respect to the beginning of the containing string.</p> </dd>
</dl> <dl class="attribute"> <dt id="doctest.Example.indent">
<code>indent</code> </dt> <dd>
<p>The example’s indentation in the containing string, i.e., the number of space characters that precede the example’s first prompt.</p> </dd>
</dl> <dl class="attribute"> <dt id="doctest.Example.options">
<code>options</code> </dt> <dd>
<p>A dictionary mapping from option flags to <code>True</code> or <code>False</code>, which is used to override default options for this example. Any option flags not contained in this dictionary are left at their default value (as specified by the <a class="reference internal" href="#doctest.DocTestRunner" title="doctest.DocTestRunner"><code>DocTestRunner</code></a>’s <code>optionflags</code>). By default, no options are set.</p> </dd>
</dl> </dd>
</dl>   <h3 id="doctest-doctestfinder">DocTestFinder objects</h3> <dl class="class" id="doctestfinder-objects"> <dt id="doctest.DocTestFinder">
<code>class doctest.DocTestFinder(verbose=False, parser=DocTestParser(), recurse=True, exclude_empty=True)</code> </dt> <dd>
<p>A processing class used to extract the <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><code>DocTest</code></a>s that are relevant to a given object, from its docstring and the docstrings of its contained objects. <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><code>DocTest</code></a>s can be extracted from modules, classes, functions, methods, staticmethods, classmethods, and properties.</p> <p>The optional argument <em>verbose</em> can be used to display the objects searched by the finder. It defaults to <code>False</code> (no output).</p> <p>The optional argument <em>parser</em> specifies the <a class="reference internal" href="#doctest.DocTestParser" title="doctest.DocTestParser"><code>DocTestParser</code></a> object (or a drop-in replacement) that is used to extract doctests from docstrings.</p> <p>If the optional argument <em>recurse</em> is false, then <a class="reference internal" href="#doctest.DocTestFinder.find" title="doctest.DocTestFinder.find"><code>DocTestFinder.find()</code></a> will only examine the given object, and not any contained objects.</p> <p>If the optional argument <em>exclude_empty</em> is false, then <a class="reference internal" href="#doctest.DocTestFinder.find" title="doctest.DocTestFinder.find"><code>DocTestFinder.find()</code></a> will include tests for objects with empty docstrings.</p> <p><a class="reference internal" href="#doctest.DocTestFinder" title="doctest.DocTestFinder"><code>DocTestFinder</code></a> defines the following method:</p> <dl class="method"> <dt id="doctest.DocTestFinder.find">
<code>find(obj[, name][, module][, globs][, extraglobs])</code> </dt> <dd>
<p>Return a list of the <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><code>DocTest</code></a>s that are defined by <em>obj</em>’s docstring, or by any of its contained objects’ docstrings.</p> <p>The optional argument <em>name</em> specifies the object’s name; this name will be used to construct names for the returned <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><code>DocTest</code></a>s. If <em>name</em> is not specified, then <code>obj.__name__</code> is used.</p> <p>The optional parameter <em>module</em> is the module that contains the given object. If the module is not specified or is <code>None</code>, then the test finder will attempt to automatically determine the correct module. The object’s module is used:</p> <ul class="simple"> <li>As a default namespace, if <em>globs</em> is not specified.</li> <li>To prevent the DocTestFinder from extracting DocTests from objects that are imported from other modules. (Contained objects with modules other than <em>module</em> are ignored.)</li> <li>To find the name of the file containing the object.</li> <li>To help find the line number of the object within its file.</li> </ul> <p>If <em>module</em> is <code>False</code>, no attempt to find the module will be made. This is obscure, of use mostly in testing doctest itself: if <em>module</em> is <code>False</code>, or is <code>None</code> but cannot be found automatically, then all objects are considered to belong to the (non-existent) module, so all contained objects will (recursively) be searched for doctests.</p> <p>The globals for each <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><code>DocTest</code></a> is formed by combining <em>globs</em> and <em>extraglobs</em> (bindings in <em>extraglobs</em> override bindings in <em>globs</em>). A new shallow copy of the globals dictionary is created for each <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><code>DocTest</code></a>. If <em>globs</em> is not specified, then it defaults to the module’s <em>__dict__</em>, if specified, or <code>{}</code> otherwise. If <em>extraglobs</em> is not specified, then it defaults to <code>{}</code>.</p> </dd>
</dl> </dd>
</dl>   <h3 id="doctest-doctestparser">DocTestParser objects</h3> <dl class="class" id="doctestparser-objects"> <dt id="doctest.DocTestParser">
<code>class doctest.DocTestParser</code> </dt> <dd>
<p>A processing class used to extract interactive examples from a string, and use them to create a <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><code>DocTest</code></a> object.</p> <p><a class="reference internal" href="#doctest.DocTestParser" title="doctest.DocTestParser"><code>DocTestParser</code></a> defines the following methods:</p> <dl class="method"> <dt id="doctest.DocTestParser.get_doctest">
<code>get_doctest(string, globs, name, filename, lineno)</code> </dt> <dd>
<p>Extract all doctest examples from the given string, and collect them into a <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><code>DocTest</code></a> object.</p> <p><em>globs</em>, <em>name</em>, <em>filename</em>, and <em>lineno</em> are attributes for the new <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><code>DocTest</code></a> object. See the documentation for <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><code>DocTest</code></a> for more information.</p> </dd>
</dl> <dl class="method"> <dt id="doctest.DocTestParser.get_examples">
<code>get_examples(string, name='&lt;string&gt;')</code> </dt> <dd>
<p>Extract all doctest examples from the given string, and return them as a list of <a class="reference internal" href="#doctest.Example" title="doctest.Example"><code>Example</code></a> objects. Line numbers are 0-based. The optional argument <em>name</em> is a name identifying this string, and is only used for error messages.</p> </dd>
</dl> <dl class="method"> <dt id="doctest.DocTestParser.parse">
<code>parse(string, name='&lt;string&gt;')</code> </dt> <dd>
<p>Divide the given string into examples and intervening text, and return them as a list of alternating <a class="reference internal" href="#doctest.Example" title="doctest.Example"><code>Example</code></a>s and strings. Line numbers for the <a class="reference internal" href="#doctest.Example" title="doctest.Example"><code>Example</code></a>s are 0-based. The optional argument <em>name</em> is a name identifying this string, and is only used for error messages.</p> </dd>
</dl> </dd>
</dl>   <h3 id="doctest-doctestrunner">DocTestRunner objects</h3> <dl class="class" id="doctestrunner-objects"> <dt id="doctest.DocTestRunner">
<code>class doctest.DocTestRunner(checker=None, verbose=None, optionflags=0)</code> </dt> <dd>
<p>A processing class used to execute and verify the interactive examples in a <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><code>DocTest</code></a>.</p> <p>The comparison between expected outputs and actual outputs is done by an <a class="reference internal" href="#doctest.OutputChecker" title="doctest.OutputChecker"><code>OutputChecker</code></a>. This comparison may be customized with a number of option flags; see section <a class="reference internal" href="#doctest-options"><span class="std std-ref">Option Flags</span></a> for more information. If the option flags are insufficient, then the comparison may also be customized by passing a subclass of <a class="reference internal" href="#doctest.OutputChecker" title="doctest.OutputChecker"><code>OutputChecker</code></a> to the constructor.</p> <p>The test runner’s display output can be controlled in two ways. First, an output function can be passed to <code>TestRunner.run()</code>; this function will be called with strings that should be displayed. It defaults to <code>sys.stdout.write</code>. If capturing the output is not sufficient, then the display output can be also customized by subclassing DocTestRunner, and overriding the methods <a class="reference internal" href="#doctest.DocTestRunner.report_start" title="doctest.DocTestRunner.report_start"><code>report_start()</code></a>, <a class="reference internal" href="#doctest.DocTestRunner.report_success" title="doctest.DocTestRunner.report_success"><code>report_success()</code></a>, <a class="reference internal" href="#doctest.DocTestRunner.report_unexpected_exception" title="doctest.DocTestRunner.report_unexpected_exception"><code>report_unexpected_exception()</code></a>, and <a class="reference internal" href="#doctest.DocTestRunner.report_failure" title="doctest.DocTestRunner.report_failure"><code>report_failure()</code></a>.</p> <p>The optional keyword argument <em>checker</em> specifies the <a class="reference internal" href="#doctest.OutputChecker" title="doctest.OutputChecker"><code>OutputChecker</code></a> object (or drop-in replacement) that should be used to compare the expected outputs to the actual outputs of doctest examples.</p> <p>The optional keyword argument <em>verbose</em> controls the <a class="reference internal" href="#doctest.DocTestRunner" title="doctest.DocTestRunner"><code>DocTestRunner</code></a>’s verbosity. If <em>verbose</em> is <code>True</code>, then information is printed about each example, as it is run. If <em>verbose</em> is <code>False</code>, then only failures are printed. If <em>verbose</em> is unspecified, or <code>None</code>, then verbose output is used iff the command-line switch <code>-v</code> is used.</p> <p>The optional keyword argument <em>optionflags</em> can be used to control how the test runner compares expected output to actual output, and how it displays failures. For more information, see section <a class="reference internal" href="#doctest-options"><span class="std std-ref">Option Flags</span></a>.</p> <p><a class="reference internal" href="#doctest.DocTestParser" title="doctest.DocTestParser"><code>DocTestParser</code></a> defines the following methods:</p> <dl class="method"> <dt id="doctest.DocTestRunner.report_start">
<code>report_start(out, test, example)</code> </dt> <dd>
<p>Report that the test runner is about to process the given example. This method is provided to allow subclasses of <a class="reference internal" href="#doctest.DocTestRunner" title="doctest.DocTestRunner"><code>DocTestRunner</code></a> to customize their output; it should not be called directly.</p> <p><em>example</em> is the example about to be processed. <em>test</em> is the test <em>containing example</em>. <em>out</em> is the output function that was passed to <a class="reference internal" href="#doctest.DocTestRunner.run" title="doctest.DocTestRunner.run"><code>DocTestRunner.run()</code></a>.</p> </dd>
</dl> <dl class="method"> <dt id="doctest.DocTestRunner.report_success">
<code>report_success(out, test, example, got)</code> </dt> <dd>
<p>Report that the given example ran successfully. This method is provided to allow subclasses of <a class="reference internal" href="#doctest.DocTestRunner" title="doctest.DocTestRunner"><code>DocTestRunner</code></a> to customize their output; it should not be called directly.</p> <p><em>example</em> is the example about to be processed. <em>got</em> is the actual output from the example. <em>test</em> is the test containing <em>example</em>. <em>out</em> is the output function that was passed to <a class="reference internal" href="#doctest.DocTestRunner.run" title="doctest.DocTestRunner.run"><code>DocTestRunner.run()</code></a>.</p> </dd>
</dl> <dl class="method"> <dt id="doctest.DocTestRunner.report_failure">
<code>report_failure(out, test, example, got)</code> </dt> <dd>
<p>Report that the given example failed. This method is provided to allow subclasses of <a class="reference internal" href="#doctest.DocTestRunner" title="doctest.DocTestRunner"><code>DocTestRunner</code></a> to customize their output; it should not be called directly.</p> <p><em>example</em> is the example about to be processed. <em>got</em> is the actual output from the example. <em>test</em> is the test containing <em>example</em>. <em>out</em> is the output function that was passed to <a class="reference internal" href="#doctest.DocTestRunner.run" title="doctest.DocTestRunner.run"><code>DocTestRunner.run()</code></a>.</p> </dd>
</dl> <dl class="method"> <dt id="doctest.DocTestRunner.report_unexpected_exception">
<code>report_unexpected_exception(out, test, example, exc_info)</code> </dt> <dd>
<p>Report that the given example raised an unexpected exception. This method is provided to allow subclasses of <a class="reference internal" href="#doctest.DocTestRunner" title="doctest.DocTestRunner"><code>DocTestRunner</code></a> to customize their output; it should not be called directly.</p> <p><em>example</em> is the example about to be processed. <em>exc_info</em> is a tuple containing information about the unexpected exception (as returned by <a class="reference internal" href="sys#sys.exc_info" title="sys.exc_info"><code>sys.exc_info()</code></a>). <em>test</em> is the test containing <em>example</em>. <em>out</em> is the output function that was passed to <a class="reference internal" href="#doctest.DocTestRunner.run" title="doctest.DocTestRunner.run"><code>DocTestRunner.run()</code></a>.</p> </dd>
</dl> <dl class="method"> <dt id="doctest.DocTestRunner.run">
<code>run(test, compileflags=None, out=None, clear_globs=True)</code> </dt> <dd>
<p>Run the examples in <em>test</em> (a <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><code>DocTest</code></a> object), and display the results using the writer function <em>out</em>.</p> <p>The examples are run in the namespace <code>test.globs</code>. If <em>clear_globs</em> is true (the default), then this namespace will be cleared after the test runs, to help with garbage collection. If you would like to examine the namespace after the test completes, then use <em>clear_globs=False</em>.</p> <p><em>compileflags</em> gives the set of flags that should be used by the Python compiler when running the examples. If not specified, then it will default to the set of future-import flags that apply to <em>globs</em>.</p> <p>The output of each example is checked using the <a class="reference internal" href="#doctest.DocTestRunner" title="doctest.DocTestRunner"><code>DocTestRunner</code></a>’s output checker, and the results are formatted by the <code>DocTestRunner.report_*()</code> methods.</p> </dd>
</dl> <dl class="method"> <dt id="doctest.DocTestRunner.summarize">
<code>summarize(verbose=None)</code> </dt> <dd>
<p>Print a summary of all the test cases that have been run by this DocTestRunner, and return a <a class="reference internal" href="https://docs.python.org/3.9/glossary.html#term-named-tuple"><span class="xref std std-term">named tuple</span></a> <code>TestResults(failed, attempted)</code>.</p> <p>The optional <em>verbose</em> argument controls how detailed the summary is. If the verbosity is not specified, then the <a class="reference internal" href="#doctest.DocTestRunner" title="doctest.DocTestRunner"><code>DocTestRunner</code></a>’s verbosity is used.</p> </dd>
</dl> </dd>
</dl>   <h3 id="doctest-outputchecker">OutputChecker objects</h3> <dl class="class" id="outputchecker-objects"> <dt id="doctest.OutputChecker">
<code>class doctest.OutputChecker</code> </dt> <dd>
<p>A class used to check the whether the actual output from a doctest example matches the expected output. <a class="reference internal" href="#doctest.OutputChecker" title="doctest.OutputChecker"><code>OutputChecker</code></a> defines two methods: <a class="reference internal" href="#doctest.OutputChecker.check_output" title="doctest.OutputChecker.check_output"><code>check_output()</code></a>, which compares a given pair of outputs, and returns <code>True</code> if they match; and <a class="reference internal" href="#doctest.OutputChecker.output_difference" title="doctest.OutputChecker.output_difference"><code>output_difference()</code></a>, which returns a string describing the differences between two outputs.</p> <p><a class="reference internal" href="#doctest.OutputChecker" title="doctest.OutputChecker"><code>OutputChecker</code></a> defines the following methods:</p> <dl class="method"> <dt id="doctest.OutputChecker.check_output">
<code>check_output(want, got, optionflags)</code> </dt> <dd>
<p>Return <code>True</code> iff the actual output from an example (<em>got</em>) matches the expected output (<em>want</em>). These strings are always considered to match if they are identical; but depending on what option flags the test runner is using, several non-exact match types are also possible. See section <a class="reference internal" href="#doctest-options"><span class="std std-ref">Option Flags</span></a> for more information about option flags.</p> </dd>
</dl> <dl class="method"> <dt id="doctest.OutputChecker.output_difference">
<code>output_difference(example, got, optionflags)</code> </dt> <dd>
<p>Return a string describing the differences between the expected output for a given example (<em>example</em>) and the actual output (<em>got</em>). <em>optionflags</em> is the set of option flags used to compare <em>want</em> and <em>got</em>.</p> </dd>
</dl> </dd>
</dl>    <h2 id="doctest-debugging">Debugging</h2> <p id="debugging">Doctest provides several mechanisms for debugging doctest examples:</p> <ul> <li>Several functions convert doctests to executable Python programs, which can be run under the Python debugger, <a class="reference internal" href="pdb#module-pdb" title="pdb: The Python debugger for interactive interpreters."><code>pdb</code></a>.</li> <li>The <a class="reference internal" href="#doctest.DebugRunner" title="doctest.DebugRunner"><code>DebugRunner</code></a> class is a subclass of <a class="reference internal" href="#doctest.DocTestRunner" title="doctest.DocTestRunner"><code>DocTestRunner</code></a> that raises an exception for the first failing example, containing information about that example. This information can be used to perform post-mortem debugging on the example.</li> <li>The <a class="reference internal" href="unittest#module-unittest" title="unittest: Unit testing framework for Python."><code>unittest</code></a> cases generated by <a class="reference internal" href="#doctest.DocTestSuite" title="doctest.DocTestSuite"><code>DocTestSuite()</code></a> support the <a class="reference internal" href="#doctest.debug" title="doctest.debug"><code>debug()</code></a> method defined by <a class="reference internal" href="unittest#unittest.TestCase" title="unittest.TestCase"><code>unittest.TestCase</code></a>.</li> <li>
<p>You can add a call to <a class="reference internal" href="pdb#pdb.set_trace" title="pdb.set_trace"><code>pdb.set_trace()</code></a> in a doctest example, and you’ll drop into the Python debugger when that line is executed. Then you can inspect current values of variables, and so on. For example, suppose <code>a.py</code> contains just this module docstring:</p> <pre data-language="python">"""
&gt;&gt;&gt; def f(x):
...     g(x*2)
&gt;&gt;&gt; def g(x):
...     print(x+3)
...     import pdb; pdb.set_trace()
&gt;&gt;&gt; f(3)
9
"""
</pre> <p>Then an interactive Python session may look like this:</p> <pre data-language="python">&gt;&gt;&gt; import a, doctest
&gt;&gt;&gt; doctest.testmod(a)
--Return--
&gt; &lt;doctest a[1]&gt;(3)g()-&gt;None
-&gt; import pdb; pdb.set_trace()
(Pdb) list
  1     def g(x):
  2         print(x+3)
  3  -&gt;     import pdb; pdb.set_trace()
[EOF]
(Pdb) p x
6
(Pdb) step
--Return--
&gt; &lt;doctest a[0]&gt;(2)f()-&gt;None
-&gt; g(x*2)
(Pdb) list
  1     def f(x):
  2  -&gt;     g(x*2)
[EOF]
(Pdb) p x
3
(Pdb) step
--Return--
&gt; &lt;doctest a[2]&gt;(1)?()-&gt;None
-&gt; f(3)
(Pdb) cont
(0, 3)
&gt;&gt;&gt;
</pre> </li> </ul> <p>Functions that convert doctests to Python code, and possibly run the synthesized code under the debugger:</p> <dl class="function"> <dt id="doctest.script_from_examples">
<code>doctest.script_from_examples(s)</code> </dt> <dd>
<p>Convert text with examples to a script.</p> <p>Argument <em>s</em> is a string containing doctest examples. The string is converted to a Python script, where doctest examples in <em>s</em> are converted to regular code, and everything else is converted to Python comments. The generated script is returned as a string. For example,</p> <pre data-language="python">import doctest
print(doctest.script_from_examples(r"""
    Set x and y to 1 and 2.
    &gt;&gt;&gt; x, y = 1, 2

    Print their sum:
    &gt;&gt;&gt; print(x+y)
    3
"""))
</pre> <p>displays:</p> <pre data-language="python"># Set x and y to 1 and 2.
x, y = 1, 2
#
# Print their sum:
print(x+y)
# Expected:
## 3
</pre> <p>This function is used internally by other functions (see below), but can also be useful when you want to transform an interactive Python session into a Python script.</p> </dd>
</dl> <dl class="function"> <dt id="doctest.testsource">
<code>doctest.testsource(module, name)</code> </dt> <dd>
<p>Convert the doctest for an object to a script.</p> <p>Argument <em>module</em> is a module object, or dotted name of a module, containing the object whose doctests are of interest. Argument <em>name</em> is the name (within the module) of the object with the doctests of interest. The result is a string, containing the object’s docstring converted to a Python script, as described for <a class="reference internal" href="#doctest.script_from_examples" title="doctest.script_from_examples"><code>script_from_examples()</code></a> above. For example, if module <code>a.py</code> contains a top-level function <code>f()</code>, then</p> <pre data-language="python">import a, doctest
print(doctest.testsource(a, "a.f"))
</pre> <p>prints a script version of function <code>f()</code>’s docstring, with doctests converted to code, and the rest placed in comments.</p> </dd>
</dl> <dl class="function"> <dt id="doctest.debug">
<code>doctest.debug(module, name, pm=False)</code> </dt> <dd>
<p>Debug the doctests for an object.</p> <p>The <em>module</em> and <em>name</em> arguments are the same as for function <a class="reference internal" href="#doctest.testsource" title="doctest.testsource"><code>testsource()</code></a> above. The synthesized Python script for the named object’s docstring is written to a temporary file, and then that file is run under the control of the Python debugger, <a class="reference internal" href="pdb#module-pdb" title="pdb: The Python debugger for interactive interpreters."><code>pdb</code></a>.</p> <p>A shallow copy of <code>module.__dict__</code> is used for both local and global execution context.</p> <p>Optional argument <em>pm</em> controls whether post-mortem debugging is used. If <em>pm</em> has a true value, the script file is run directly, and the debugger gets involved only if the script terminates via raising an unhandled exception. If it does, then post-mortem debugging is invoked, via <a class="reference internal" href="pdb#pdb.post_mortem" title="pdb.post_mortem"><code>pdb.post_mortem()</code></a>, passing the traceback object from the unhandled exception. If <em>pm</em> is not specified, or is false, the script is run under the debugger from the start, via passing an appropriate <a class="reference internal" href="functions#exec" title="exec"><code>exec()</code></a> call to <a class="reference internal" href="pdb#pdb.run" title="pdb.run"><code>pdb.run()</code></a>.</p> </dd>
</dl> <dl class="function"> <dt id="doctest.debug_src">
<code>doctest.debug_src(src, pm=False, globs=None)</code> </dt> <dd>
<p>Debug the doctests in a string.</p> <p>This is like function <a class="reference internal" href="#doctest.debug" title="doctest.debug"><code>debug()</code></a> above, except that a string containing doctest examples is specified directly, via the <em>src</em> argument.</p> <p>Optional argument <em>pm</em> has the same meaning as in function <a class="reference internal" href="#doctest.debug" title="doctest.debug"><code>debug()</code></a> above.</p> <p>Optional argument <em>globs</em> gives a dictionary to use as both local and global execution context. If not specified, or <code>None</code>, an empty dictionary is used. If specified, a shallow copy of the dictionary is used.</p> </dd>
</dl> <p>The <a class="reference internal" href="#doctest.DebugRunner" title="doctest.DebugRunner"><code>DebugRunner</code></a> class, and the special exceptions it may raise, are of most interest to testing framework authors, and will only be sketched here. See the source code, and especially <a class="reference internal" href="#doctest.DebugRunner" title="doctest.DebugRunner"><code>DebugRunner</code></a>’s docstring (which is a doctest!) for more details:</p> <dl class="class"> <dt id="doctest.DebugRunner">
<code>class doctest.DebugRunner(checker=None, verbose=None, optionflags=0)</code> </dt> <dd>
<p>A subclass of <a class="reference internal" href="#doctest.DocTestRunner" title="doctest.DocTestRunner"><code>DocTestRunner</code></a> that raises an exception as soon as a failure is encountered. If an unexpected exception occurs, an <a class="reference internal" href="#doctest.UnexpectedException" title="doctest.UnexpectedException"><code>UnexpectedException</code></a> exception is raised, containing the test, the example, and the original exception. If the output doesn’t match, then a <a class="reference internal" href="#doctest.DocTestFailure" title="doctest.DocTestFailure"><code>DocTestFailure</code></a> exception is raised, containing the test, the example, and the actual output.</p> <p>For information about the constructor parameters and methods, see the documentation for <a class="reference internal" href="#doctest.DocTestRunner" title="doctest.DocTestRunner"><code>DocTestRunner</code></a> in section <a class="reference internal" href="#doctest-advanced-api"><span class="std std-ref">Advanced API</span></a>.</p> </dd>
</dl> <p>There are two exceptions that may be raised by <a class="reference internal" href="#doctest.DebugRunner" title="doctest.DebugRunner"><code>DebugRunner</code></a> instances:</p> <dl class="exception"> <dt id="doctest.DocTestFailure">
<code>exception doctest.DocTestFailure(test, example, got)</code> </dt> <dd>
<p>An exception raised by <a class="reference internal" href="#doctest.DocTestRunner" title="doctest.DocTestRunner"><code>DocTestRunner</code></a> to signal that a doctest example’s actual output did not match its expected output. The constructor arguments are used to initialize the attributes of the same names.</p> </dd>
</dl> <p><a class="reference internal" href="#doctest.DocTestFailure" title="doctest.DocTestFailure"><code>DocTestFailure</code></a> defines the following attributes:</p> <dl class="attribute"> <dt id="doctest.DocTestFailure.test">
<code>DocTestFailure.test</code> </dt> <dd>
<p>The <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><code>DocTest</code></a> object that was being run when the example failed.</p> </dd>
</dl> <dl class="attribute"> <dt id="doctest.DocTestFailure.example">
<code>DocTestFailure.example</code> </dt> <dd>
<p>The <a class="reference internal" href="#doctest.Example" title="doctest.Example"><code>Example</code></a> that failed.</p> </dd>
</dl> <dl class="attribute"> <dt id="doctest.DocTestFailure.got">
<code>DocTestFailure.got</code> </dt> <dd>
<p>The example’s actual output.</p> </dd>
</dl> <dl class="exception"> <dt id="doctest.UnexpectedException">
<code>exception doctest.UnexpectedException(test, example, exc_info)</code> </dt> <dd>
<p>An exception raised by <a class="reference internal" href="#doctest.DocTestRunner" title="doctest.DocTestRunner"><code>DocTestRunner</code></a> to signal that a doctest example raised an unexpected exception. The constructor arguments are used to initialize the attributes of the same names.</p> </dd>
</dl> <p><a class="reference internal" href="#doctest.UnexpectedException" title="doctest.UnexpectedException"><code>UnexpectedException</code></a> defines the following attributes:</p> <dl class="attribute"> <dt id="doctest.UnexpectedException.test">
<code>UnexpectedException.test</code> </dt> <dd>
<p>The <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><code>DocTest</code></a> object that was being run when the example failed.</p> </dd>
</dl> <dl class="attribute"> <dt id="doctest.UnexpectedException.example">
<code>UnexpectedException.example</code> </dt> <dd>
<p>The <a class="reference internal" href="#doctest.Example" title="doctest.Example"><code>Example</code></a> that failed.</p> </dd>
</dl> <dl class="attribute"> <dt id="doctest.UnexpectedException.exc_info">
<code>UnexpectedException.exc_info</code> </dt> <dd>
<p>A tuple containing information about the unexpected exception, as returned by <a class="reference internal" href="sys#sys.exc_info" title="sys.exc_info"><code>sys.exc_info()</code></a>.</p> </dd>
</dl>   <h2 id="doctest-soapbox">Soapbox</h2> <p id="soapbox">As mentioned in the introduction, <a class="reference internal" href="#module-doctest" title="doctest: Test pieces of code within docstrings."><code>doctest</code></a> has grown to have three primary uses:</p> <ol class="arabic simple"> <li>Checking examples in docstrings.</li> <li>Regression testing.</li> <li>Executable documentation / literate testing.</li> </ol> <p>These uses have different requirements, and it is important to distinguish them. In particular, filling your docstrings with obscure test cases makes for bad documentation.</p> <p>When writing a docstring, choose docstring examples with care. There’s an art to this that needs to be learned—it may not be natural at first. Examples should add genuine value to the documentation. A good example can often be worth many words. If done with care, the examples will be invaluable for your users, and will pay back the time it takes to collect them many times over as the years go by and things change. I’m still amazed at how often one of my <a class="reference internal" href="#module-doctest" title="doctest: Test pieces of code within docstrings."><code>doctest</code></a> examples stops working after a “harmless” change.</p> <p>Doctest also makes an excellent tool for regression testing, especially if you don’t skimp on explanatory text. By interleaving prose and examples, it becomes much easier to keep track of what’s actually being tested, and why. When a test fails, good prose can make it much easier to figure out what the problem is, and how it should be fixed. It’s true that you could write extensive comments in code-based testing, but few programmers do. Many have found that using doctest approaches instead leads to much clearer tests. Perhaps this is simply because doctest makes writing prose a little easier than writing code, while writing comments in code is a little harder. I think it goes deeper than just that: the natural attitude when writing a doctest-based test is that you want to explain the fine points of your software, and illustrate them with examples. This in turn naturally leads to test files that start with the simplest features, and logically progress to complications and edge cases. A coherent narrative is the result, instead of a collection of isolated functions that test isolated bits of functionality seemingly at random. It’s a different attitude, and produces different results, blurring the distinction between testing and explaining.</p> <p>Regression testing is best confined to dedicated objects or files. There are several options for organizing tests:</p> <ul class="simple"> <li>Write text files containing test cases as interactive examples, and test the files using <a class="reference internal" href="#doctest.testfile" title="doctest.testfile"><code>testfile()</code></a> or <a class="reference internal" href="#doctest.DocFileSuite" title="doctest.DocFileSuite"><code>DocFileSuite()</code></a>. This is recommended, although is easiest to do for new projects, designed from the start to use doctest.</li> <li>Define functions named <code>_regrtest_topic</code> that consist of single docstrings, containing test cases for the named topics. These functions can be included in the same file as the module, or separated out into a separate test file.</li> <li>Define a <code>__test__</code> dictionary mapping from regression test topics to docstrings containing test cases.</li> </ul> <p>When you have placed your tests in a module, the module can itself be the test runner. When a test fails, you can arrange for your test runner to re-run only the failing doctest while you debug the problem. Here is a minimal example of such a test runner:</p> <pre data-language="python">if __name__ == '__main__':
    import doctest
    flags = doctest.REPORT_NDIFF|doctest.FAIL_FAST
    if len(sys.argv) &gt; 1:
        name = sys.argv[1]
        if name in globals():
            obj = globals()[name]
        else:
            obj = __test__[name]
        doctest.run_docstring_examples(obj, globals(), name=name,
                                       optionflags=flags)
    else:
        fail, total = doctest.testmod(optionflags=flags)
        print("{} failures out of {} tests".format(fail, total))
</pre> <h4 class="rubric">Footnotes</h4> <dl class="footnote brackets"> <dt class="label" id="id2">
<code>1</code> </dt> <dd>
<p>Examples containing both expected output and an exception are not supported. Trying to guess where one ends and the other begins is too error-prone, and that also makes for a confusing test.</p> </dd> </dl><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2001&ndash;2021 Python Software Foundation<br>Licensed under the PSF License.<br>
    <a href="https://docs.python.org/3.9/library/doctest.html" class="_attribution-link">https://docs.python.org/3.9/library/doctest.html</a>
  </p>
</div>
