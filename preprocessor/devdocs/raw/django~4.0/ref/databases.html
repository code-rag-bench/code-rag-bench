<h1 id="databases">Databases</h1> <p id="s-databases">Django officially supports the following databases:</p> <ul class="simple"> <li><a class="reference internal" href="#postgresql-notes"><span class="std std-ref">PostgreSQL</span></a></li> <li><a class="reference internal" href="#mariadb-notes"><span class="std std-ref">MariaDB</span></a></li> <li><a class="reference internal" href="#mysql-notes"><span class="std std-ref">MySQL</span></a></li> <li><a class="reference internal" href="#oracle-notes"><span class="std std-ref">Oracle</span></a></li> <li><a class="reference internal" href="#sqlite-notes"><span class="std std-ref">SQLite</span></a></li> </ul> <p>There are also a number of <a class="reference internal" href="#third-party-notes"><span class="std std-ref">database backends provided by third parties</span></a>.</p> <p>Django attempts to support as many features as possible on all database backends. However, not all database backends are alike, and we’ve had to make design decisions on which features to support and which assumptions we can make safely.</p> <p>This file describes some of the features that might be relevant to Django usage. It is not intended as a replacement for server-specific documentation or reference manuals.</p>  <h2 id="general-notes">General notes</h2>  <h3 id="persistent-database-connections">Persistent connections</h3> <p id="s-general-notes">Persistent connections avoid the overhead of re-establishing a connection to the database in each request. They’re controlled by the <a class="reference internal" href="settings#std:setting-CONN_MAX_AGE"><code>CONN_MAX_AGE</code></a> parameter which defines the maximum lifetime of a connection. It can be set independently for each database.</p> <p>The default value is <code>0</code>, preserving the historical behavior of closing the database connection at the end of each request. To enable persistent connections, set <a class="reference internal" href="settings#std:setting-CONN_MAX_AGE"><code>CONN_MAX_AGE</code></a> to a positive integer of seconds. For unlimited persistent connections, set it to <code>None</code>.</p>  <h4 id="connection-management">Connection management</h4> <p id="s-connection-management">Django opens a connection to the database when it first makes a database query. It keeps this connection open and reuses it in subsequent requests. Django closes the connection once it exceeds the maximum age defined by <a class="reference internal" href="settings#std:setting-CONN_MAX_AGE"><code>CONN_MAX_AGE</code></a> or when it isn’t usable any longer.</p> <p>In detail, Django automatically opens a connection to the database whenever it needs one and doesn’t have one already — either because this is the first connection, or because the previous connection was closed.</p> <p>At the beginning of each request, Django closes the connection if it has reached its maximum age. If your database terminates idle connections after some time, you should set <a class="reference internal" href="settings#std:setting-CONN_MAX_AGE"><code>CONN_MAX_AGE</code></a> to a lower value, so that Django doesn’t attempt to use a connection that has been terminated by the database server. (This problem may only affect very low traffic sites.)</p> <p>At the end of each request, Django closes the connection if it has reached its maximum age or if it is in an unrecoverable error state. If any database errors have occurred while processing the requests, Django checks whether the connection still works, and closes it if it doesn’t. Thus, database errors affect at most one request; if the connection becomes unusable, the next request gets a fresh connection.</p>   <h4 id="caveats">Caveats</h4> <p id="s-caveats">Since each thread maintains its own connection, your database must support at least as many simultaneous connections as you have worker threads.</p> <p>Sometimes a database won’t be accessed by the majority of your views, for example because it’s the database of an external system, or thanks to caching. In such cases, you should set <a class="reference internal" href="settings#std:setting-CONN_MAX_AGE"><code>CONN_MAX_AGE</code></a> to a low value or even <code>0</code>, because it doesn’t make sense to maintain a connection that’s unlikely to be reused. This will help keep the number of simultaneous connections to this database small.</p> <p>The development server creates a new thread for each request it handles, negating the effect of persistent connections. Don’t enable them during development.</p> <p>When Django establishes a connection to the database, it sets up appropriate parameters, depending on the backend being used. If you enable persistent connections, this setup is no longer repeated every request. If you modify parameters such as the connection’s isolation level or time zone, you should either restore Django’s defaults at the end of each request, force an appropriate value at the beginning of each request, or disable persistent connections.</p>    <h3 id="encoding">Encoding</h3> <p id="s-encoding">Django assumes that all databases use UTF-8 encoding. Using other encodings may result in unexpected behavior such as “value too long” errors from your database for data that is valid in Django. See the database specific notes below for information on how to set up your database correctly.</p>    <h2 id="id1">PostgreSQL notes</h2> <p id="s-postgresql-notes">Django supports PostgreSQL 10 and higher. <a class="reference external" href="https://www.psycopg.org/">psycopg2</a> 2.5.4 or higher is required, though the latest release is recommended.</p>  <h3 id="id2">PostgreSQL connection settings</h3> <p id="s-postgresql-connection-settings">See <a class="reference internal" href="settings#std:setting-HOST"><code>HOST</code></a> for details.</p> <p>To connect using a service name from the <a class="reference external" href="https://www.postgresql.org/docs/current/libpq-pgservice.html">connection service file</a> and a password from the <a class="reference external" href="https://www.postgresql.org/docs/current/libpq-pgpass.html">password file</a>, you must specify them in the <a class="reference internal" href="settings#std:setting-OPTIONS"><code>OPTIONS</code></a> part of your database configuration in <a class="reference internal" href="settings#std:setting-DATABASES"><code>DATABASES</code></a>:</p> <div class="literal-block-wrapper docutils container" id="id16"> <div class="code-block-caption"><span class="caption-text">settings.py</span></div> <pre data-language="python">DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'OPTIONS': {
            'service': 'my_service',
            'passfile': '.my_pgpass',
        },
    }
}
</pre> </div> <div class="literal-block-wrapper docutils container" id="id17"> <div class="code-block-caption"><span class="caption-text">.pg_service.conf</span></div> <pre data-language="text">[my_service]
host=localhost
user=USER
dbname=NAME
port=5432
</pre> </div> <div class="literal-block-wrapper docutils container" id="id18"> <div class="code-block-caption"><span class="caption-text">.my_pgpass</span></div> <pre data-language="text">localhost:5432:NAME:USER:PASSWORD
</pre> </div> <div class="versionchanged"> <span class="title">Changed in Django 4.0:</span> <p>Support for connecting by a service name, and specifying a password file was added.</p> </div>   <h3 id="optimizing-postgresql-s-configuration">Optimizing PostgreSQL’s configuration</h3> <p id="s-optimizing-postgresql-s-configuration">Django needs the following parameters for its database connections:</p> <ul class="simple"> <li>
<code>client_encoding</code>: <code>'UTF8'</code>,</li> <li>
<code>default_transaction_isolation</code>: <code>'read committed'</code> by default, or the value set in the connection options (see below),</li> <li>
<dl class="first docutils"> <dt>
<code>timezone:</code> </dt> <dd>
<ul class="first last"> <li>when <a class="reference internal" href="settings#std:setting-USE_TZ"><code>USE_TZ</code></a> is <code>True</code>, <code>'UTC'</code> by default, or the <a class="reference internal" href="settings#std:setting-DATABASE-TIME_ZONE"><code>TIME_ZONE</code></a> value set for the connection,</li> <li>when <a class="reference internal" href="settings#std:setting-USE_TZ"><code>USE_TZ</code></a> is <code>False</code>, the value of the global <a class="reference internal" href="settings#std:setting-TIME_ZONE"><code>TIME_ZONE</code></a> setting.</li> </ul> </dd> </dl> </li> </ul> <p>If these parameters already have the correct values, Django won’t set them for every new connection, which improves performance slightly. You can configure them directly in <code>postgresql.conf</code> or more conveniently per database user with <a class="reference external" href="https://www.postgresql.org/docs/current/sql-alterrole.html">ALTER ROLE</a>.</p> <p>Django will work just fine without this optimization, but each new connection will do some additional queries to set these parameters.</p>   <h3 id="database-isolation-level">Isolation level</h3> <p id="s-isolation-level">Like PostgreSQL itself, Django defaults to the <code>READ COMMITTED</code> <a class="reference external" href="https://www.postgresql.org/docs/current/transaction-iso.html">isolation level</a>. If you need a higher isolation level such as <code>REPEATABLE READ</code> or <code>SERIALIZABLE</code>, set it in the <a class="reference internal" href="settings#std:setting-OPTIONS"><code>OPTIONS</code></a> part of your database configuration in <a class="reference internal" href="settings#std:setting-DATABASES"><code>DATABASES</code></a>:</p> <pre data-language="python">import psycopg2.extensions

DATABASES = {
    # ...
    'OPTIONS': {
        'isolation_level': psycopg2.extensions.ISOLATION_LEVEL_SERIALIZABLE,
    },
}
</pre> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">Under higher isolation levels, your application should be prepared to handle exceptions raised on serialization failures. This option is designed for advanced uses.</p> </div>   <h3 id="indexes-for-varchar-and-text-columns">Indexes for <code>varchar</code> and <code>text</code> columns</h3> <p id="s-indexes-for-varchar-and-text-columns">When specifying <code>db_index=True</code> on your model fields, Django typically outputs a single <code>CREATE INDEX</code> statement. However, if the database type for the field is either <code>varchar</code> or <code>text</code> (e.g., used by <code>CharField</code>, <code>FileField</code>, and <code>TextField</code>), then Django will create an additional index that uses an appropriate <a class="reference external" href="https://www.postgresql.org/docs/current/indexes-opclass.html">PostgreSQL operator class</a> for the column. The extra index is necessary to correctly perform lookups that use the <code>LIKE</code> operator in their SQL, as is done with the <code>contains</code> and <code>startswith</code> lookup types.</p>   <h3 id="migration-operation-for-adding-extensions">Migration operation for adding extensions</h3> <p id="s-migration-operation-for-adding-extensions">If you need to add a PostgreSQL extension (like <code>hstore</code>, <code>postgis</code>, etc.) using a migration, use the <a class="reference internal" href="contrib/postgres/operations#django.contrib.postgres.operations.CreateExtension" title="django.contrib.postgres.operations.CreateExtension"><code>CreateExtension</code></a> operation.</p>   <h3 id="postgresql-server-side-cursors">Server-side cursors</h3> <p id="s-server-side-cursors">When using <a class="reference internal" href="models/querysets#django.db.models.query.QuerySet.iterator" title="django.db.models.query.QuerySet.iterator"><code>QuerySet.iterator()</code></a>, Django opens a <a class="reference external" href="https://www.psycopg.org/docs/usage.html#server-side-cursors" title="(in Psycopg v2.9)"><span class="xref std std-ref">server-side cursor</span></a>. By default, PostgreSQL assumes that only the first 10% of the results of cursor queries will be fetched. The query planner spends less time planning the query and starts returning results faster, but this could diminish performance if more than 10% of the results are retrieved. PostgreSQL’s assumptions on the number of rows retrieved for a cursor query is controlled with the <a class="reference external" href="https://www.postgresql.org/docs/current/runtime-config-query.html#GUC-CURSOR-TUPLE-FRACTION">cursor_tuple_fraction</a> option.</p>  <h4 id="transaction-pooling-server-side-cursors">Transaction pooling and server-side cursors</h4> <p id="s-transaction-pooling-and-server-side-cursors">Using a connection pooler in transaction pooling mode (e.g. <a class="reference external" href="https://www.pgbouncer.org/">PgBouncer</a>) requires disabling server-side cursors for that connection.</p> <p>Server-side cursors are local to a connection and remain open at the end of a transaction when <a class="reference internal" href="settings#std:setting-DATABASE-AUTOCOMMIT"><code>AUTOCOMMIT</code></a> is <code>True</code>. A subsequent transaction may attempt to fetch more results from a server-side cursor. In transaction pooling mode, there’s no guarantee that subsequent transactions will use the same connection. If a different connection is used, an error is raised when the transaction references the server-side cursor, because server-side cursors are only accessible in the connection in which they were created.</p> <p>One solution is to disable server-side cursors for a connection in <a class="reference internal" href="settings#std:setting-DATABASES"><code>DATABASES</code></a> by setting <a class="reference internal" href="settings#std:setting-DATABASE-DISABLE_SERVER_SIDE_CURSORS"><code>DISABLE_SERVER_SIDE_CURSORS</code></a> to <code>True</code>.</p> <p>To benefit from server-side cursors in transaction pooling mode, you could set up <a class="reference internal" href="../topics/db/multi-db"><span class="doc">another connection to the database</span></a> in order to perform queries that use server-side cursors. This connection needs to either be directly to the database or to a connection pooler in session pooling mode.</p> <p>Another option is to wrap each <code>QuerySet</code> using server-side cursors in an <a class="reference internal" href="../topics/db/transactions#django.db.transaction.atomic" title="django.db.transaction.atomic"><code>atomic()</code></a> block, because it disables <code>autocommit</code> for the duration of the transaction. This way, the server-side cursor will only live for the duration of the transaction.</p>    <h3 id="manually-specified-autoincrement-pk">Manually-specifying values of auto-incrementing primary keys</h3> <p id="s-manually-specifying-values-of-auto-incrementing-primary-keys">Django uses PostgreSQL’s <a class="reference external" href="https://www.postgresql.org/docs/current/datatype-numeric.html#DATATYPE-SERIAL">SERIAL data type</a> to store auto-incrementing primary keys. A <code>SERIAL</code> column is populated with values from a <a class="reference external" href="https://www.postgresql.org/docs/current/sql-createsequence.html">sequence</a> that keeps track of the next available value. Manually assigning a value to an auto-incrementing field doesn’t update the field’s sequence, which might later cause a conflict. For example:</p> <pre data-language="python">&gt;&gt;&gt; from django.contrib.auth.models import User
&gt;&gt;&gt; User.objects.create(username='alice', pk=1)
&lt;User: alice&gt;
&gt;&gt;&gt; # The sequence hasn't been updated; its next value is 1.
&gt;&gt;&gt; User.objects.create(username='bob')
...
IntegrityError: duplicate key value violates unique constraint
"auth_user_pkey" DETAIL:  Key (id)=(1) already exists.
</pre> <p>If you need to specify such values, reset the sequence afterward to avoid reusing a value that’s already in the table. The <a class="reference internal" href="django-admin#django-admin-sqlsequencereset"><code>sqlsequencereset</code></a> management command generates the SQL statements to do that.</p>   <h3 id="test-database-templates">Test database templates</h3> <p id="s-test-database-templates">You can use the <a class="reference internal" href="settings#std:setting-TEST_TEMPLATE"><code>TEST['TEMPLATE']</code></a> setting to specify a <a class="reference external" href="https://www.postgresql.org/docs/current/sql-createdatabase.html">template</a> (e.g. <code>'template0'</code>) from which to create a test database.</p>   <h3 id="speeding-up-test-execution-with-non-durable-settings">Speeding up test execution with non-durable settings</h3> <p id="s-speeding-up-test-execution-with-non-durable-settings">You can speed up test execution times by <a class="reference external" href="https://www.postgresql.org/docs/current/non-durability.html">configuring PostgreSQL to be non-durable</a>.</p> <div class="admonition warning"> <p class="first admonition-title">Warning</p> <p class="last">This is dangerous: it will make your database more susceptible to data loss or corruption in the case of a server crash or power loss. Only use this on a development machine where you can easily restore the entire contents of all databases in the cluster.</p> </div>    <h2 id="id4">MariaDB notes</h2> <p id="s-mariadb-notes">Django supports MariaDB 10.2 and higher.</p> <p>To use MariaDB, use the MySQL backend, which is shared between the two. See the <a class="reference internal" href="#mysql-notes"><span class="std std-ref">MySQL notes</span></a> for more details.</p>   <h2 id="id5">MySQL notes</h2>  <h3 id="version-support">Version support</h3> <p id="s-mysql-notes">Django supports MySQL 5.7 and higher.</p> <p>Django’s <code>inspectdb</code> feature uses the <code>information_schema</code> database, which contains detailed data on all database schemas.</p> <p>Django expects the database to support Unicode (UTF-8 encoding) and delegates to it the task of enforcing transactions and referential integrity. It is important to be aware of the fact that the two latter ones aren’t actually enforced by MySQL when using the MyISAM storage engine, see the next section.</p>   <h3 id="mysql-storage-engines">Storage engines</h3> <p id="s-storage-engines">MySQL has several <a class="reference external" href="https://dev.mysql.com/doc/refman/en/storage-engines.html">storage engines</a>. You can change the default storage engine in the server configuration.</p> <p>MySQL’s default storage engine is <a class="reference external" href="https://dev.mysql.com/doc/refman/en/innodb-storage-engine.html">InnoDB</a>. This engine is fully transactional and supports foreign key references. It’s the recommended choice. However, the InnoDB autoincrement counter is lost on a MySQL restart because it does not remember the <code>AUTO_INCREMENT</code> value, instead recreating it as “max(id)+1”. This may result in an inadvertent reuse of <a class="reference internal" href="models/fields#django.db.models.AutoField" title="django.db.models.AutoField"><code>AutoField</code></a> values.</p> <p>The main drawbacks of <a class="reference external" href="https://dev.mysql.com/doc/refman/en/myisam-storage-engine.html">MyISAM</a> are that it doesn’t support transactions or enforce foreign-key constraints.</p>   <h3 id="id7">MySQL DB API Drivers</h3> <p id="s-mysql-db-api-drivers">MySQL has a couple drivers that implement the Python Database API described in <a class="pep reference external" href="https://www.python.org/dev/peps/pep-0249" id="index-0"><strong>PEP 249</strong></a>:</p> <ul class="simple"> <li>
<a class="reference external" href="https://pypi.org/project/mysqlclient/">mysqlclient</a> is a native driver. It’s <strong>the recommended choice</strong>.</li> <li>
<a class="reference external" href="https://dev.mysql.com/downloads/connector/python/">MySQL Connector/Python</a> is a pure Python driver from Oracle that does not require the MySQL client library or any Python modules outside the standard library.</li> </ul> <p>These drivers are thread-safe and provide connection pooling.</p> <p>In addition to a DB API driver, Django needs an adapter to access the database drivers from its ORM. Django provides an adapter for mysqlclient while MySQL Connector/Python includes <a class="reference external" href="https://dev.mysql.com/doc/connector-python/en/connector-python-django-backend.html">its own</a>.</p>  <h4 id="id8">mysqlclient</h4> <p id="s-id8">Django requires <a class="reference external" href="https://pypi.org/project/mysqlclient/">mysqlclient</a> 1.4.0 or later.</p>   <h4 id="id9">MySQL Connector/Python</h4> <p id="s-id9">MySQL Connector/Python is available from the <a class="reference external" href="https://dev.mysql.com/downloads/connector/python/">download page</a>. The Django adapter is available in versions 1.1.X and later. It may not support the most recent releases of Django.</p>    <h3 id="mysql-time-zone-definitions">Time zone definitions</h3> <p id="s-time-zone-definitions">If you plan on using Django’s <a class="reference internal" href="../topics/i18n/timezones"><span class="doc">timezone support</span></a>, use <a class="reference external" href="https://dev.mysql.com/doc/refman/en/mysql-tzinfo-to-sql.html">mysql_tzinfo_to_sql</a> to load time zone tables into the MySQL database. This needs to be done just once for your MySQL server, not per database.</p>   <h3 id="creating-your-database">Creating your database</h3> <p id="s-creating-your-database">You can <a class="reference external" href="https://dev.mysql.com/doc/refman/en/create-database.html">create your database</a> using the command-line tools and this SQL:</p> <pre data-language="python">CREATE DATABASE &lt;dbname&gt; CHARACTER SET utf8;
</pre> <p>This ensures all tables and columns will use UTF-8 by default.</p>  <h4 id="mysql-collation">Collation settings</h4> <p id="s-collation-settings">The collation setting for a column controls the order in which data is sorted as well as what strings compare as equal. You can specify the <code>db_collation</code> parameter to set the collation name of the column for <a class="reference internal" href="models/fields#django.db.models.CharField.db_collation" title="django.db.models.CharField.db_collation"><code>CharField</code></a> and <a class="reference internal" href="models/fields#django.db.models.TextField.db_collation" title="django.db.models.TextField.db_collation"><code>TextField</code></a>.</p> <p>The collation can also be set on a database-wide level and per-table. This is <a class="reference external" href="https://dev.mysql.com/doc/refman/en/charset.html">documented thoroughly</a> in the MySQL documentation. In such cases, you must set the collation by directly manipulating the database settings or tables. Django doesn’t provide an API to change them.</p> <p>By default, with a UTF-8 database, MySQL will use the <code>utf8_general_ci</code> collation. This results in all string equality comparisons being done in a <em>case-insensitive</em> manner. That is, <code>"Fred"</code> and <code>"freD"</code> are considered equal at the database level. If you have a unique constraint on a field, it would be illegal to try to insert both <code>"aa"</code> and <code>"AA"</code> into the same column, since they compare as equal (and, hence, non-unique) with the default collation. If you want case-sensitive comparisons on a particular column or table, change the column or table to use the <code>utf8_bin</code> collation.</p> <p>Please note that according to <a class="reference external" href="https://dev.mysql.com/doc/refman/en/charset-unicode-sets.html">MySQL Unicode Character Sets</a>, comparisons for the <code>utf8_general_ci</code> collation are faster, but slightly less correct, than comparisons for <code>utf8_unicode_ci</code>. If this is acceptable for your application, you should use <code>utf8_general_ci</code> because it is faster. If this is not acceptable (for example, if you require German dictionary order), use <code>utf8_unicode_ci</code> because it is more accurate.</p> <div class="admonition warning"> <p class="first admonition-title">Warning</p> <p class="last">Model formsets validate unique fields in a case-sensitive manner. Thus when using a case-insensitive collation, a formset with unique field values that differ only by case will pass validation, but upon calling <code>save()</code>, an <code>IntegrityError</code> will be raised.</p> </div> <div class="versionchanged"> <span class="title">Changed in Django 3.2:</span> <p>Support for setting a database collation for the field was added.</p> </div>    <h3 id="connecting-to-the-database">Connecting to the database</h3> <p id="s-connecting-to-the-database">Refer to the <a class="reference internal" href="settings"><span class="doc">settings documentation</span></a>.</p> <p>Connection settings are used in this order:</p> <ol class="arabic simple"> <li>
<a class="reference internal" href="settings#std:setting-OPTIONS"><code>OPTIONS</code></a>.</li> <li>
<a class="reference internal" href="settings#std:setting-NAME"><code>NAME</code></a>, <a class="reference internal" href="settings#std:setting-USER"><code>USER</code></a>, <a class="reference internal" href="settings#std:setting-PASSWORD"><code>PASSWORD</code></a>, <a class="reference internal" href="settings#std:setting-HOST"><code>HOST</code></a>, <a class="reference internal" href="settings#std:setting-PORT"><code>PORT</code></a>
</li> <li>MySQL option files.</li> </ol> <p>In other words, if you set the name of the database in <a class="reference internal" href="settings#std:setting-OPTIONS"><code>OPTIONS</code></a>, this will take precedence over <a class="reference internal" href="settings#std:setting-NAME"><code>NAME</code></a>, which would override anything in a <a class="reference external" href="https://dev.mysql.com/doc/refman/en/option-files.html">MySQL option file</a>.</p> <p>Here’s a sample configuration which uses a MySQL option file:</p> <pre data-language="python"># settings.py
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'OPTIONS': {
            'read_default_file': '/path/to/my.cnf',
        },
    }
}


# my.cnf
[client]
database = NAME
user = USER
password = PASSWORD
default-character-set = utf8
</pre> <p>Several other <a class="reference external" href="https://mysqlclient.readthedocs.io/user_guide.html#functions-and-attributes">MySQLdb connection options</a> may be useful, such as <code>ssl</code>, <code>init_command</code>, and <code>sql_mode</code>.</p>  <h4 id="mysql-sql-mode">Setting <code>sql_mode</code>
</h4> <p id="s-setting-sql-mode">From MySQL 5.7 onward, the default value of the <code>sql_mode</code> option contains <code>STRICT_TRANS_TABLES</code>. That option escalates warnings into errors when data are truncated upon insertion, so Django highly recommends activating a <a class="reference external" href="https://dev.mysql.com/doc/refman/en/sql-mode.html#sql-mode-strict">strict mode</a> for MySQL to prevent data loss (either <code>STRICT_TRANS_TABLES</code> or <code>STRICT_ALL_TABLES</code>).</p> <p>If you need to customize the SQL mode, you can set the <code>sql_mode</code> variable like other MySQL options: either in a config file or with the entry <code>'init_command': "SET sql_mode='STRICT_TRANS_TABLES'"</code> in the <a class="reference internal" href="settings#std:setting-OPTIONS"><code>OPTIONS</code></a> part of your database configuration in <a class="reference internal" href="settings#std:setting-DATABASES"><code>DATABASES</code></a>.</p>   <h4 id="id10">Isolation level</h4> <p id="s-mysql-isolation-level">When running concurrent loads, database transactions from different sessions (say, separate threads handling different requests) may interact with each other. These interactions are affected by each session’s <a class="reference external" href="https://dev.mysql.com/doc/refman/en/innodb-transaction-isolation-levels.html">transaction isolation level</a>. You can set a connection’s isolation level with an <code>'isolation_level'</code> entry in the <a class="reference internal" href="settings#std:setting-OPTIONS"><code>OPTIONS</code></a> part of your database configuration in <a class="reference internal" href="settings#std:setting-DATABASES"><code>DATABASES</code></a>. Valid values for this entry are the four standard isolation levels:</p> <ul class="simple"> <li><code>'read uncommitted'</code></li> <li><code>'read committed'</code></li> <li><code>'repeatable read'</code></li> <li><code>'serializable'</code></li> </ul> <p>or <code>None</code> to use the server’s configured isolation level. However, Django works best with and defaults to read committed rather than MySQL’s default, repeatable read. Data loss is possible with repeatable read. In particular, you may see cases where <a class="reference internal" href="models/querysets#django.db.models.query.QuerySet.get_or_create" title="django.db.models.query.QuerySet.get_or_create"><code>get_or_create()</code></a> will raise an <a class="reference internal" href="exceptions#django.db.IntegrityError" title="django.db.IntegrityError"><code>IntegrityError</code></a> but the object won’t appear in a subsequent <a class="reference internal" href="models/querysets#django.db.models.query.QuerySet.get" title="django.db.models.query.QuerySet.get"><code>get()</code></a> call.</p>    <h3 id="creating-your-tables">Creating your tables</h3> <p id="s-creating-your-tables">When Django generates the schema, it doesn’t specify a storage engine, so tables will be created with whatever default storage engine your database server is configured for. The easiest solution is to set your database server’s default storage engine to the desired engine.</p> <p>If you’re using a hosting service and can’t change your server’s default storage engine, you have a couple of options.</p> <ul> <li>
<p class="first">After the tables are created, execute an <code>ALTER TABLE</code> statement to convert a table to a new storage engine (such as InnoDB):</p> <pre data-language="python">ALTER TABLE &lt;tablename&gt; ENGINE=INNODB;
</pre> <p>This can be tedious if you have a lot of tables.</p> </li> <li>
<p class="first">Another option is to use the <code>init_command</code> option for MySQLdb prior to creating your tables:</p> <pre data-language="python">'OPTIONS': {
   'init_command': 'SET default_storage_engine=INNODB',
}
</pre> <p>This sets the default storage engine upon connecting to the database. After your tables have been created, you should remove this option as it adds a query that is only needed during table creation to each database connection.</p> </li> </ul>   <h3 id="table-names">Table names</h3> <p id="s-table-names">There are <a class="reference external" href="https://bugs.mysql.com/bug.php?id=48875">known issues</a> in even the latest versions of MySQL that can cause the case of a table name to be altered when certain SQL statements are executed under certain conditions. It is recommended that you use lowercase table names, if possible, to avoid any problems that might arise from this behavior. Django uses lowercase table names when it auto-generates table names from models, so this is mainly a consideration if you are overriding the table name via the <a class="reference internal" href="models/options#django.db.models.Options.db_table" title="django.db.models.Options.db_table"><code>db_table</code></a> parameter.</p>   <h3 id="savepoints">Savepoints</h3> <p id="s-savepoints">Both the Django ORM and MySQL (when using the InnoDB <a class="reference internal" href="#mysql-storage-engines"><span class="std std-ref">storage engine</span></a>) support database <a class="reference internal" href="../topics/db/transactions#topics-db-transactions-savepoints"><span class="std std-ref">savepoints</span></a>.</p> <p>If you use the MyISAM storage engine please be aware of the fact that you will receive database-generated errors if you try to use the <a class="reference internal" href="../topics/db/transactions#topics-db-transactions-savepoints"><span class="std std-ref">savepoint-related methods of the transactions API</span></a>. The reason for this is that detecting the storage engine of a MySQL database/table is an expensive operation so it was decided it isn’t worth to dynamically convert these methods in no-op’s based in the results of such detection.</p>   <h3 id="notes-on-specific-fields">Notes on specific fields</h3>  <h4 id="mysql-character-fields">Character fields</h4> <p id="s-notes-on-specific-fields">Any fields that are stored with <code>VARCHAR</code> column types may have their <code>max_length</code> restricted to 255 characters if you are using <code>unique=True</code> for the field. This affects <a class="reference internal" href="models/fields#django.db.models.CharField" title="django.db.models.CharField"><code>CharField</code></a>, <a class="reference internal" href="models/fields#django.db.models.SlugField" title="django.db.models.SlugField"><code>SlugField</code></a>. See <a class="reference external" href="https://dev.mysql.com/doc/refman/en/create-index.html#create-index-column-prefixes">the MySQL documentation</a> for more details.</p>   <h4 id="textfield-limitations">
<code>TextField</code> limitations</h4> <p id="s-textfield-limitations">MySQL can index only the first N chars of a <code>BLOB</code> or <code>TEXT</code> column. Since <code>TextField</code> doesn’t have a defined length, you can’t mark it as <code>unique=True</code>. MySQL will report: “BLOB/TEXT column ‘&lt;db_column&gt;’ used in key specification without a key length”.</p>   <h4 id="mysql-fractional-seconds">Fractional seconds support for Time and DateTime fields</h4> <p id="s-fractional-seconds-support-for-time-and-datetime-fields">MySQL can store fractional seconds, provided that the column definition includes a fractional indication (e.g. <code>DATETIME(6)</code>).</p> <p>Django will not upgrade existing columns to include fractional seconds if the database server supports it. If you want to enable them on an existing database, it’s up to you to either manually update the column on the target database, by executing a command like:</p> <pre data-language="python">ALTER TABLE `your_table` MODIFY `your_datetime_column` DATETIME(6)
</pre> <p>or using a <a class="reference internal" href="migration-operations#django.db.migrations.operations.RunSQL" title="django.db.migrations.operations.RunSQL"><code>RunSQL</code></a> operation in a <a class="reference internal" href="../topics/migrations#data-migrations"><span class="std std-ref">data migration</span></a>.</p>   <h4 id="timestamp-columns">
<code>TIMESTAMP</code> columns</h4> <p id="s-timestamp-columns">If you are using a legacy database that contains <code>TIMESTAMP</code> columns, you must set <a class="reference internal" href="settings#std:setting-USE_TZ"><code>USE_TZ = False</code></a> to avoid data corruption. <a class="reference internal" href="django-admin#django-admin-inspectdb"><code>inspectdb</code></a> maps these columns to <a class="reference internal" href="models/fields#django.db.models.DateTimeField" title="django.db.models.DateTimeField"><code>DateTimeField</code></a> and if you enable timezone support, both MySQL and Django will attempt to convert the values from UTC to local time.</p>    <h3 id="row-locking-with-queryset-select-for-update">Row locking with <code>QuerySet.select_for_update()</code>
</h3> <p id="s-row-locking-with-queryset-select-for-update">MySQL and MariaDB do not support some options to the <code>SELECT ... FOR UPDATE</code> statement. If <code>select_for_update()</code> is used with an unsupported option, then a <a class="reference internal" href="exceptions#django.db.NotSupportedError" title="django.db.NotSupportedError"><code>NotSupportedError</code></a> is raised.</p> <table class="docutils">  <thead valign="bottom"> <tr>
<th class="head">Option</th> <th class="head">MariaDB</th> <th class="head">MySQL</th> </tr> </thead>  <tr>
<td><code>SKIP LOCKED</code></td> <td>X (≥10.6)</td> <td>X (≥8.0.1)</td> </tr> <tr>
<td><code>NOWAIT</code></td> <td>X (≥10.3)</td> <td>X (≥8.0.1)</td> </tr> <tr>
<td><code>OF</code></td> <td> </td> <td>X (≥8.0.1)</td> </tr> <tr>
<td><code>NO KEY</code></td> <td> </td> <td> </td> </tr>  </table> <p>When using <code>select_for_update()</code> on MySQL, make sure you filter a queryset against at least a set of fields contained in unique constraints or only against fields covered by indexes. Otherwise, an exclusive write lock will be acquired over the full table for the duration of the transaction.</p>   <h3 id="automatic-typecasting-can-cause-unexpected-results">Automatic typecasting can cause unexpected results</h3> <p id="s-automatic-typecasting-can-cause-unexpected-results">When performing a query on a string type, but with an integer value, MySQL will coerce the types of all values in the table to an integer before performing the comparison. If your table contains the values <code>'abc'</code>, <code>'def'</code> and you query for <code>WHERE mycolumn=0</code>, both rows will match. Similarly, <code>WHERE mycolumn=1</code> will match the value <code>'abc1'</code>. Therefore, string type fields included in Django will always cast the value to a string before using it in a query.</p> <p>If you implement custom model fields that inherit from <a class="reference internal" href="models/fields#django.db.models.Field" title="django.db.models.Field"><code>Field</code></a> directly, are overriding <a class="reference internal" href="models/fields#django.db.models.Field.get_prep_value" title="django.db.models.Field.get_prep_value"><code>get_prep_value()</code></a>, or use <a class="reference internal" href="models/expressions#django.db.models.expressions.RawSQL" title="django.db.models.expressions.RawSQL"><code>RawSQL</code></a>, <a class="reference internal" href="models/querysets#django.db.models.query.QuerySet.extra" title="django.db.models.query.QuerySet.extra"><code>extra()</code></a>, or <a class="reference internal" href="../topics/db/sql#django.db.models.Manager.raw" title="django.db.models.Manager.raw"><code>raw()</code></a>, you should ensure that you perform appropriate typecasting.</p>    <h2 id="id11">SQLite notes</h2> <p id="s-sqlite-notes">Django supports SQLite 3.9.0 and later.</p> <p><a class="reference external" href="https://www.sqlite.org/">SQLite</a> provides an excellent development alternative for applications that are predominantly read-only or require a smaller installation footprint. As with all database servers, though, there are some differences that are specific to SQLite that you should be aware of.</p>  <h3 id="sqlite-string-matching">Substring matching and case sensitivity</h3> <p id="s-substring-matching-and-case-sensitivity">For all SQLite versions, there is some slightly counter-intuitive behavior when attempting to match some types of strings. These are triggered when using the <a class="reference internal" href="models/querysets#std:fieldlookup-iexact"><code>iexact</code></a> or <a class="reference internal" href="models/querysets#std:fieldlookup-contains"><code>contains</code></a> filters in Querysets. The behavior splits into two cases:</p> <p>1. For substring matching, all matches are done case-insensitively. That is a filter such as <code>filter(name__contains="aa")</code> will match a name of <code>"Aabb"</code>.</p> <p>2. For strings containing characters outside the ASCII range, all exact string matches are performed case-sensitively, even when the case-insensitive options are passed into the query. So the <a class="reference internal" href="models/querysets#std:fieldlookup-iexact"><code>iexact</code></a> filter will behave exactly the same as the <a class="reference internal" href="models/querysets#std:fieldlookup-exact"><code>exact</code></a> filter in these cases.</p> <p>Some possible workarounds for this are <a class="reference external" href="https://www.sqlite.org/faq.html#q18">documented at sqlite.org</a>, but they aren’t utilized by the default SQLite backend in Django, as incorporating them would be fairly difficult to do robustly. Thus, Django exposes the default SQLite behavior and you should be aware of this when doing case-insensitive or substring filtering.</p>   <h3 id="sqlite-decimal-handling">Decimal handling</h3> <p id="s-decimal-handling">SQLite has no real decimal internal type. Decimal values are internally converted to the <code>REAL</code> data type (8-byte IEEE floating point number), as explained in the <a class="reference external" href="https://www.sqlite.org/datatype3.html#storage_classes_and_datatypes">SQLite datatypes documentation</a>, so they don’t support correctly-rounded decimal floating point arithmetic.</p>   <h3 id="database-is-locked-errors">“Database is locked” errors</h3> <p id="s-database-is-locked-errors">SQLite is meant to be a lightweight database, and thus can’t support a high level of concurrency. <code>OperationalError: database is locked</code> errors indicate that your application is experiencing more concurrency than <code>sqlite</code> can handle in default configuration. This error means that one thread or process has an exclusive lock on the database connection and another thread timed out waiting for the lock the be released.</p> <p>Python’s SQLite wrapper has a default timeout value that determines how long the second thread is allowed to wait on the lock before it times out and raises the <code>OperationalError: database
is locked</code> error.</p> <p>If you’re getting this error, you can solve it by:</p> <ul> <li>Switching to another database backend. At a certain point SQLite becomes too “lite” for real-world applications, and these sorts of concurrency errors indicate you’ve reached that point. </li> <li>Rewriting your code to reduce concurrency and ensure that database transactions are short-lived. </li> <li>
<p class="first">Increase the default timeout value by setting the <code>timeout</code> database option:</p> <pre data-language="python">'OPTIONS': {
    # ...
    'timeout': 20,
    # ...
}
</pre> <p>This will make SQLite wait a bit longer before throwing “database is locked” errors; it won’t really do anything to solve them.</p> </li> </ul>   <h3 id="queryset-select-for-update-not-supported">
<code>QuerySet.select_for_update()</code> not supported</h3> <p id="s-queryset-select-for-update-not-supported">SQLite does not support the <code>SELECT ... FOR UPDATE</code> syntax. Calling it will have no effect.</p>   <h3 id="pyformat-parameter-style-in-raw-queries-not-supported">“pyformat” parameter style in raw queries not supported</h3> <p id="s-pyformat-parameter-style-in-raw-queries-not-supported">For most backends, raw queries (<code>Manager.raw()</code> or <code>cursor.execute()</code>) can use the “pyformat” parameter style, where placeholders in the query are given as <code>'%(name)s'</code> and the parameters are passed as a dictionary rather than a list. SQLite does not support this.</p>   <h3 id="sqlite-isolation">Isolation when using <code>QuerySet.iterator()</code>
</h3> <p id="s-isolation-when-using-queryset-iterator">There are special considerations described in <a class="reference external" href="https://www.sqlite.org/isolation.html">Isolation In SQLite</a> when modifying a table while iterating over it using <a class="reference internal" href="models/querysets#django.db.models.query.QuerySet.iterator" title="django.db.models.query.QuerySet.iterator"><code>QuerySet.iterator()</code></a>. If a row is added, changed, or deleted within the loop, then that row may or may not appear, or may appear twice, in subsequent results fetched from the iterator. Your code must handle this.</p>   <h3 id="sqlite-json1">Enabling JSON1 extension on SQLite</h3> <p id="s-enabling-json1-extension-on-sqlite">To use <a class="reference internal" href="models/fields#django.db.models.JSONField" title="django.db.models.JSONField"><code>JSONField</code></a> on SQLite, you need to enable the <a class="reference external" href="https://www.sqlite.org/json1.html">JSON1 extension</a> on Python’s <a class="reference external" href="https://docs.python.org/3/library/sqlite3.html#module-sqlite3" title="(in Python v3.10)"><code>sqlite3</code></a> library. If the extension is not enabled on your installation, a system error (<code>fields.E180</code>) will be raised.</p> <p>To enable the JSON1 extension you can follow the instruction on <a class="reference external" href="https://code.djangoproject.com/wiki/JSON1Extension">the wiki page</a>.</p>    <h2 id="id13">Oracle notes</h2> <p id="s-oracle-notes">Django supports <a class="reference external" href="https://www.oracle.com/">Oracle Database Server</a> versions 19c and higher. Version 7.0 or higher of the <a class="reference external" href="https://oracle.github.io/python-cx_Oracle/">cx_Oracle</a> Python driver is required.</p> <p>In order for the <code>python manage.py migrate</code> command to work, your Oracle database user must have privileges to run the following commands:</p> <ul class="simple"> <li>CREATE TABLE</li> <li>CREATE SEQUENCE</li> <li>CREATE PROCEDURE</li> <li>CREATE TRIGGER</li> </ul> <p>To run a project’s test suite, the user usually needs these <em>additional</em> privileges:</p> <ul class="simple"> <li>CREATE USER</li> <li>ALTER USER</li> <li>DROP USER</li> <li>CREATE TABLESPACE</li> <li>DROP TABLESPACE</li> <li>CREATE SESSION WITH ADMIN OPTION</li> <li>CREATE TABLE WITH ADMIN OPTION</li> <li>CREATE SEQUENCE WITH ADMIN OPTION</li> <li>CREATE PROCEDURE WITH ADMIN OPTION</li> <li>CREATE TRIGGER WITH ADMIN OPTION</li> </ul> <p>While the <code>RESOURCE</code> role has the required <code>CREATE TABLE</code>, <code>CREATE SEQUENCE</code>, <code>CREATE PROCEDURE</code>, and <code>CREATE TRIGGER</code> privileges, and a user granted <code>RESOURCE WITH ADMIN OPTION</code> can grant <code>RESOURCE</code>, such a user cannot grant the individual privileges (e.g. <code>CREATE TABLE</code>), and thus <code>RESOURCE WITH ADMIN OPTION</code> is not usually sufficient for running tests.</p> <p>Some test suites also create views or materialized views; to run these, the user also needs <code>CREATE VIEW WITH ADMIN OPTION</code> and <code>CREATE MATERIALIZED VIEW WITH ADMIN OPTION</code> privileges. In particular, this is needed for Django’s own test suite.</p> <p>All of these privileges are included in the DBA role, which is appropriate for use on a private developer’s database.</p> <p>The Oracle database backend uses the <code>SYS.DBMS_LOB</code> and <code>SYS.DBMS_RANDOM</code> packages, so your user will require execute permissions on it. It’s normally accessible to all users by default, but in case it is not, you’ll need to grant permissions like so:</p> <pre data-language="sql">GRANT EXECUTE ON SYS.DBMS_LOB TO user;
GRANT EXECUTE ON SYS.DBMS_RANDOM TO user;
</pre>  <h3 id="id14">Connecting to the database</h3> <p id="s-id14">To connect using the service name of your Oracle database, your <code>settings.py</code> file should look something like this:</p> <pre data-language="python">DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.oracle',
        'NAME': 'xe',
        'USER': 'a_user',
        'PASSWORD': 'a_password',
        'HOST': '',
        'PORT': '',
    }
}
</pre> <p>In this case, you should leave both <a class="reference internal" href="settings#std:setting-HOST"><code>HOST</code></a> and <a class="reference internal" href="settings#std:setting-PORT"><code>PORT</code></a> empty. However, if you don’t use a <code>tnsnames.ora</code> file or a similar naming method and want to connect using the SID (“xe” in this example), then fill in both <a class="reference internal" href="settings#std:setting-HOST"><code>HOST</code></a> and <a class="reference internal" href="settings#std:setting-PORT"><code>PORT</code></a> like so:</p> <pre data-language="python">DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.oracle',
        'NAME': 'xe',
        'USER': 'a_user',
        'PASSWORD': 'a_password',
        'HOST': 'dbprod01ned.mycompany.com',
        'PORT': '1540',
    }
}
</pre> <p>You should either supply both <a class="reference internal" href="settings#std:setting-HOST"><code>HOST</code></a> and <a class="reference internal" href="settings#std:setting-PORT"><code>PORT</code></a>, or leave both as empty strings. Django will use a different connect descriptor depending on that choice.</p>  <h4 id="full-dsn-and-easy-connect">Full DSN and Easy Connect</h4> <p id="s-full-dsn-and-easy-connect">A Full DSN or Easy Connect string can be used in <a class="reference internal" href="settings#std:setting-NAME"><code>NAME</code></a> if both <a class="reference internal" href="settings#std:setting-HOST"><code>HOST</code></a> and <a class="reference internal" href="settings#std:setting-PORT"><code>PORT</code></a> are empty. This format is required when using RAC or pluggable databases without <code>tnsnames.ora</code>, for example.</p> <p>Example of an Easy Connect string:</p> <pre data-language="python">'NAME': 'localhost:1521/orclpdb1',
</pre> <p>Example of a full DSN string:</p> <pre data-language="python">'NAME': (
    '(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=localhost)(PORT=1521))'
    '(CONNECT_DATA=(SERVICE_NAME=orclpdb1)))'
),
</pre>    <h3 id="threaded-option">Threaded option</h3> <p id="s-threaded-option">If you plan to run Django in a multithreaded environment (e.g. Apache using the default MPM module on any modern operating system), then you <strong>must</strong> set the <code>threaded</code> option of your Oracle database configuration to <code>True</code>:</p> <pre data-language="python">'OPTIONS': {
    'threaded': True,
},
</pre> <p>Failure to do this may result in crashes and other odd behavior.</p>   <h3 id="insert-returning-into">INSERT … RETURNING INTO</h3> <p id="s-insert-returning-into">By default, the Oracle backend uses a <code>RETURNING INTO</code> clause to efficiently retrieve the value of an <code>AutoField</code> when inserting new rows. This behavior may result in a <code>DatabaseError</code> in certain unusual setups, such as when inserting into a remote table, or into a view with an <code>INSTEAD OF</code> trigger. The <code>RETURNING INTO</code> clause can be disabled by setting the <code>use_returning_into</code> option of the database configuration to <code>False</code>:</p> <pre data-language="python">'OPTIONS': {
    'use_returning_into': False,
},
</pre> <p>In this case, the Oracle backend will use a separate <code>SELECT</code> query to retrieve <code>AutoField</code> values.</p>   <h3 id="naming-issues">Naming issues</h3> <p id="s-naming-issues">Oracle imposes a name length limit of 30 characters. To accommodate this, the backend truncates database identifiers to fit, replacing the final four characters of the truncated name with a repeatable MD5 hash value. Additionally, the backend turns database identifiers to all-uppercase.</p> <p>To prevent these transformations (this is usually required only when dealing with legacy databases or accessing tables which belong to other users), use a quoted name as the value for <code>db_table</code>:</p> <pre data-language="python">class LegacyModel(models.Model):
    class Meta:
        db_table = '"name_left_in_lowercase"'

class ForeignModel(models.Model):
    class Meta:
        db_table = '"OTHER_USER"."NAME_ONLY_SEEMS_OVER_30"'
</pre> <p>Quoted names can also be used with Django’s other supported database backends; except for Oracle, however, the quotes have no effect.</p> <p>When running <code>migrate</code>, an <code>ORA-06552</code> error may be encountered if certain Oracle keywords are used as the name of a model field or the value of a <code>db_column</code> option. Django quotes all identifiers used in queries to prevent most such problems, but this error can still occur when an Oracle datatype is used as a column name. In particular, take care to avoid using the names <code>date</code>, <code>timestamp</code>, <code>number</code> or <code>float</code> as a field name.</p>   <h3 id="oracle-null-empty-strings">NULL and empty strings</h3> <p id="s-null-and-empty-strings">Django generally prefers to use the empty string (<code>''</code>) rather than <code>NULL</code>, but Oracle treats both identically. To get around this, the Oracle backend ignores an explicit <code>null</code> option on fields that have the empty string as a possible value and generates DDL as if <code>null=True</code>. When fetching from the database, it is assumed that a <code>NULL</code> value in one of these fields really means the empty string, and the data is silently converted to reflect this assumption.</p>   <h3 id="id15">
<code>TextField</code> limitations</h3> <p id="s-id15">The Oracle backend stores <code>TextFields</code> as <code>NCLOB</code> columns. Oracle imposes some limitations on the usage of such LOB columns in general:</p> <ul class="simple"> <li>LOB columns may not be used as primary keys.</li> <li>LOB columns may not be used in indexes.</li> <li>LOB columns may not be used in a <code>SELECT DISTINCT</code> list. This means that attempting to use the <code>QuerySet.distinct</code> method on a model that includes <code>TextField</code> columns will result in an <code>ORA-00932</code> error when run against Oracle. As a workaround, use the <code>QuerySet.defer</code> method in conjunction with <code>distinct()</code> to prevent <code>TextField</code> columns from being included in the <code>SELECT DISTINCT</code> list.</li> </ul>    <h2 id="subclassing-database-backends">Subclassing the built-in database backends</h2> <p id="s-subclassing-the-built-in-database-backends">Django comes with built-in database backends. You may subclass an existing database backends to modify its behavior, features, or configuration.</p> <p>Consider, for example, that you need to change a single database feature. First, you have to create a new directory with a <code>base</code> module in it. For example:</p> <pre data-language="python">mysite/
    ...
    mydbengine/
        __init__.py
        base.py
</pre> <p>The <code>base.py</code> module must contain a class named <code>DatabaseWrapper</code> that subclasses an existing engine from the <code>django.db.backends</code> module. Here’s an example of subclassing the PostgreSQL engine to change a feature class <code>allows_group_by_selected_pks_on_model</code>:</p> <div class="literal-block-wrapper docutils container" id="id19"> <div class="code-block-caption"><span class="caption-text">mysite/mydbengine/base.py</span></div> <pre data-language="python">from django.db.backends.postgresql import base, features

class DatabaseFeatures(features.DatabaseFeatures):
    def allows_group_by_selected_pks_on_model(self, model):
        return True

class DatabaseWrapper(base.DatabaseWrapper):
    features_class = DatabaseFeatures
</pre> </div> <p>Finally, you must specify a <a class="reference internal" href="settings#std:setting-DATABASE-ENGINE"><code>DATABASE-ENGINE</code></a> in your <code>settings.py</code> file:</p> <pre data-language="python">DATABASES = {
    'default': {
        'ENGINE': 'mydbengine',
        ...
    },
}
</pre> <p>You can see the current list of database engines by looking in <a class="reference external" href="https://github.com/django/django/blob/main/django/db/backends">django/db/backends</a>.</p>   <h2 id="third-party-notes">Using a 3rd-party database backend</h2> <p id="s-using-a-3rd-party-database-backend">In addition to the officially supported databases, there are backends provided by 3rd parties that allow you to use other databases with Django:</p> <ul class="simple"> <li><a class="reference external" href="https://pypi.org/project/django-cockroachdb/">CockroachDB</a></li> <li><a class="reference external" href="https://pypi.org/project/django-firebird/">Firebird</a></li> <li><a class="reference external" href="https://pypi.org/project/django-google-spanner/">Google Cloud Spanner</a></li> <li><a class="reference external" href="https://pypi.org/project/django-mssql-backend/">Microsoft SQL Server</a></li> </ul> <p>The Django versions and ORM features supported by these unofficial backends vary considerably. Queries regarding the specific capabilities of these unofficial backends, along with any support queries, should be directed to the support channels provided by each 3rd party project.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; Django Software Foundation and individual contributors<br>Licensed under the BSD License.<br>
    <a href="https://docs.djangoproject.com/en/4.0/ref/databases/" class="_attribution-link">https://docs.djangoproject.com/en/4.0/ref/databases/</a>
  </p>
</div>
