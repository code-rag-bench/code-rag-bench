<h1 id="how-to-use-django-with-apache-and-mod-wsgi">How to use Django with Apache and mod_wsgi</h1> <p id="s-how-to-use-django-with-apache-and-mod-wsgi">Deploying Django with <a class="reference external" href="https://httpd.apache.org/">Apache</a> and <a class="reference external" href="https://modwsgi.readthedocs.io/en/develop/">mod_wsgi</a> is a tried and tested way to get Django into production.</p> <p>mod_wsgi is an Apache module which can host any Python <a class="reference external" href="https://wsgi.readthedocs.io/en/latest/">WSGI</a> application, including Django. Django will work with any version of Apache which supports mod_wsgi.</p> <p>The <a class="reference external" href="https://modwsgi.readthedocs.io/">official mod_wsgi documentation</a> is your source for all the details about how to use mod_wsgi. You’ll probably want to start with the <a class="reference external" href="https://modwsgi.readthedocs.io/en/develop/installation.html">installation and configuration documentation</a>.</p>  <h2 id="basic-configuration">Basic configuration</h2> <p id="s-basic-configuration">Once you’ve got mod_wsgi installed and activated, edit your Apache server’s <a class="reference external" href="https://cwiki.apache.org/confluence/display/httpd/DistrosDefaultLayout">httpd.conf</a> file and add the following.</p> <pre data-language="apache">WSGIScriptAlias / /path/to/mysite.com/mysite/wsgi.py
WSGIPythonHome /path/to/venv
WSGIPythonPath /path/to/mysite.com

&lt;Directory /path/to/mysite.com/mysite&gt;
&lt;Files wsgi.py&gt;
Require all granted
&lt;/Files&gt;
&lt;/Directory&gt;
</pre> <p>The first bit in the <code>WSGIScriptAlias</code> line is the base URL path you want to serve your application at (<code>/</code> indicates the root url), and the second is the location of a “WSGI file” – see below – on your system, usually inside of your project package (<code>mysite</code> in this example). This tells Apache to serve any request below the given URL using the WSGI application defined in that file.</p> <p>If you install your project’s Python dependencies inside a <a class="reference external" href="https://docs.python.org/3/library/venv.html#module-venv" title="(in Python v3.10)"><code>virtual
environment</code></a>, add the path using <code>WSGIPythonHome</code>. See the <a class="reference external" href="https://modwsgi.readthedocs.io/en/develop/user-guides/virtual-environments.html">mod_wsgi virtual environment guide</a> for more details.</p> <p>The <code>WSGIPythonPath</code> line ensures that your project package is available for import on the Python path; in other words, that <code>import mysite</code> works.</p> <p>The <code>&lt;Directory&gt;</code> piece ensures that Apache can access your <code>wsgi.py</code> file.</p> <p>Next we’ll need to ensure this <code>wsgi.py</code> with a WSGI application object exists. As of Django version 1.4, <a class="reference internal" href="../../../ref/django-admin#django-admin-startproject"><code>startproject</code></a> will have created one for you; otherwise, you’ll need to create it. See the <a class="reference internal" href="index"><span class="doc">WSGI overview documentation</span></a> for the default contents you should put in this file, and what else you can add to it.</p> <div class="admonition warning"> <p class="first admonition-title">Warning</p> <p>If multiple Django sites are run in a single mod_wsgi process, all of them will use the settings of whichever one happens to run first. This can be solved by changing:</p> <pre data-language="python">os.environ.setdefault("DJANGO_SETTINGS_MODULE", "{{ project_name }}.settings")
</pre> <p>in <code>wsgi.py</code>, to:</p> <pre data-language="python">os.environ["DJANGO_SETTINGS_MODULE"] = "{{ project_name }}.settings"
</pre> <p class="last">or by <a class="reference internal" href="#daemon-mode"><span class="std std-ref">using mod_wsgi daemon mode</span></a> and ensuring that each site runs in its own daemon process.</p> </div> <div class="admonition-fixing-unicodeencodeerror-for-file-uploads admonition"> <p class="first admonition-title">Fixing <code>UnicodeEncodeError</code> for file uploads</p> <p>If you get a <code>UnicodeEncodeError</code> when uploading or writing files with file names or content that contains non-ASCII characters, make sure Apache is configured to support UTF-8 encoding:</p> <pre data-language="python">export LANG='en_US.UTF-8'
export LC_ALL='en_US.UTF-8'
</pre> <p>A common location to put this configuration is <code>/etc/apache2/envvars</code>.</p> <p>Alternatively, if you are <a class="reference internal" href="#daemon-mode"><span class="std std-ref">using mod_wsgi daemon mode</span></a> you can add <code>lang</code> and <code>locale</code> options to the <code>WSGIDaemonProcess</code> directive:</p> <pre data-language="python">WSGIDaemonProcess example.com lang='en_US.UTF-8' locale='en_US.UTF-8'
</pre> <p class="last">See the <a class="reference internal" href="../../../ref/unicode#unicode-files"><span class="std std-ref">Files</span></a> section of the Unicode reference guide for details.</p> </div>   <h2 id="daemon-mode">Using <code>mod_wsgi</code> daemon mode</h2> <p id="s-using-mod-wsgi-daemon-mode">“Daemon mode” is the recommended mode for running mod_wsgi (on non-Windows platforms). To create the required daemon process group and delegate the Django instance to run in it, you will need to add appropriate <code>WSGIDaemonProcess</code> and <code>WSGIProcessGroup</code> directives. A further change required to the above configuration if you use daemon mode is that you can’t use <code>WSGIPythonPath</code>; instead you should use the <code>python-path</code> option to <code>WSGIDaemonProcess</code>, for example:</p> <pre data-language="apache">WSGIDaemonProcess example.com python-home=/path/to/venv python-path=/path/to/mysite.com
WSGIProcessGroup example.com
</pre> <p>If you want to serve your project in a subdirectory (<code>https://example.com/mysite</code> in this example), you can add <code>WSGIScriptAlias</code> to the configuration above:</p> <pre data-language="apache">WSGIScriptAlias /mysite /path/to/mysite.com/mysite/wsgi.py process-group=example.com
</pre> <p>See the official mod_wsgi documentation for <a class="reference external" href="https://modwsgi.readthedocs.io/en/develop/user-guides/quick-configuration-guide.html#delegation-to-daemon-process">details on setting up daemon mode</a>.</p>   <h2 id="id1">Serving files</h2> <p id="s-serving-files">Django doesn’t serve files itself; it leaves that job to whichever web server you choose.</p> <p>We recommend using a separate web server – i.e., one that’s not also running Django – for serving media. Here are some good choices:</p> <ul class="simple"> <li><a class="reference external" href="https://nginx.org/en/">Nginx</a></li> <li>A stripped-down version of <a class="reference external" href="https://httpd.apache.org/">Apache</a>
</li> </ul> <p>If, however, you have no option but to serve media files on the same Apache <code>VirtualHost</code> as Django, you can set up Apache to serve some URLs as static media, and others using the mod_wsgi interface to Django.</p> <p>This example sets up Django at the site root, but serves <code>robots.txt</code>, <code>favicon.ico</code>, and anything in the <code>/static/</code> and <code>/media/</code> URL space as a static file. All other URLs will be served using mod_wsgi:</p> <pre data-language="apache">Alias /robots.txt /path/to/mysite.com/static/robots.txt
Alias /favicon.ico /path/to/mysite.com/static/favicon.ico

Alias /media/ /path/to/mysite.com/media/
Alias /static/ /path/to/mysite.com/static/

&lt;Directory /path/to/mysite.com/static&gt;
Require all granted
&lt;/Directory&gt;

&lt;Directory /path/to/mysite.com/media&gt;
Require all granted
&lt;/Directory&gt;

WSGIScriptAlias / /path/to/mysite.com/mysite/wsgi.py

&lt;Directory /path/to/mysite.com/mysite&gt;
&lt;Files wsgi.py&gt;
Require all granted
&lt;/Files&gt;
&lt;/Directory&gt;
</pre>   <h2 id="id3">Serving the admin files</h2> <p id="s-serving-the-admin-files">When <a class="reference internal" href="../../../ref/contrib/staticfiles#module-django.contrib.staticfiles" title="django.contrib.staticfiles: An app for handling static files."><code>django.contrib.staticfiles</code></a> is in <a class="reference internal" href="../../../ref/settings#std:setting-INSTALLED_APPS"><code>INSTALLED_APPS</code></a>, the Django development server automatically serves the static files of the admin app (and any other installed apps). This is however not the case when you use any other server arrangement. You’re responsible for setting up Apache, or whichever web server you’re using, to serve the admin files.</p> <p>The admin files live in (<code>django/contrib/admin/static/admin</code>) of the Django distribution.</p> <p>We <strong>strongly</strong> recommend using <a class="reference internal" href="../../../ref/contrib/staticfiles#module-django.contrib.staticfiles" title="django.contrib.staticfiles: An app for handling static files."><code>django.contrib.staticfiles</code></a> to handle the admin files (along with a web server as outlined in the previous section; this means using the <a class="reference internal" href="../../../ref/contrib/staticfiles#django-admin-collectstatic"><code>collectstatic</code></a> management command to collect the static files in <a class="reference internal" href="../../../ref/settings#std:setting-STATIC_ROOT"><code>STATIC_ROOT</code></a>, and then configuring your web server to serve <a class="reference internal" href="../../../ref/settings#std:setting-STATIC_ROOT"><code>STATIC_ROOT</code></a> at <a class="reference internal" href="../../../ref/settings#std:setting-STATIC_URL"><code>STATIC_URL</code></a>), but here are three other approaches:</p> <ol class="arabic simple"> <li>Create a symbolic link to the admin static files from within your document root (this may require <code>+FollowSymLinks</code> in your Apache configuration).</li> <li>Use an <code>Alias</code> directive, as demonstrated above, to alias the appropriate URL (probably <a class="reference internal" href="../../../ref/settings#std:setting-STATIC_URL"><code>STATIC_URL</code></a> + <code>admin/</code>) to the actual location of the admin files.</li> <li>Copy the admin static files so that they live within your Apache document root.</li> </ol>   <h2 id="authenticating-against-django-s-user-database-from-apache">Authenticating against Django’s user database from Apache</h2> <p id="s-authenticating-against-django-s-user-database-from-apache">Django provides a handler to allow Apache to authenticate users directly against Django’s authentication backends. See the <a class="reference internal" href="apache-auth"><span class="doc">mod_wsgi authentication documentation</span></a>.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; Django Software Foundation and individual contributors<br>Licensed under the BSD License.<br>
    <a href="https://docs.djangoproject.com/en/4.0/howto/deployment/wsgi/modwsgi/" class="_attribution-link">https://docs.djangoproject.com/en/4.0/howto/deployment/wsgi/modwsgi/</a>
  </p>
</div>
