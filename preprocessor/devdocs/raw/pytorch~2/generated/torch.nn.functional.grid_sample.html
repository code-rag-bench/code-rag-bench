<h1 id="torch-nn-functional-grid-sample">torch.nn.functional.grid_sample</h1> <dl class="py function"> <dt class="sig sig-object py" id="torch.nn.functional.grid_sample">
<code>torch.nn.functional.grid_sample(input, grid, mode='bilinear', padding_mode='zeros', align_corners=None)</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/nn/functional.html#grid_sample"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Given an <code>input</code> and a flow-field <code>grid</code>, computes the <code>output</code> using <code>input</code> values and pixel locations from <code>grid</code>.</p> <p>Currently, only spatial (4-D) and volumetric (5-D) <code>input</code> are supported.</p> <p>In the spatial (4-D) case, for <code>input</code> with shape <span class="math"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>N</mi><mo separator="true">,</mo><mi>C</mi><mo separator="true">,</mo><msub><mi>H</mi><mtext>in</mtext></msub><mo separator="true">,</mo><msub><mi>W</mi><mtext>in</mtext></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(N, C, H_\text{in}, W_\text{in})</annotation></semantics></math></span></span></span> and <code>grid</code> with shape <span class="math"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>N</mi><mo separator="true">,</mo><msub><mi>H</mi><mtext>out</mtext></msub><mo separator="true">,</mo><msub><mi>W</mi><mtext>out</mtext></msub><mo separator="true">,</mo><mn>2</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(N, H_\text{out}, W_\text{out}, 2)</annotation></semantics></math></span></span></span>, the output will have shape <span class="math"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>N</mi><mo separator="true">,</mo><mi>C</mi><mo separator="true">,</mo><msub><mi>H</mi><mtext>out</mtext></msub><mo separator="true">,</mo><msub><mi>W</mi><mtext>out</mtext></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(N, C, H_\text{out}, W_\text{out})</annotation></semantics></math></span></span></span>.</p> <p>For each output location <code>output[n, :, h, w]</code>, the size-2 vector <code>grid[n, h, w]</code> specifies <code>input</code> pixel locations <code>x</code> and <code>y</code>, which are used to interpolate the output value <code>output[n, :, h, w]</code>. In the case of 5D inputs, <code>grid[n, d, h, w]</code> specifies the <code>x</code>, <code>y</code>, <code>z</code> pixel locations for interpolating <code>output[n, :, d, h, w]</code>. <code>mode</code> argument specifies <code>nearest</code> or <code>bilinear</code> interpolation method to sample the input pixels.</p> <p><code>grid</code> specifies the sampling pixel locations normalized by the <code>input</code> spatial dimensions. Therefore, it should have most values in the range of <code>[-1, 1]</code>. For example, values <code>x = -1, y = -1</code> is the left-top pixel of <code>input</code>, and values <code>x = 1, y = 1</code> is the right-bottom pixel of <code>input</code>.</p> <p>If <code>grid</code> has values outside the range of <code>[-1, 1]</code>, the corresponding outputs are handled as defined by <code>padding_mode</code>. Options are</p>  <ul class="simple"> <li>
<code>padding_mode="zeros"</code>: use <code>0</code> for out-of-bound grid locations,</li> <li>
<code>padding_mode="border"</code>: use border values for out-of-bound grid locations,</li> <li>
<code>padding_mode="reflection"</code>: use values at locations reflected by the border for out-of-bound grid locations. For location far away from the border, it will keep being reflected until becoming in bound, e.g., (normalized) pixel location <code>x = -3.5</code> reflects by border <code>-1</code> and becomes <code>x' = 1.5</code>, then reflects by border <code>1</code> and becomes <code>x'' = -0.5</code>.</li> </ul>  <div class="admonition note"> <p class="admonition-title">Note</p> <p>This function is often used in conjunction with <a class="reference internal" href="torch.nn.functional.affine_grid#torch.nn.functional.affine_grid" title="torch.nn.functional.affine_grid"><code>affine_grid()</code></a> to build <a class="reference external" href="https://arxiv.org/abs/1506.02025">Spatial Transformer Networks</a> .</p> </div> <div class="admonition note"> <p class="admonition-title">Note</p> <p>When using the CUDA backend, this operation may induce nondeterministic behaviour in its backward pass that is not easily switched off. Please see the notes on <a class="reference internal" href="https://pytorch.org/docs/2.1/notes/randomness.html"><span class="doc">Reproducibility</span></a> for background.</p> </div> <div class="admonition note"> <p class="admonition-title">Note</p> <p>NaN values in <code>grid</code> would be interpreted as <code>-1</code>.</p> </div> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>input</strong> (<a class="reference internal" href="../tensors#torch.Tensor" title="torch.Tensor">Tensor</a>) – input of shape <span class="math"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>N</mi><mo separator="true">,</mo><mi>C</mi><mo separator="true">,</mo><msub><mi>H</mi><mtext>in</mtext></msub><mo separator="true">,</mo><msub><mi>W</mi><mtext>in</mtext></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(N, C, H_\text{in}, W_\text{in})</annotation></semantics></math></span></span></span> (4-D case) or <span class="math"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>N</mi><mo separator="true">,</mo><mi>C</mi><mo separator="true">,</mo><msub><mi>D</mi><mtext>in</mtext></msub><mo separator="true">,</mo><msub><mi>H</mi><mtext>in</mtext></msub><mo separator="true">,</mo><msub><mi>W</mi><mtext>in</mtext></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(N, C, D_\text{in}, H_\text{in}, W_\text{in})</annotation></semantics></math></span></span></span> (5-D case)</li> <li>
<strong>grid</strong> (<a class="reference internal" href="../tensors#torch.Tensor" title="torch.Tensor">Tensor</a>) – flow-field of shape <span class="math"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>N</mi><mo separator="true">,</mo><msub><mi>H</mi><mtext>out</mtext></msub><mo separator="true">,</mo><msub><mi>W</mi><mtext>out</mtext></msub><mo separator="true">,</mo><mn>2</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(N, H_\text{out}, W_\text{out}, 2)</annotation></semantics></math></span></span></span> (4-D case) or <span class="math"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>N</mi><mo separator="true">,</mo><msub><mi>D</mi><mtext>out</mtext></msub><mo separator="true">,</mo><msub><mi>H</mi><mtext>out</mtext></msub><mo separator="true">,</mo><msub><mi>W</mi><mtext>out</mtext></msub><mo separator="true">,</mo><mn>3</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(N, D_\text{out}, H_\text{out}, W_\text{out}, 3)</annotation></semantics></math></span></span></span> (5-D case)</li> <li>
<strong>mode</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)">str</a>) – interpolation mode to calculate output values <code>'bilinear'</code> | <code>'nearest'</code> | <code>'bicubic'</code>. Default: <code>'bilinear'</code> Note: <code>mode='bicubic'</code> supports only 4-D input. When <code>mode='bilinear'</code> and the input is 5-D, the interpolation mode used internally will actually be trilinear. However, when the input is 4-D, the interpolation mode will legitimately be bilinear.</li> <li>
<strong>padding_mode</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)">str</a>) – padding mode for outside grid values <code>'zeros'</code> | <code>'border'</code> | <code>'reflection'</code>. Default: <code>'zeros'</code>
</li> <li>
<strong>align_corners</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)">bool</a><em>, </em><em>optional</em>) – Geometrically, we consider the pixels of the input as squares rather than points. If set to <code>True</code>, the extrema (<code>-1</code> and <code>1</code>) are considered as referring to the center points of the input’s corner pixels. If set to <code>False</code>, they are instead considered as referring to the corner points of the input’s corner pixels, making the sampling more resolution agnostic. This option parallels the <code>align_corners</code> option in <a class="reference internal" href="torch.nn.functional.interpolate#torch.nn.functional.interpolate" title="torch.nn.functional.interpolate"><code>interpolate()</code></a>, and so whichever option is used here should also be used there to resize the input image before grid sampling. Default: <code>False</code>
</li> </ul> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>output Tensor</p> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p>output (<a class="reference internal" href="../tensors#torch.Tensor" title="torch.Tensor">Tensor</a>)</p> </dd> </dl> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>When <code>align_corners = True</code>, the grid positions depend on the pixel size relative to the input image size, and so the locations sampled by <a class="reference internal" href="#torch.nn.functional.grid_sample" title="torch.nn.functional.grid_sample"><code>grid_sample()</code></a> will differ for the same input given at different resolutions (that is, after being upsampled or downsampled). The default behavior up to version 1.2.0 was <code>align_corners = True</code>. Since then, the default behavior has been changed to <code>align_corners = False</code>, in order to bring it in line with the default for <a class="reference internal" href="torch.nn.functional.interpolate#torch.nn.functional.interpolate" title="torch.nn.functional.interpolate"><code>interpolate()</code></a>.</p> </div> <div class="admonition note"> <p class="admonition-title">Note</p> <p><code>mode='bicubic'</code> is implemented using the <a class="reference external" href="https://en.wikipedia.org/wiki/Bicubic_interpolation">cubic convolution algorithm</a> with <span class="math"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>=</mo><mo>−</mo><mn>0.75</mn></mrow><annotation encoding="application/x-tex">\alpha=-0.75</annotation></semantics></math></span></span></span>. The constant <span class="math"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span></span></span> might be different from packages to packages. For example, <a class="reference external" href="https://github.com/python-pillow/Pillow/blob/4634eafe3c695a014267eefdce830b4a825beed7/src/libImaging/Resample.c#L51">PIL</a> and <a class="reference external" href="https://github.com/opencv/opencv/blob/f345ed564a06178670750bad59526cfa4033be55/modules/imgproc/src/resize.cpp#L908">OpenCV</a> use -0.5 and -0.75 respectively. This algorithm may “overshoot” the range of values it’s interpolating. For example, it may produce negative values or values greater than 255 when interpolating input in [0, 255]. Clamp the results with <a class="reference internal" href="torch.clamp#torch.clamp" title="torch.clamp"><code>torch.clamp()</code></a> to ensure they are within the valid range.</p> </div> </dd>
</dl><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2024, PyTorch Contributors<br>PyTorch has a BSD-style license, as found in the <a href="https://github.com/pytorch/pytorch/blob/main/LICENSE">LICENSE</a> file.<br>
    <a href="https://pytorch.org/docs/2.1/generated/torch.nn.functional.grid_sample.html" class="_attribution-link">https://pytorch.org/docs/2.1/generated/torch.nn.functional.grid_sample.html</a>
  </p>
</div>
