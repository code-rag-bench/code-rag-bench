<h1 id="rendezvous-api">Rendezvous</h1> <p id="module-torch.distributed.elastic.rendezvous">In the context of Torch Distributed Elastic we use the term <em>rendezvous</em> to refer to a particular functionality that combines a <strong>distributed synchronization</strong> primitive with <strong>peer discovery</strong>.</p> <p>It is used by Torch Distributed Elastic to gather participants of a training job (i.e. nodes) such that they all agree on the same list of participants and everyone’s roles, as well as make a consistent collective decision on when training can begin/resume.</p> <p>Torch Distributed Elastic rendezvous provides the following critical functionalities:</p> <p><strong>Barrier</strong>:</p> <p>Nodes performing rendezvous will all block until the rendezvous is considered complete - this happens when at least <code>min</code> total number of nodes have joined the rendezvous barrier (for the same job). This also implies the barrier is not necessarily of fixed size.</p> <p>There’s an additional small waiting time after reaching <code>min</code> number of nodes - this is used to ensure the rendezvous is not completed “too quickly” (which could potentially exclude additional nodes attempting to join at approximately the same time).</p> <p>If <code>max</code> number of nodes is gathered at the barrier, the rendezvous is completed immediately.</p> <p>There’s also an overall timeout which causes the rendezvous to fail if <code>min</code> number of nodes is never reached - this is meant to be a simple fail-safe to help release partially allocated job resources, in case there’s a problem with the resource manager, and is meant to be interpreted as non-retryable.</p> <p><strong>Exclusivity</strong>:</p> <p>A simple distributed barrier would not be sufficient, as we also need to ensure that only one group of nodes exists at any given time (for a given job). In other words, new nodes (i.e. joining late) should not be able to form a parallel independent group of workers for the same job.</p> <p>Torch Distributed Elastic rendezvous ensures that if a group of nodes has already completed a rendezvous (and hence might already be training), then additional “late” nodes attempting to rendezvous will only announce themselves as waiting, and will have to wait until the (previously completed) existing rendezvous is destroyed first.</p> <p><strong>Consistency</strong>:</p> <p>When a rendezvous is completed, all its members will agree on the job membership and everyone’s role in it. This role is represented using an integer, called rank, that is between between 0 and world size.</p> <p>Note that ranks are <em>not stable</em>, in the sense that the same node can be assigned a different rank in the next (re-)rendezvous.</p> <p><strong>Fault-tolerance</strong>:</p> <p>Torch Distributed Elastic rendezvous is designed to tolerate node failures during the rendezvous process. Should a process crash (or lose network connectivity, etc), between joining the rendezvous and it being completed, then a re-rendezvous with remaining healthy nodes will happen automatically.</p> <p>A node can also fail <em>after</em> it has completed (or <em>has been observered</em> by other nodes to have completed) the rendezvous - this scenario will be handled by the Torch Distributed Elastic <code>train_loop</code> instead (where it will also trigger a re-rendezvous).</p> <p><strong>Shared key-value store</strong>:</p> <p>When the rendezvous is completed, a shared key-value store is created and returned. This store implements a <code>torch.distributed.Store</code> API (see <a class="reference external" href="https://pytorch.org/docs/stable/distributed.html">distributed communication docs</a>).</p> <p>This store is only shared by the members of the completed rendezvous. It is intended to be used by Torch Distributed Elastic to exchange information necessary to initialize job control and data-planes.</p> <p><strong>Waiting workers and rendezvous closing</strong>:</p> <p>Torch Distributed Elastic rendezvous handler object provides additional functionalities, which are technically not part of the rendezvous process:</p> <ol class="arabic simple"> <li>Querying how many workers arrived late at the barrier, who can participate in <em>next</em> rendezvous.</li> <li>Setting the rendezvous <em>closed</em> to signal all nodes not to participate in next rendezvous.</li> </ol> <p><strong>DynamicRendezvousHandler</strong>:</p> <p>Torch Distributed Elastic comes with the <a class="reference internal" href="#torch.distributed.elastic.rendezvous.dynamic_rendezvous.DynamicRendezvousHandler" title="torch.distributed.elastic.rendezvous.dynamic_rendezvous.DynamicRendezvousHandler"><code>DynamicRendezvousHandler</code></a> class that implements the rendezvous mechanism described above. It is a backend- agnostic type that expects a particular <a class="reference internal" href="#torch.distributed.elastic.rendezvous.dynamic_rendezvous.RendezvousBackend" title="torch.distributed.elastic.rendezvous.dynamic_rendezvous.RendezvousBackend"><code>RendezvousBackend</code></a> instance to be specified during construction.</p> <p>Torch distributed users can either implement their own backend type or use one of the following implementations that come with PyTorch:</p> <ul> <li>
<a class="reference internal" href="#torch.distributed.elastic.rendezvous.c10d_rendezvous_backend.C10dRendezvousBackend" title="torch.distributed.elastic.rendezvous.c10d_rendezvous_backend.C10dRendezvousBackend"><code>C10dRendezvousBackend</code></a>: Uses a C10d store (by default <code>TCPStore</code>) as the rendezvous backend. The main advantage of using a C10d store is that it requires no 3rd-party dependency (such as etcd) to establish a rendezvous.</li> <li>
<p><a class="reference internal" href="#torch.distributed.elastic.rendezvous.etcd_rendezvous_backend.EtcdRendezvousBackend" title="torch.distributed.elastic.rendezvous.etcd_rendezvous_backend.EtcdRendezvousBackend"><code>EtcdRendezvousBackend</code></a>: Supersedes the legacy <a class="reference internal" href="#torch.distributed.elastic.rendezvous.etcd_rendezvous.EtcdRendezvousHandler" title="torch.distributed.elastic.rendezvous.etcd_rendezvous.EtcdRendezvousHandler"><code>EtcdRendezvousHandler</code></a> class. Passing an <a class="reference internal" href="#torch.distributed.elastic.rendezvous.etcd_rendezvous_backend.EtcdRendezvousBackend" title="torch.distributed.elastic.rendezvous.etcd_rendezvous_backend.EtcdRendezvousBackend"><code>EtcdRendezvousBackend</code></a> instance to <a class="reference internal" href="#torch.distributed.elastic.rendezvous.dynamic_rendezvous.DynamicRendezvousHandler" title="torch.distributed.elastic.rendezvous.dynamic_rendezvous.DynamicRendezvousHandler"><code>DynamicRendezvousHandler</code></a> is functionally equivalent to instantiating an <a class="reference internal" href="#torch.distributed.elastic.rendezvous.etcd_rendezvous.EtcdRendezvousHandler" title="torch.distributed.elastic.rendezvous.etcd_rendezvous.EtcdRendezvousHandler"><code>EtcdRendezvousHandler</code></a>.</p> <pre data-language="python">store = TCPStore("localhost")

backend = C10dRendezvousBackend(store, "my_run_id")

rdzv_handler = DynamicRendezvousHandler.from_backend(
    run_id="my_run_id",
    store=store,
    backend=backend,
    min_nodes=2,
    max_nodes=4
)
</pre> </li> </ul> <p>Below is a state diagram describing how rendezvous works.</p> <img alt="../_images/etcd_rdzv_diagram.png" src="https://pytorch.org/docs/2.1/_images/etcd_rdzv_diagram.png">  <h2 id="registry">Registry</h2> <dl class="py class"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.RendezvousParameters">
<code>class torch.distributed.elastic.rendezvous.RendezvousParameters(backend, endpoint, run_id, min_nodes, max_nodes, local_addr=None, **kwargs)</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/api.html#RendezvousParameters"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Holds the parameters to construct a <a class="reference internal" href="#torch.distributed.elastic.rendezvous.RendezvousHandler" title="torch.distributed.elastic.rendezvous.RendezvousHandler"><code>RendezvousHandler</code></a>.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>backend</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)">str</a>) – The name of the backend to use to handle the rendezvous.</li> <li>
<strong>endpoint</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)">str</a>) – The endpoint of the rendezvous, usually in form &lt;hostname&gt;[:&lt;port&gt;].</li> <li>
<strong>run_id</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)">str</a>) – The id of the rendezvous.</li> <li>
<strong>min_nodes</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)">int</a>) – The minimum number of nodes to admit to the rendezvous.</li> <li>
<strong>max_nodes</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)">int</a>) – The maximum number of nodes to admit to the rendezvous.</li> <li>
<strong>local_addr</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.12)">Optional</a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)">str</a><em>]</em>) – The address of the local node.</li> <li>
<strong>**kwargs</strong> – Additional parameters for the specified backend.</li> </ul> </dd> </dl> <dl class="py method"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.RendezvousParameters.get">
<code>get(key, default=None)</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/api.html#RendezvousParameters.get"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Returns the value for <code>key</code> if <code>key</code> exists, else <code>default</code>.</p> <dl class="field-list simple"> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.12)">Any</a></p> </dd> </dl> </dd>
</dl> <dl class="py method"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.RendezvousParameters.get_as_bool">
<code>get_as_bool(key, default=None)</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/api.html#RendezvousParameters.get_as_bool"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Returns the value for <code>key</code> as a <code>bool</code>.</p> <dl class="field-list simple"> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.12)">Optional</a>[<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)">bool</a>]</p> </dd> </dl> </dd>
</dl> <dl class="py method"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.RendezvousParameters.get_as_int">
<code>get_as_int(key, default=None)</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/api.html#RendezvousParameters.get_as_int"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Returns the value for <code>key</code> as an <code>int</code>.</p> <dl class="field-list simple"> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.12)">Optional</a>[<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)">int</a>]</p> </dd> </dl> </dd>
</dl> </dd>
</dl> <dl class="py class" id="module-torch.distributed.elastic.rendezvous.registry"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.RendezvousHandlerRegistry">
<code>class torch.distributed.elastic.rendezvous.RendezvousHandlerRegistry</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/api.html#RendezvousHandlerRegistry"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Represents a registry of <a class="reference internal" href="#torch.distributed.elastic.rendezvous.RendezvousHandler" title="torch.distributed.elastic.rendezvous.RendezvousHandler"><code>RendezvousHandler</code></a> backends.</p>  <dl class="py method"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.RendezvousHandlerRegistry.create_handler">
<code>create_handler(params)</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/api.html#RendezvousHandlerRegistry.create_handler"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Creates a new <a class="reference internal" href="#torch.distributed.elastic.rendezvous.RendezvousHandler" title="torch.distributed.elastic.rendezvous.RendezvousHandler"><code>RendezvousHandler</code></a>.</p> <dl class="field-list simple"> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference internal" href="#torch.distributed.elastic.rendezvous.RendezvousHandler" title="torch.distributed.elastic.rendezvous.api.RendezvousHandler">RendezvousHandler</a></p> </dd> </dl> </dd>
</dl> <dl class="py method"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.RendezvousHandlerRegistry.register">
<code>register(backend, creator)</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/api.html#RendezvousHandlerRegistry.register"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Registers a new rendezvous backend.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>backend</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)">str</a>) – The name of the backend.</li> <li>
<strong>creator</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Callable" title="(in Python v3.12)">Callable</a><em>[</em><em>[</em><a class="reference internal" href="#torch.distributed.elastic.rendezvous.RendezvousParameters" title="torch.distributed.elastic.rendezvous.api.RendezvousParameters">RendezvousParameters</a><em>]</em><em>, </em><a class="reference internal" href="#torch.distributed.elastic.rendezvous.RendezvousHandler" title="torch.distributed.elastic.rendezvous.api.RendezvousHandler">RendezvousHandler</a><em>]</em>) – The callback to invoke to construct the <a class="reference internal" href="#torch.distributed.elastic.rendezvous.RendezvousHandler" title="torch.distributed.elastic.rendezvous.RendezvousHandler"><code>RendezvousHandler</code></a>.</li> </ul> </dd> </dl> </dd>
</dl> </dd>
</dl>   <h2 id="handler">Handler</h2> <dl class="py class"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.RendezvousHandler">
<code>class torch.distributed.elastic.rendezvous.RendezvousHandler</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/api.html#RendezvousHandler"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Main rendezvous interface.</p> <div class="admonition note"> <p class="admonition-title">Note</p> <p>Distributed Torch users normally <strong>do not</strong> need to implement their own <code>RendezvousHandler</code>. An implementation based on C10d Store is already provided, and is recommended for most users.</p> </div> <dl class="py method"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.RendezvousHandler.get_backend">
<code>abstract get_backend()</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/api.html#RendezvousHandler.get_backend"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Returns the name of the rendezvous backend.</p> <dl class="field-list simple"> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)">str</a></p> </dd> </dl> </dd>
</dl> <dl class="py method"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.RendezvousHandler.get_run_id">
<code>abstract get_run_id()</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/api.html#RendezvousHandler.get_run_id"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Returns the run id of the rendezvous.</p> <p>The run id is a user-defined id that uniquely identifies an instance of a distributed application. It typically maps to a job id and is used to allow nodes to join the correct distributed application.</p> <dl class="field-list simple"> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)">str</a></p> </dd> </dl> </dd>
</dl> <dl class="py method"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.RendezvousHandler.is_closed">
<code>abstract is_closed()</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/api.html#RendezvousHandler.is_closed"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Checks whether the rendezvous has been closed.</p> <p>A closed rendezvous means all future attempts to re-rendezvous within same job will fail.</p> <p><code>is_closed()</code> and <a class="reference internal" href="#torch.distributed.elastic.rendezvous.RendezvousHandler.set_closed" title="torch.distributed.elastic.rendezvous.RendezvousHandler.set_closed"><code>set_closed()</code></a> have semantics of eventual propagation and should not be used for synchronization. The intention is that if at least one node decides the job is finished, it will close the rendezvous, and other nodes will soon observe this and stop running as well.</p> <dl class="field-list simple"> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)">bool</a></p> </dd> </dl> </dd>
</dl> <dl class="py method"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.RendezvousHandler.next_rendezvous">
<code>abstract next_rendezvous()</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/api.html#RendezvousHandler.next_rendezvous"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Main entry-point into the rendezvous barrier.</p> <p>Blocks until the rendezvous is complete and the current process is included in the formed worker group, or a timeout occurs, or the rendezvous was marked closed.</p> <dl class="field-list simple"> <dt class="field-odd">Returns</dt> <dd class="field-odd">
<p>A tuple of <a class="reference internal" href="../distributed#torch.distributed.Store" title="torch.distributed.Store"><code>torch.distributed.Store</code></a>, <code>rank</code>, and <code>world size</code>.</p> </dd> <dt class="field-even">Raises</dt> <dd class="field-even">
<ul class="simple"> <li>
<a class="reference internal" href="#torch.distributed.elastic.rendezvous.RendezvousClosedError" title="torch.distributed.elastic.rendezvous.RendezvousClosedError"><strong>RendezvousClosedError</strong></a> – The rendezvous is closed.</li> <li>
<a class="reference internal" href="#torch.distributed.elastic.rendezvous.RendezvousConnectionError" title="torch.distributed.elastic.rendezvous.RendezvousConnectionError"><strong>RendezvousConnectionError</strong></a> – The connection to the rendezvous backend has failed.</li> <li>
<a class="reference internal" href="#torch.distributed.elastic.rendezvous.RendezvousStateError" title="torch.distributed.elastic.rendezvous.RendezvousStateError"><strong>RendezvousStateError</strong></a> – The rendezvous state is corrupt.</li> <li>
<a class="reference internal" href="#torch.distributed.elastic.rendezvous.RendezvousTimeoutError" title="torch.distributed.elastic.rendezvous.RendezvousTimeoutError"><strong>RendezvousTimeoutError</strong></a> – The rendezvous did not complete on time.</li> </ul> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.12)">Tuple</a>[<a class="reference internal" href="../distributed#torch.distributed.Store" title="torch.distributed.distributed_c10d.Store">Store</a>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)">int</a>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)">int</a>]</p> </dd> </dl> </dd>
</dl> <dl class="py method"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.RendezvousHandler.num_nodes_waiting">
<code>abstract num_nodes_waiting()</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/api.html#RendezvousHandler.num_nodes_waiting"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Returns the number of nodes who arrived late at the rendezvous barrier, hence were not included in the current worker group.</p> <p>Callers should periodically call this method to check whether new nodes are waiting to join the job and if so admit them by calling <a class="reference internal" href="#torch.distributed.elastic.rendezvous.RendezvousHandler.next_rendezvous" title="torch.distributed.elastic.rendezvous.RendezvousHandler.next_rendezvous"><code>next_rendezvous()</code></a> (re-rendezvous).</p> <dl class="field-list simple"> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)">int</a></p> </dd> </dl> </dd>
</dl> <dl class="py method"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.RendezvousHandler.set_closed">
<code>abstract set_closed()</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/api.html#RendezvousHandler.set_closed"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Marks the rendezvous as closed.</p> </dd>
</dl> <dl class="py method"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.RendezvousHandler.shutdown">
<code>abstract shutdown()</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/api.html#RendezvousHandler.shutdown"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Closes all resources that were open for the rendezvous.</p> <p>Example:</p> <pre data-language="python">rdzv_handler = ...
try:
    store, rank, world_size = rdzv_handler.next_rendezvous()
finally:
    rdzv_handler.shutdown()
</pre> <dl class="field-list simple"> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)">bool</a></p> </dd> </dl> </dd>
</dl> </dd>
</dl>   <h2 id="exceptions">Exceptions</h2> <dl class="py class"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.RendezvousError">
<code>class torch.distributed.elastic.rendezvous.RendezvousError</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/api.html#RendezvousError"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Represents the base type for rendezvous errors.</p> </dd>
</dl> <dl class="py class"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.RendezvousClosedError">
<code>class torch.distributed.elastic.rendezvous.RendezvousClosedError</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/api.html#RendezvousClosedError"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Raised when a rendezvous is closed.</p> </dd>
</dl> <dl class="py class"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.RendezvousTimeoutError">
<code>class torch.distributed.elastic.rendezvous.RendezvousTimeoutError</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/api.html#RendezvousTimeoutError"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Raised when a rendezvous did not complete on time.</p> </dd>
</dl> <dl class="py class"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.RendezvousConnectionError">
<code>class torch.distributed.elastic.rendezvous.RendezvousConnectionError</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/api.html#RendezvousConnectionError"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Raised when the connection to a rendezvous backend has failed.</p> </dd>
</dl> <dl class="py class"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.RendezvousStateError">
<code>class torch.distributed.elastic.rendezvous.RendezvousStateError</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/api.html#RendezvousStateError"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Raised when the state of a rendezvous is corrupt.</p> </dd>
</dl>   <h2 id="implementations">Implementations</h2>  <h3 id="dynamic-rendezvous">Dynamic Rendezvous</h3> <dl class="py function"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.dynamic_rendezvous.create_handler">
<code>torch.distributed.elastic.rendezvous.dynamic_rendezvous.create_handler(store, backend, params)</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/dynamic_rendezvous.html#create_handler"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Creates a new <a class="reference internal" href="#torch.distributed.elastic.rendezvous.dynamic_rendezvous.DynamicRendezvousHandler" title="torch.distributed.elastic.rendezvous.dynamic_rendezvous.DynamicRendezvousHandler"><code>DynamicRendezvousHandler</code></a> from the specified parameters.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>store</strong> (<a class="reference internal" href="../distributed#torch.distributed.Store" title="torch.distributed.distributed_c10d.Store">Store</a>) – The C10d store to return as part of the rendezvous.</li> <li>
<strong>backend</strong> (<a class="reference internal" href="#torch.distributed.elastic.rendezvous.dynamic_rendezvous.RendezvousBackend" title="torch.distributed.elastic.rendezvous.dynamic_rendezvous.RendezvousBackend">RendezvousBackend</a>) – The backend to use to hold the rendezvous state.</li> </ul> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference internal" href="#torch.distributed.elastic.rendezvous.dynamic_rendezvous.DynamicRendezvousHandler" title="torch.distributed.elastic.rendezvous.dynamic_rendezvous.DynamicRendezvousHandler">DynamicRendezvousHandler</a></p> </dd> </dl> <table class="docutils colwidths-auto align-default"> <thead> <tr>
<th class="head"><p>Parameter</p></th> <th class="head"><p>Description</p></th> </tr> </thead>  <tr>
<td><p>join_timeout</p></td> <td><p>The total time, in seconds, within which the rendezvous is expected to complete. Defaults to 600 seconds.</p></td> </tr> <tr>
<td><p>last_call_timeout</p></td> <td><p>An additional wait amount, in seconds, before completing the rendezvous once the minimum number of nodes has been reached. Defaults to 30 seconds.</p></td> </tr> <tr>
<td><p>close_timeout</p></td> <td><p>The time, in seconds, within which the rendezvous is expected to close after a call to <code>RendezvousHandler.set_closed()</code> or <code>RendezvousHandler.shutdown()</code>. Defaults to 30 seconds.</p></td> </tr>  </table> </dd>
</dl> <dl class="py class"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.dynamic_rendezvous.DynamicRendezvousHandler">
<code>class torch.distributed.elastic.rendezvous.dynamic_rendezvous.DynamicRendezvousHandler</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/dynamic_rendezvous.html#DynamicRendezvousHandler"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Represents a handler that sets up a rendezvous among a set of nodes.</p>  <dl class="py method"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.dynamic_rendezvous.DynamicRendezvousHandler.from_backend">
<code>classmethod from_backend(run_id, store, backend, min_nodes, max_nodes, local_addr=None, timeout=None)</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/dynamic_rendezvous.html#DynamicRendezvousHandler.from_backend"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Creates a new <a class="reference internal" href="#torch.distributed.elastic.rendezvous.dynamic_rendezvous.DynamicRendezvousHandler" title="torch.distributed.elastic.rendezvous.dynamic_rendezvous.DynamicRendezvousHandler"><code>DynamicRendezvousHandler</code></a>.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>run_id</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)">str</a>) – The run id of the rendezvous.</li> <li>
<strong>store</strong> (<a class="reference internal" href="../distributed#torch.distributed.Store" title="torch.distributed.distributed_c10d.Store">Store</a>) – The C10d store to return as part of the rendezvous.</li> <li>
<strong>backend</strong> (<a class="reference internal" href="#torch.distributed.elastic.rendezvous.dynamic_rendezvous.RendezvousBackend" title="torch.distributed.elastic.rendezvous.dynamic_rendezvous.RendezvousBackend">RendezvousBackend</a>) – The backend to use to hold the rendezvous state.</li> <li>
<strong>min_nodes</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)">int</a>) – The minimum number of nodes to admit to the rendezvous.</li> <li>
<strong>max_nodes</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)">int</a>) – The maximum number of nodes to admit to the rendezvous.</li> <li>
<strong>local_addr</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.12)">Optional</a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)">str</a><em>]</em>) – The local node address.</li> <li>
<strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.12)">Optional</a><em>[</em><a class="reference internal" href="#torch.distributed.elastic.rendezvous.dynamic_rendezvous.RendezvousTimeout" title="torch.distributed.elastic.rendezvous.dynamic_rendezvous.RendezvousTimeout">RendezvousTimeout</a><em>]</em>) – The timeout configuration of the rendezvous.</li> </ul> </dd> </dl> </dd>
</dl> </dd>
</dl> <dl class="py class"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.dynamic_rendezvous.RendezvousBackend">
<code>class torch.distributed.elastic.rendezvous.dynamic_rendezvous.RendezvousBackend</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/dynamic_rendezvous.html#RendezvousBackend"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Represents a backend that holds the rendezvous state.</p> <dl class="py method"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.dynamic_rendezvous.RendezvousBackend.get_state">
<code>abstract get_state()</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/dynamic_rendezvous.html#RendezvousBackend.get_state"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Gets the rendezvous state.</p> <dl class="field-list simple"> <dt class="field-odd">Returns</dt> <dd class="field-odd">
<p>A tuple of the encoded rendezvous state and its fencing token or <code>None</code> if no state is found in the backend.</p> </dd> <dt class="field-even">Raises</dt> <dd class="field-even">
<ul class="simple"> <li>
<a class="reference internal" href="#torch.distributed.elastic.rendezvous.RendezvousConnectionError" title="torch.distributed.elastic.rendezvous.RendezvousConnectionError"><strong>RendezvousConnectionError</strong></a> – The connection to the backend has failed.</li> <li>
<a class="reference internal" href="#torch.distributed.elastic.rendezvous.RendezvousStateError" title="torch.distributed.elastic.rendezvous.RendezvousStateError"><strong>RendezvousStateError</strong></a> – The rendezvous state is corrupt.</li> </ul> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.12)">Optional</a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.12)">Tuple</a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.12)">bytes</a>, <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.12)">Any</a>]]</p> </dd> </dl> </dd>
</dl> <dl class="py property"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.dynamic_rendezvous.RendezvousBackend.name">
<code>abstract property name: str</code> </dt> <dd>
<p>Gets the name of the backend.</p> </dd>
</dl> <dl class="py method"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.dynamic_rendezvous.RendezvousBackend.set_state">
<code>abstract set_state(state, token=None)</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/dynamic_rendezvous.html#RendezvousBackend.set_state"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Sets the rendezvous state.</p> <p>The new rendezvous state is set conditionally:</p>  <ul class="simple"> <li>If the specified <code>token</code> matches the fencing token stored in the backend, the state will be updated. The new state will be returned to the caller along with its fencing token.</li> <li>If the specified <code>token</code> does not match the fencing token stored in the backend, the state won’t be updated; instead the existing state along with its fencing token will be returned to the caller.</li> <li>If the specified <code>token</code> is <code>None</code>, the new state will be set only if there is no existing state in the backend. Either the new state or the existing state along with its fencing token will be returned to the caller.</li> </ul>  <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>state</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.12)">bytes</a>) – The encoded rendezvous state.</li> <li>
<strong>token</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.12)">Optional</a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.12)">Any</a><em>]</em>) – An optional fencing token that was retrieved by a previous call to <a class="reference internal" href="#torch.distributed.elastic.rendezvous.dynamic_rendezvous.RendezvousBackend.get_state" title="torch.distributed.elastic.rendezvous.dynamic_rendezvous.RendezvousBackend.get_state"><code>get_state()</code></a> or <code>set_state()</code>.</li> </ul> </dd> <dt class="field-even">Returns</dt> <dd class="field-even">
<p>A tuple of the serialized rendezvous state, its fencing token, and a boolean value indicating whether our set attempt succeeded.</p> </dd> <dt class="field-odd">Raises</dt> <dd class="field-odd">
<ul class="simple"> <li>
<a class="reference internal" href="#torch.distributed.elastic.rendezvous.RendezvousConnectionError" title="torch.distributed.elastic.rendezvous.RendezvousConnectionError"><strong>RendezvousConnectionError</strong></a> – The connection to the backend has failed.</li> <li>
<a class="reference internal" href="#torch.distributed.elastic.rendezvous.RendezvousStateError" title="torch.distributed.elastic.rendezvous.RendezvousStateError"><strong>RendezvousStateError</strong></a> – The rendezvous state is corrupt.</li> </ul> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.12)">Optional</a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.12)">Tuple</a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.12)">bytes</a>, <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.12)">Any</a>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)">bool</a>]]</p> </dd> </dl> </dd>
</dl> </dd>
</dl> <dl class="py class"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.dynamic_rendezvous.RendezvousTimeout">
<code>class torch.distributed.elastic.rendezvous.dynamic_rendezvous.RendezvousTimeout(join=None, last_call=None, close=None, heartbeat=None)</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/dynamic_rendezvous.html#RendezvousTimeout"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Holds the timeout configuration of a rendezvous.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>join</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.12)">Optional</a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.timedelta" title="(in Python v3.12)">timedelta</a><em>]</em>) – The time within which the rendezvous is expected to complete.</li> <li>
<strong>last_call</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.12)">Optional</a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.timedelta" title="(in Python v3.12)">timedelta</a><em>]</em>) – An additional wait amount before completing the rendezvous once the rendezvous has the minimum number of required participants.</li> <li>
<strong>close</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.12)">Optional</a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.timedelta" title="(in Python v3.12)">timedelta</a><em>]</em>) – The time within which the rendezvous is expected to close after a call to <code>RendezvousHandler.set_closed()</code> or <code>RendezvousHandler.shutdown()</code>.</li> <li>
<strong>keep_alive</strong> – The time within which a keep-alive heartbeat is expected to complete.</li> </ul> </dd> </dl> <dl class="py property"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.dynamic_rendezvous.RendezvousTimeout.close">
<code>property close: timedelta</code> </dt> <dd>
<p>Gets the close timeout.</p> </dd>
</dl> <dl class="py property"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.dynamic_rendezvous.RendezvousTimeout.heartbeat">
<code>property heartbeat: timedelta</code> </dt> <dd>
<p>Gets the keep-alive heartbeat timeout.</p> </dd>
</dl> <dl class="py property"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.dynamic_rendezvous.RendezvousTimeout.join">
<code>property join: timedelta</code> </dt> <dd>
<p>Gets the join timeout.</p> </dd>
</dl> <dl class="py property"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.dynamic_rendezvous.RendezvousTimeout.last_call">
<code>property last_call: timedelta</code> </dt> <dd>
<p>Gets the last call timeout.</p> </dd>
</dl> </dd>
</dl>  <h4 id="c10d-backend">C10d Backend</h4> <dl class="py function"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.c10d_rendezvous_backend.create_backend">
<code>torch.distributed.elastic.rendezvous.c10d_rendezvous_backend.create_backend(params)</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/c10d_rendezvous_backend.html#create_backend"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Creates a new <a class="reference internal" href="#torch.distributed.elastic.rendezvous.c10d_rendezvous_backend.C10dRendezvousBackend" title="torch.distributed.elastic.rendezvous.c10d_rendezvous_backend.C10dRendezvousBackend"><code>C10dRendezvousBackend</code></a> from the specified parameters.</p> <table class="docutils colwidths-auto align-default"> <thead> <tr>
<th class="head"><p>Parameter</p></th> <th class="head"><p>Description</p></th> </tr> </thead>  <tr>
<td><p>store_type</p></td> <td><p>The type of the C10d store. The currently supported types are “tcp” and “file” which correspond to <a class="reference internal" href="../distributed#torch.distributed.TCPStore" title="torch.distributed.TCPStore"><code>torch.distributed.TCPStore</code></a> and <a class="reference internal" href="../distributed#torch.distributed.FileStore" title="torch.distributed.FileStore"><code>torch.distributed.FileStore</code></a>, respectively. Defaults to “tcp”.</p></td> </tr> <tr>
<td><p>read_timeout</p></td> <td>
<p>The read timeout, in seconds, for store operations. Defaults to 60 seconds.</p> <p>Note this only applies to <a class="reference internal" href="../distributed#torch.distributed.TCPStore" title="torch.distributed.TCPStore"><code>torch.distributed.TCPStore</code></a>. It is not relevant to <a class="reference internal" href="../distributed#torch.distributed.FileStore" title="torch.distributed.FileStore"><code>torch.distributed.FileStore</code></a> which does not take in timeout as a parameter.</p> </td> </tr> <tr>
<td><p>is_host</p></td> <td>
<p>A boolean value indicating whether this backend instance will host the C10d store. If not specified it will be inferred heuristically by matching the hostname or the IP address of this machine against the specified rendezvous endpoint. Defaults to <code>None</code>.</p> <p>Note that this configuration option only applies to <a class="reference internal" href="../distributed#torch.distributed.TCPStore" title="torch.distributed.TCPStore"><code>torch.distributed.TCPStore</code></a>. In normal circumstances you can safely skip it; the only time when it is needed is if its value cannot be correctly determined (e.g. the rendezvous endpoint has a CNAME as the hostname or does not match the FQDN of the machine).</p> </td> </tr>  </table> <dl class="field-list simple"> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.12)">Tuple</a>[<a class="reference internal" href="#torch.distributed.elastic.rendezvous.c10d_rendezvous_backend.C10dRendezvousBackend" title="torch.distributed.elastic.rendezvous.c10d_rendezvous_backend.C10dRendezvousBackend">C10dRendezvousBackend</a>, <a class="reference internal" href="../distributed#torch.distributed.Store" title="torch.distributed.distributed_c10d.Store">Store</a>]</p> </dd> </dl> </dd>
</dl> <dl class="py class"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.c10d_rendezvous_backend.C10dRendezvousBackend">
<code>class torch.distributed.elastic.rendezvous.c10d_rendezvous_backend.C10dRendezvousBackend(store, run_id)</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/c10d_rendezvous_backend.html#C10dRendezvousBackend"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Represents a C10d-backed rendezvous backend.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>store</strong> (<a class="reference internal" href="../distributed#torch.distributed.Store" title="torch.distributed.distributed_c10d.Store">Store</a>) – The <a class="reference internal" href="../distributed#torch.distributed.Store" title="torch.distributed.Store"><code>torch.distributed.Store</code></a> instance to use to communicate with the C10d store.</li> <li>
<strong>run_id</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)">str</a>) – The run id of the rendezvous.</li> </ul> </dd> </dl> <dl class="py method"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.c10d_rendezvous_backend.C10dRendezvousBackend.get_state">
<code>get_state()</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/c10d_rendezvous_backend.html#C10dRendezvousBackend.get_state"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>See base class.</p> <dl class="field-list simple"> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.12)">Optional</a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.12)">Tuple</a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.12)">bytes</a>, <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.12)">Any</a>]]</p> </dd> </dl> </dd>
</dl> <dl class="py property"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.c10d_rendezvous_backend.C10dRendezvousBackend.name">
<code>property name: str</code> </dt> <dd>
<p>See base class.</p> </dd>
</dl> <dl class="py method"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.c10d_rendezvous_backend.C10dRendezvousBackend.set_state">
<code>set_state(state, token=None)</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/c10d_rendezvous_backend.html#C10dRendezvousBackend.set_state"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>See base class.</p> <dl class="field-list simple"> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.12)">Optional</a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.12)">Tuple</a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.12)">bytes</a>, <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.12)">Any</a>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)">bool</a>]]</p> </dd> </dl> </dd>
</dl> </dd>
</dl>   <h4 id="etcd-backend">Etcd Backend</h4> <dl class="py function"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.etcd_rendezvous_backend.create_backend">
<code>torch.distributed.elastic.rendezvous.etcd_rendezvous_backend.create_backend(params)</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/etcd_rendezvous_backend.html#create_backend"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Creates a new <a class="reference internal" href="#torch.distributed.elastic.rendezvous.etcd_rendezvous_backend.EtcdRendezvousBackend" title="torch.distributed.elastic.rendezvous.etcd_rendezvous_backend.EtcdRendezvousBackend"><code>EtcdRendezvousBackend</code></a> from the specified parameters.</p> <table class="docutils colwidths-auto align-default"> <thead> <tr>
<th class="head"><p>Parameter</p></th> <th class="head"><p>Description</p></th> </tr> </thead>  <tr>
<td><p>read_timeout</p></td> <td><p>The read timeout, in seconds, for etcd operations. Defaults to 60 seconds.</p></td> </tr> <tr>
<td><p>protocol</p></td> <td><p>The protocol to use to communicate with etcd. Valid values are “http” and “https”. Defaults to “http”.</p></td> </tr> <tr>
<td><p>ssl_cert</p></td> <td><p>The path to the SSL client certificate to use along with HTTPS. Defaults to <code>None</code>.</p></td> </tr> <tr>
<td><p>ssl_cert_key</p></td> <td><p>The path to the private key of the SSL client certificate to use along with HTTPS. Defaults to <code>None</code>.</p></td> </tr> <tr>
<td><p>ca_cert</p></td> <td><p>The path to the rool SSL authority certificate. Defaults to <code>None</code>.</p></td> </tr>  </table> <dl class="field-list simple"> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.12)">Tuple</a>[<a class="reference internal" href="#torch.distributed.elastic.rendezvous.etcd_rendezvous_backend.EtcdRendezvousBackend" title="torch.distributed.elastic.rendezvous.etcd_rendezvous_backend.EtcdRendezvousBackend">EtcdRendezvousBackend</a>, <a class="reference internal" href="../distributed#torch.distributed.Store" title="torch.distributed.distributed_c10d.Store">Store</a>]</p> </dd> </dl> </dd>
</dl> <dl class="py class"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.etcd_rendezvous_backend.EtcdRendezvousBackend">
<code>class torch.distributed.elastic.rendezvous.etcd_rendezvous_backend.EtcdRendezvousBackend(client, run_id, key_prefix=None, ttl=None)</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/etcd_rendezvous_backend.html#EtcdRendezvousBackend"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Represents an etcd-based rendezvous backend.</p> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<ul class="simple"> <li>
<strong>client</strong> (<em>Client</em>) – The <code>etcd.Client</code> instance to use to communicate with etcd.</li> <li>
<strong>run_id</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)">str</a>) – The run id of the rendezvous.</li> <li>
<strong>key_prefix</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.12)">Optional</a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.12)">str</a><em>]</em>) – The path under which to store the rendezvous state in etcd.</li> <li>
<strong>ttl</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.12)">Optional</a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)">int</a><em>]</em>) – The TTL of the rendezvous state. If not specified, defaults to two hours.</li> </ul> </dd> </dl> <dl class="py method"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.etcd_rendezvous_backend.EtcdRendezvousBackend.get_state">
<code>get_state()</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/etcd_rendezvous_backend.html#EtcdRendezvousBackend.get_state"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>See base class.</p> <dl class="field-list simple"> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.12)">Optional</a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.12)">Tuple</a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.12)">bytes</a>, <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.12)">Any</a>]]</p> </dd> </dl> </dd>
</dl> <dl class="py property"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.etcd_rendezvous_backend.EtcdRendezvousBackend.name">
<code>property name: str</code> </dt> <dd>
<p>See base class.</p> </dd>
</dl> <dl class="py method"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.etcd_rendezvous_backend.EtcdRendezvousBackend.set_state">
<code>set_state(state, token=None)</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/etcd_rendezvous_backend.html#EtcdRendezvousBackend.set_state"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>See base class.</p> <dl class="field-list simple"> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.12)">Optional</a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.12)">Tuple</a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.12)">bytes</a>, <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Any" title="(in Python v3.12)">Any</a>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)">bool</a>]]</p> </dd> </dl> </dd>
</dl> </dd>
</dl>    <h3 id="etcd-rendezvous-legacy">Etcd Rendezvous (Legacy)</h3> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>The <code>DynamicRendezvousHandler</code> class supersedes the <code>EtcdRendezvousHandler</code> class, and is recommended for most users. <code>EtcdRendezvousHandler</code> is in maintenance mode and will be deprecated in the future.</p> </div> <dl class="py class"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.etcd_rendezvous.EtcdRendezvousHandler">
<code>class torch.distributed.elastic.rendezvous.etcd_rendezvous.EtcdRendezvousHandler(rdzv_impl)</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/etcd_rendezvous.html#EtcdRendezvousHandler"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Implements a <a class="reference internal" href="#torch.distributed.elastic.rendezvous.RendezvousHandler" title="torch.distributed.elastic.rendezvous.RendezvousHandler"><code>torch.distributed.elastic.rendezvous.RendezvousHandler</code></a> interface backed by <code>torch.distributed.elastic.rendezvous.etcd_rendezvous.EtcdRendezvous</code>. <code>EtcdRendezvousHandler</code> uses a URL to configure the type of rendezvous to use and to pass implementation specific configurations to the rendezvous module. The basic etcd rendezvous configuration URL looks like the following</p> <pre data-language="python">etcd://&lt;etcd_address&gt;:&lt;port&gt;/&lt;job_id&gt;?min_workers=&lt;min_workers&gt;&amp;max_workers=&lt;max_workers&gt;  # noqa: W605

-- example --

etcd://localhost:2379/1234?min_workers=1&amp;max_workers=3
</pre> <p>The URL above is interpreted as follows:</p> <ol class="arabic simple"> <li>Use the rendezvous handler that is registered with the <code>etcd</code> scheme</li> <li>The <code>etcd</code> endpoint to use is <code>localhost:2379</code>
</li> <li>
<code>job_id == 1234</code> is used as the prefix in etcd (this allows one to share a common etcd server for multiple jobs so long as the <code>job_ids</code> are guaranteed to be unique). Note that the job id can be any string (e.g. does not need to be a number) as long as it is unique.</li> <li>
<code>min_workers=1</code> and <code>max_workers=3</code> specifies a range for membership size - Torch Distributed Elastic starts running the job as long as the cluster size is greater than or equal to <code>min_workers</code> and admits up to <code>max_workers</code> into the cluster.</li> </ol> <p>Below are a full list of the parameters that can be passed to etcd rendezvous:</p> <table class="docutils colwidths-auto align-default"> <thead> <tr>
<th class="head"><p>Parameter</p></th> <th class="head"><p>Description</p></th> </tr> </thead>  <tr>
<td><p>min_workers</p></td> <td><p>minimum number of workers for the rendezvous to be valid</p></td> </tr> <tr>
<td><p>max_workers</p></td> <td><p>maximum number of workers to admit</p></td> </tr> <tr>
<td><p>timeout</p></td> <td><p>total timeout within which next_rendezvous is expected to succeed (default 600s)</p></td> </tr> <tr>
<td><p>last_call_timeout</p></td> <td><p>additional wait amount (“last call”) after min number of workers has been reached (defaults to 30s)</p></td> </tr> <tr>
<td><p>etcd_prefix</p></td> <td><p>path prefix (from etcd root), inside which all etcd nodes will be created (defaults to <code>/torchelastic/p2p</code>)</p></td> </tr>  </table> </dd>
</dl>   <h3 id="etcd-store">Etcd Store</h3> <p>The <code>EtcdStore</code> is the C10d <code>Store</code> instance type returned by <code>next_rendezvous()</code> when etcd is used as the rendezvous backend.</p> <dl class="py class"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.etcd_store.EtcdStore">
<code>class torch.distributed.elastic.rendezvous.etcd_store.EtcdStore(etcd_client, etcd_store_prefix, timeout=None)</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/etcd_store.html#EtcdStore"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Implements a c10 Store interface by piggybacking on the rendezvous etcd instance. This is the store object returned by <code>EtcdRendezvous</code></p>  <dl class="py method"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.etcd_store.EtcdStore.add">
<code>add(key, num)</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/etcd_store.html#EtcdStore.add"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Atomically increment a value by an integer amount. The integer is represented as a string using base 10. If key is not present, a default value of <code>0</code> will be assumed.</p> <dl class="field-list simple"> <dt class="field-odd">Returns</dt> <dd class="field-odd">
<p>the new (incremented) value</p> </dd> <dt class="field-even">Return type</dt> <dd class="field-even">
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)">int</a></p> </dd> </dl> </dd>
</dl> <dl class="py method"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.etcd_store.EtcdStore.check">
<code>check(keys)</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/etcd_store.html#EtcdStore.check"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Check if all of the keys are immediately present (without waiting).</p> <dl class="field-list simple"> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)">bool</a></p> </dd> </dl> </dd>
</dl> <dl class="py method"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.etcd_store.EtcdStore.get">
<code>get(key)</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/etcd_store.html#EtcdStore.get"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Get a value by key, possibly doing a blocking wait.</p> <p>If key is not immediately present, will do a blocking wait for at most <code>timeout</code> duration or until the key is published.</p> <dl class="field-list simple"> <dt class="field-odd">Returns</dt> <dd class="field-odd">
<p>value <code>(bytes)</code></p> </dd> <dt class="field-even">Raises</dt> <dd class="field-even">
<p><strong>LookupError - If key still not published after timeout</strong> – </p> </dd> <dt class="field-odd">Return type</dt> <dd class="field-odd">
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.12)">bytes</a></p> </dd> </dl> </dd>
</dl> <dl class="py method"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.etcd_store.EtcdStore.set">
<code>set(key, value)</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/etcd_store.html#EtcdStore.set"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Write a key/value pair into <code>EtcdStore</code>. Both key and value may be either Python <code>str</code> or <code>bytes</code>.</p> </dd>
</dl> <dl class="py method"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.etcd_store.EtcdStore.wait">
<code>wait(keys, override_timeout=None)</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/etcd_store.html#EtcdStore.wait"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<p>Waits until all of the keys are published, or until timeout.</p> <dl class="field-list simple"> <dt class="field-odd">Raises</dt> <dd class="field-odd">
<p><strong>LookupError - if timeout occurs</strong> – </p> </dd> </dl> </dd>
</dl> </dd>
</dl>   <h3 id="etcd-server">Etcd Server</h3> <p>The <code>EtcdServer</code> is a convenience class that makes it easy for you to start and stop an etcd server on a subprocess. This is useful for testing or single-node (multi-worker) deployments where manually setting up an etcd server on the side is cumbersome.</p> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>For production and multi-node deployments please consider properly deploying a highly available etcd server as this is the single point of failure for your distributed jobs.</p> </div> <dl class="py class"> <dt class="sig sig-object py" id="torch.distributed.elastic.rendezvous.etcd_server.EtcdServer">
<code>class torch.distributed.elastic.rendezvous.etcd_server.EtcdServer(data_dir=None)</code> <a class="reference internal" href="https://pytorch.org/docs/2.1/_modules/torch/distributed/elastic/rendezvous/etcd_server.html#EtcdServer"><span class="viewcode-link">[source]</span></a>
</dt> <dd>
<div class="admonition note"> <p class="admonition-title">Note</p> <p>tested on etcd server v3.4.3</p> </div> <p>Starts and stops a local standalone etcd server on a random free port. Useful for single node, multi-worker launches or testing, where a sidecar etcd server is more convenient than having to separately setup an etcd server.</p> <p>This class registers a termination handler to shutdown the etcd subprocess on exit. This termination handler is NOT a substitute for calling the <code>stop()</code> method.</p> <p>The following fallback mechanism is used to find the etcd binary:</p> <ol class="arabic simple"> <li>Uses env var TORCHELASTIC_ETCD_BINARY_PATH</li> <li>Uses <code>&lt;this file root&gt;/bin/etcd</code> if one exists</li> <li>Uses <code>etcd</code> from <code>PATH</code>
</li> </ol> <p>Usage</p> <pre data-language="python">server = EtcdServer("/usr/bin/etcd", 2379, "/tmp/default.etcd")
server.start()
client = server.get_client()
# use client
server.stop()
</pre> <dl class="field-list simple"> <dt class="field-odd">Parameters</dt> <dd class="field-odd">
<p><strong>etcd_binary_path</strong> – path of etcd server binary (see above for fallback path)</p> </dd> </dl> </dd>
</dl><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2024, PyTorch Contributors<br>PyTorch has a BSD-style license, as found in the <a href="https://github.com/pytorch/pytorch/blob/main/LICENSE">LICENSE</a> file.<br>
    <a href="https://pytorch.org/docs/2.1/elastic/rendezvous.html" class="_attribution-link">https://pytorch.org/docs/2.1/elastic/rendezvous.html</a>
  </p>
</div>
